<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<style type="text/css">
span.lineno { color: white; background: #aaaaaa; border-right: solid white 12px }
span.nottickedoff { background: yellow}
span.istickedoff { background: white }
span.tickonlyfalse { margin: -1px; border: 1px solid #f20913; background: #f20913 }
span.tickonlytrue  { margin: -1px; border: 1px solid #60de51; background: #60de51 }
span.funcount { font-size: small; color: orange; z-index: 2; position: absolute; right: 20 }
span.decl { font-weight: bold }
span.spaces    { background: white }
</style>
</head>
<body>
<pre>
<span class="decl"><span class="nottickedoff">never executed</span> <span class="tickonlytrue">always true</span> <span class="tickonlyfalse">always false</span></span>
</pre>
<pre>
<span class="lineno">    1 </span>{-# LANGUAGE TypeFamilies #-}
<span class="lineno">    2 </span>{-# LANGUAGE FlexibleContexts #-}
<span class="lineno">    3 </span>{-# LANGUAGE FlexibleInstances #-}
<span class="lineno">    4 </span>{-# LANGUAGE Rank2Types #-}
<span class="lineno">    5 </span>{-# LANGUAGE DataKinds #-}
<span class="lineno">    6 </span>
<span class="lineno">    7 </span>module ElmFormat.Render.Box where
<span class="lineno">    8 </span>
<span class="lineno">    9 </span>import Elm.Utils ((|&gt;))
<span class="lineno">   10 </span>import Box
<span class="lineno">   11 </span>import ElmVersion (ElmVersion(..))
<span class="lineno">   12 </span>
<span class="lineno">   13 </span>import AST.V0_16
<span class="lineno">   14 </span>import qualified AST.Module
<span class="lineno">   15 </span>import AST.Structure
<span class="lineno">   16 </span>import qualified AST.Listing
<span class="lineno">   17 </span>import qualified Cheapskate.Types as Markdown
<span class="lineno">   18 </span>import qualified Control.Monad as Monad
<span class="lineno">   19 </span>import qualified Data.Char as Char
<span class="lineno">   20 </span>import Data.Coapplicative
<span class="lineno">   21 </span>import qualified Data.Foldable as Foldable
<span class="lineno">   22 </span>import Data.Functor.Identity
<span class="lineno">   23 </span>import qualified Data.Indexed as I
<span class="lineno">   24 </span>import qualified Data.List as List
<span class="lineno">   25 </span>import Data.List.Extra
<span class="lineno">   26 </span>import qualified Data.Map.Strict as Map
<span class="lineno">   27 </span>import Data.Maybe (fromMaybe, maybeToList)
<span class="lineno">   28 </span>import qualified Data.Maybe as Maybe
<span class="lineno">   29 </span>import Data.ReversedList (Reversed)
<span class="lineno">   30 </span>import qualified Data.ReversedList as ReversedList
<span class="lineno">   31 </span>import Data.Set (Set)
<span class="lineno">   32 </span>import qualified Data.Set as Set
<span class="lineno">   33 </span>import Data.Text (Text)
<span class="lineno">   34 </span>import qualified Data.Text as Text
<span class="lineno">   35 </span>import ElmFormat.ImportInfo (ImportInfo)
<span class="lineno">   36 </span>import qualified ElmFormat.ImportInfo as ImportInfo
<span class="lineno">   37 </span>import qualified ElmFormat.Render.ElmStructure as ElmStructure
<span class="lineno">   38 </span>import qualified ElmFormat.Render.Markdown
<span class="lineno">   39 </span>import qualified ElmVersion
<span class="lineno">   40 </span>import qualified Parse.Parse as Parse
<span class="lineno">   41 </span>import qualified Reporting.Annotation as RA
<span class="lineno">   42 </span>import qualified Reporting.Region as Region
<span class="lineno">   43 </span>import qualified Reporting.Result as Result
<span class="lineno">   44 </span>import Text.Printf (printf)
<span class="lineno">   45 </span>
<span class="lineno">   46 </span>
<span class="lineno">   47 </span>pleaseReport'' :: String -&gt; String -&gt; String
<span class="lineno">   48 </span><span class="decl"><span class="nottickedoff">pleaseReport'' what details =</span>
<span class="lineno">   49 </span><span class="spaces">    </span><span class="nottickedoff">-- TODO: include version in the message</span>
<span class="lineno">   50 </span><span class="spaces">    </span><span class="nottickedoff">&quot;&lt;elm-format: &quot;++ what ++ &quot;: &quot; ++ details ++ &quot; -- please report this at https://github.com/avh4/elm-format/issues &gt;&quot;</span></span>
<span class="lineno">   51 </span>
<span class="lineno">   52 </span>
<span class="lineno">   53 </span>pleaseReport' :: String -&gt; String -&gt; Line
<span class="lineno">   54 </span><span class="decl"><span class="nottickedoff">pleaseReport' what details =</span>
<span class="lineno">   55 </span><span class="spaces">    </span><span class="nottickedoff">keyword $ pleaseReport'' what details</span></span>
<span class="lineno">   56 </span>
<span class="lineno">   57 </span>
<span class="lineno">   58 </span>pleaseReport :: String -&gt; String -&gt; Box
<span class="lineno">   59 </span><span class="decl"><span class="nottickedoff">pleaseReport what details =</span>
<span class="lineno">   60 </span><span class="spaces">    </span><span class="nottickedoff">line $ pleaseReport' what details</span></span>
<span class="lineno">   61 </span>
<span class="lineno">   62 </span>
<span class="lineno">   63 </span>surround :: Char -&gt; Char -&gt; Box -&gt; Box
<span class="lineno">   64 </span><span class="decl"><span class="istickedoff">surround left right b =</span>
<span class="lineno">   65 </span><span class="spaces">  </span><span class="istickedoff">let</span>
<span class="lineno">   66 </span><span class="spaces">    </span><span class="istickedoff">left' = punc (left : [])</span>
<span class="lineno">   67 </span><span class="spaces">    </span><span class="istickedoff">right' = punc (right : [])</span>
<span class="lineno">   68 </span><span class="spaces">  </span><span class="istickedoff">in</span>
<span class="lineno">   69 </span><span class="spaces">    </span><span class="istickedoff">case b of</span>
<span class="lineno">   70 </span><span class="spaces">      </span><span class="istickedoff">SingleLine b' -&gt;</span>
<span class="lineno">   71 </span><span class="spaces">          </span><span class="istickedoff">line $ row [ left', b', right' ]</span>
<span class="lineno">   72 </span><span class="spaces">      </span><span class="istickedoff">_ -&gt;</span>
<span class="lineno">   73 </span><span class="spaces">          </span><span class="istickedoff">stack1</span>
<span class="lineno">   74 </span><span class="spaces">              </span><span class="istickedoff">[ b</span>
<span class="lineno">   75 </span><span class="spaces">                  </span><span class="istickedoff">|&gt; prefix left'</span>
<span class="lineno">   76 </span><span class="spaces">              </span><span class="istickedoff">, line $ right'</span>
<span class="lineno">   77 </span><span class="spaces">              </span><span class="istickedoff">]</span></span>
<span class="lineno">   78 </span>
<span class="lineno">   79 </span>
<span class="lineno">   80 </span>parens :: Box -&gt; Box
<span class="lineno">   81 </span><span class="decl"><span class="istickedoff">parens = surround '(' ')'</span></span>
<span class="lineno">   82 </span>
<span class="lineno">   83 </span>
<span class="lineno">   84 </span>formatBinary :: Bool -&gt; Box -&gt; [ ( Bool, Comments, Box, Box ) ] -&gt; Box
<span class="lineno">   85 </span><span class="decl"><span class="istickedoff">formatBinary multiline left ops =</span>
<span class="lineno">   86 </span><span class="spaces">    </span><span class="istickedoff">case ops of</span>
<span class="lineno">   87 </span><span class="spaces">        </span><span class="istickedoff">[] -&gt;</span>
<span class="lineno">   88 </span><span class="spaces">            </span><span class="istickedoff">left</span>
<span class="lineno">   89 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">   90 </span><span class="spaces">        </span><span class="istickedoff">( isLeftPipe, comments, op, next ) : rest -&gt;</span>
<span class="lineno">   91 </span><span class="spaces">            </span><span class="istickedoff">if isLeftPipe then</span>
<span class="lineno">   92 </span><span class="spaces">                </span><span class="istickedoff">ElmStructure.forceableSpaceSepOrIndented multiline</span>
<span class="lineno">   93 </span><span class="spaces">                    </span><span class="istickedoff">(ElmStructure.spaceSepOrStack left $</span>
<span class="lineno">   94 </span><span class="spaces">                        </span><span class="istickedoff">concat</span>
<span class="lineno">   95 </span><span class="spaces">                            </span><span class="istickedoff">[ Maybe.maybeToList $ formatComments comments</span>
<span class="lineno">   96 </span><span class="spaces">                            </span><span class="istickedoff">, [op]</span>
<span class="lineno">   97 </span><span class="spaces">                            </span><span class="istickedoff">]</span>
<span class="lineno">   98 </span><span class="spaces">                    </span><span class="istickedoff">)</span>
<span class="lineno">   99 </span><span class="spaces">                    </span><span class="istickedoff">[formatBinary multiline next rest]</span>
<span class="lineno">  100 </span><span class="spaces">            </span><span class="istickedoff">else</span>
<span class="lineno">  101 </span><span class="spaces">                </span><span class="istickedoff">formatBinary</span>
<span class="lineno">  102 </span><span class="spaces">                    </span><span class="istickedoff">multiline</span>
<span class="lineno">  103 </span><span class="spaces">                    </span><span class="istickedoff">(ElmStructure.forceableSpaceSepOrIndented multiline left [formatCommented' comments id $ ElmStructure.spaceSepOrPrefix op next])</span>
<span class="lineno">  104 </span><span class="spaces">                    </span><span class="istickedoff">rest</span></span>
<span class="lineno">  105 </span>
<span class="lineno">  106 </span>
<span class="lineno">  107 </span>splitWhere :: (a -&gt; Bool) -&gt; [a] -&gt; [[a]]
<span class="lineno">  108 </span><span class="decl"><span class="nottickedoff">splitWhere predicate list =</span>
<span class="lineno">  109 </span><span class="spaces">    </span><span class="nottickedoff">let</span>
<span class="lineno">  110 </span><span class="spaces">        </span><span class="nottickedoff">merge acc result =</span>
<span class="lineno">  111 </span><span class="spaces">            </span><span class="nottickedoff">ReversedList.push (ReversedList.toList acc) result</span>
<span class="lineno">  112 </span><span class="spaces"></span><span class="nottickedoff"></span>
<span class="lineno">  113 </span><span class="spaces">        </span><span class="nottickedoff">step (acc,result) next =</span>
<span class="lineno">  114 </span><span class="spaces">            </span><span class="nottickedoff">if predicate next then</span>
<span class="lineno">  115 </span><span class="spaces">                </span><span class="nottickedoff">(ReversedList.empty, merge (ReversedList.push next acc) result)</span>
<span class="lineno">  116 </span><span class="spaces">            </span><span class="nottickedoff">else</span>
<span class="lineno">  117 </span><span class="spaces">                </span><span class="nottickedoff">(ReversedList.push next acc, result)</span>
<span class="lineno">  118 </span><span class="spaces">    </span><span class="nottickedoff">in</span>
<span class="lineno">  119 </span><span class="spaces">      </span><span class="nottickedoff">list</span>
<span class="lineno">  120 </span><span class="spaces">          </span><span class="nottickedoff">|&gt; foldl step (ReversedList.empty, ReversedList.empty)</span>
<span class="lineno">  121 </span><span class="spaces">          </span><span class="nottickedoff">|&gt; uncurry merge</span>
<span class="lineno">  122 </span><span class="spaces">          </span><span class="nottickedoff">|&gt; ReversedList.toList</span>
<span class="lineno">  123 </span><span class="spaces">          </span><span class="nottickedoff">|&gt; dropWhile null</span></span>
<span class="lineno">  124 </span>
<span class="lineno">  125 </span>
<span class="lineno">  126 </span>data DeclarationType
<span class="lineno">  127 </span>  = DComment
<span class="lineno">  128 </span>  | DStarter
<span class="lineno">  129 </span>  | DCloser
<span class="lineno">  130 </span>  | DDefinition (Maybe (Ref ()))
<span class="lineno">  131 </span>  | DFixity
<span class="lineno">  132 </span>  | DDocComment
<span class="lineno">  133 </span>  deriving (<span class="decl"><span class="nottickedoff">Show</span></span>)
<span class="lineno">  134 </span>
<span class="lineno">  135 </span>
<span class="lineno">  136 </span>declarationType :: (a -&gt; BodyEntryType) -&gt; TopLevelStructure a -&gt; DeclarationType
<span class="lineno">  137 </span><span class="decl"><span class="istickedoff">declarationType entryType decl =</span>
<span class="lineno">  138 </span><span class="spaces">  </span><span class="istickedoff">case decl of</span>
<span class="lineno">  139 </span><span class="spaces">    </span><span class="istickedoff">Entry entry -&gt;</span>
<span class="lineno">  140 </span><span class="spaces">        </span><span class="istickedoff">case entryType entry of</span>
<span class="lineno">  141 </span><span class="spaces">            </span><span class="istickedoff">BodyNamed name -&gt; DDefinition (Just name)</span>
<span class="lineno">  142 </span><span class="spaces">            </span><span class="istickedoff">BodyUnnamed -&gt; DDefinition Nothing</span>
<span class="lineno">  143 </span><span class="spaces">            </span><span class="istickedoff">BodyFixity -&gt; DFixity</span>
<span class="lineno">  144 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  145 </span><span class="spaces">    </span><span class="istickedoff">DocComment _ -&gt;</span>
<span class="lineno">  146 </span><span class="spaces">      </span><span class="istickedoff">DDocComment</span>
<span class="lineno">  147 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  148 </span><span class="spaces">    </span><span class="istickedoff">BodyComment CommentTrickOpener -&gt;</span>
<span class="lineno">  149 </span><span class="spaces">      </span><span class="istickedoff">DStarter</span>
<span class="lineno">  150 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  151 </span><span class="spaces">    </span><span class="istickedoff">BodyComment CommentTrickCloser -&gt;</span>
<span class="lineno">  152 </span><span class="spaces">      </span><span class="istickedoff">DCloser</span>
<span class="lineno">  153 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  154 </span><span class="spaces">    </span><span class="istickedoff">BodyComment _ -&gt;</span>
<span class="lineno">  155 </span><span class="spaces">      </span><span class="istickedoff">DComment</span></span>
<span class="lineno">  156 </span>
<span class="lineno">  157 </span>
<span class="lineno">  158 </span>removeDuplicates :: Ord a =&gt; [[a]] -&gt; [[a]]
<span class="lineno">  159 </span><span class="decl"><span class="istickedoff">removeDuplicates input =</span>
<span class="lineno">  160 </span><span class="spaces">    </span><span class="istickedoff">foldl step (ReversedList.empty, Set.empty) input |&gt; fst |&gt; ReversedList.toList</span>
<span class="lineno">  161 </span><span class="spaces">    </span><span class="istickedoff">where</span>
<span class="lineno">  162 </span><span class="spaces">        </span><span class="istickedoff">step :: Ord a =&gt; (Reversed [a], Set a) -&gt; [a] -&gt; (Reversed [a], Set a)</span>
<span class="lineno">  163 </span><span class="spaces">        </span><span class="istickedoff">step (acc, seen) next =</span>
<span class="lineno">  164 </span><span class="spaces">            </span><span class="istickedoff">case foldl stepChildren (ReversedList.empty, seen) next |&gt; (\(a,b) -&gt; (ReversedList.toList a, b)) of</span>
<span class="lineno">  165 </span><span class="spaces">                </span><span class="istickedoff">([], seen') -&gt; (acc, <span class="nottickedoff">seen'</span>)</span>
<span class="lineno">  166 </span><span class="spaces">                </span><span class="istickedoff">(children', seen') -&gt; (ReversedList.push children' acc, seen')</span>
<span class="lineno">  167 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  168 </span><span class="spaces">        </span><span class="istickedoff">stepChildren :: Ord a =&gt; (Reversed a, Set a) -&gt; a -&gt; (Reversed a, Set a)</span>
<span class="lineno">  169 </span><span class="spaces">        </span><span class="istickedoff">stepChildren (acc, seen) next =</span>
<span class="lineno">  170 </span><span class="spaces">            </span><span class="istickedoff">if Set.member next seen</span>
<span class="lineno">  171 </span><span class="spaces">                </span><span class="istickedoff">then (acc, <span class="nottickedoff">seen</span>)</span>
<span class="lineno">  172 </span><span class="spaces">                </span><span class="istickedoff">else (ReversedList.push next acc, Set.insert next seen)</span></span>
<span class="lineno">  173 </span>
<span class="lineno">  174 </span>
<span class="lineno">  175 </span>sortVars :: Bool -&gt; Set (C2 before after AST.Listing.Value) -&gt; [[String]] -&gt; ([[C2 before after AST.Listing.Value]], Comments)
<span class="lineno">  176 </span><span class="decl"><span class="istickedoff">sortVars forceMultiline fromExposing fromDocs =</span>
<span class="lineno">  177 </span><span class="spaces">    </span><span class="istickedoff">let</span>
<span class="lineno">  178 </span><span class="spaces">        </span><span class="istickedoff">varOrder :: Commented c AST.Listing.Value -&gt; (Int, String)</span>
<span class="lineno">  179 </span><span class="spaces">        </span><span class="istickedoff">varOrder (C _ (AST.Listing.OpValue (SymbolIdentifier name))) = (1, name)</span>
<span class="lineno">  180 </span><span class="spaces">        </span><span class="istickedoff">varOrder (C _ (AST.Listing.Union (C _ (UppercaseIdentifier name)) _)) = (2, name)</span>
<span class="lineno">  181 </span><span class="spaces">        </span><span class="istickedoff">varOrder (C _ (AST.Listing.Value (LowercaseIdentifier name))) = (3, name)</span>
<span class="lineno">  182 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  183 </span><span class="spaces">        </span><span class="istickedoff">listedInDocs =</span>
<span class="lineno">  184 </span><span class="spaces">            </span><span class="istickedoff">fromDocs</span>
<span class="lineno">  185 </span><span class="spaces">                </span><span class="istickedoff">|&gt; fmap (Maybe.mapMaybe (\v -&gt; Map.lookup v allowedInDocs))</span>
<span class="lineno">  186 </span><span class="spaces">                </span><span class="istickedoff">|&gt; filter (not . List.null)</span>
<span class="lineno">  187 </span><span class="spaces">                </span><span class="istickedoff">|&gt; fmap (fmap (\v -&gt; C ([], []) v))</span>
<span class="lineno">  188 </span><span class="spaces">                </span><span class="istickedoff">|&gt; removeDuplicates</span>
<span class="lineno">  189 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  190 </span><span class="spaces">        </span><span class="istickedoff">listedInExposing =</span>
<span class="lineno">  191 </span><span class="spaces">            </span><span class="istickedoff">fromExposing</span>
<span class="lineno">  192 </span><span class="spaces">                </span><span class="istickedoff">|&gt; Set.toList</span>
<span class="lineno">  193 </span><span class="spaces">                </span><span class="istickedoff">|&gt; List.sortOn varOrder</span>
<span class="lineno">  194 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  195 </span><span class="spaces">        </span><span class="istickedoff">varName (C _ (AST.Listing.Value (LowercaseIdentifier name))) = name</span>
<span class="lineno">  196 </span><span class="spaces">        </span><span class="istickedoff">varName (C _ (AST.Listing.OpValue (SymbolIdentifier name))) = name</span>
<span class="lineno">  197 </span><span class="spaces">        </span><span class="istickedoff">varName (C _ (AST.Listing.Union (C _ (UppercaseIdentifier name)) _)) = name</span>
<span class="lineno">  198 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  199 </span><span class="spaces">        </span><span class="istickedoff">varSetToMap set =</span>
<span class="lineno">  200 </span><span class="spaces">            </span><span class="istickedoff">Set.toList set</span>
<span class="lineno">  201 </span><span class="spaces">                </span><span class="istickedoff">|&gt; fmap (\(C c var)-&gt; (varName (C <span class="nottickedoff">c</span> var), var))</span>
<span class="lineno">  202 </span><span class="spaces">                </span><span class="istickedoff">|&gt; Map.fromList</span>
<span class="lineno">  203 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  204 </span><span class="spaces">        </span><span class="istickedoff">allowedInDocs =</span>
<span class="lineno">  205 </span><span class="spaces">            </span><span class="istickedoff">varSetToMap fromExposing</span>
<span class="lineno">  206 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  207 </span><span class="spaces">        </span><span class="istickedoff">allFromDocs =</span>
<span class="lineno">  208 </span><span class="spaces">            </span><span class="istickedoff">Set.fromList $ fmap varName $ concat listedInDocs</span>
<span class="lineno">  209 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  210 </span><span class="spaces">        </span><span class="istickedoff">inDocs x =</span>
<span class="lineno">  211 </span><span class="spaces">            </span><span class="istickedoff">Set.member (varName x) allFromDocs</span>
<span class="lineno">  212 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  213 </span><span class="spaces">        </span><span class="istickedoff">remainingFromExposing =</span>
<span class="lineno">  214 </span><span class="spaces">            </span><span class="istickedoff">listedInExposing</span>
<span class="lineno">  215 </span><span class="spaces">                </span><span class="istickedoff">|&gt; filter (not . inDocs)</span>
<span class="lineno">  216 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  217 </span><span class="spaces">        </span><span class="istickedoff">commentsFromReorderedVars =</span>
<span class="lineno">  218 </span><span class="spaces">            </span><span class="istickedoff">listedInExposing</span>
<span class="lineno">  219 </span><span class="spaces">                </span><span class="istickedoff">|&gt; filter inDocs</span>
<span class="lineno">  220 </span><span class="spaces">                </span><span class="istickedoff">|&gt; fmap (\(C (pre, post) _) -&gt; pre ++ post)</span>
<span class="lineno">  221 </span><span class="spaces">                </span><span class="istickedoff">|&gt; concat</span>
<span class="lineno">  222 </span><span class="spaces">    </span><span class="istickedoff">in</span>
<span class="lineno">  223 </span><span class="spaces">    </span><span class="istickedoff">if List.null listedInDocs &amp;&amp; forceMultiline</span>
<span class="lineno">  224 </span><span class="spaces">        </span><span class="istickedoff">then ( fmap (\x -&gt; [x]) remainingFromExposing, commentsFromReorderedVars )</span>
<span class="lineno">  225 </span><span class="spaces">        </span><span class="istickedoff">else ( listedInDocs ++ if List.null remainingFromExposing then [] else [ remainingFromExposing ], commentsFromReorderedVars )</span></span>
<span class="lineno">  226 </span>
<span class="lineno">  227 </span>
<span class="lineno">  228 </span>formatModuleHeader :: Coapplicative annf =&gt; ElmVersion -&gt; Bool -&gt; AST.Module.Module [UppercaseIdentifier] (ASTNS annf [UppercaseIdentifier] 'TopLevelNK) -&gt; [Box]
<span class="lineno">  229 </span><span class="decl"><span class="istickedoff">formatModuleHeader elmVersion addDefaultHeader modu =</span>
<span class="lineno">  230 </span><span class="spaces">  </span><span class="istickedoff">let</span>
<span class="lineno">  231 </span><span class="spaces">      </span><span class="istickedoff">maybeHeader =</span>
<span class="lineno">  232 </span><span class="spaces">        </span><span class="istickedoff">if addDefaultHeader</span>
<span class="lineno">  233 </span><span class="spaces">            </span><span class="istickedoff">then Just (AST.Module.header modu |&gt; Maybe.fromMaybe AST.Module.defaultHeader)</span>
<span class="lineno">  234 </span><span class="spaces">            </span><span class="istickedoff">else AST.Module.header modu</span>
<span class="lineno">  235 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  236 </span><span class="spaces">      </span><span class="istickedoff">refName (VarRef _ (LowercaseIdentifier name)) = name</span>
<span class="lineno">  237 </span><span class="spaces">      </span><span class="istickedoff">refName (TagRef _ (UppercaseIdentifier name)) = name</span>
<span class="lineno">  238 </span><span class="spaces">      </span><span class="istickedoff">refName (OpRef (SymbolIdentifier name)) = name</span>
<span class="lineno">  239 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  240 </span><span class="spaces">      </span><span class="istickedoff">varName (C _ (AST.Listing.Value (LowercaseIdentifier name))) = name</span>
<span class="lineno">  241 </span><span class="spaces">      </span><span class="istickedoff">varName (C _ (AST.Listing.OpValue (SymbolIdentifier name))) = <span class="nottickedoff">name</span></span>
<span class="lineno">  242 </span><span class="spaces">      </span><span class="istickedoff">varName (C _ (AST.Listing.Union (C _ (UppercaseIdentifier name)) _)) = name</span>
<span class="lineno">  243 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  244 </span><span class="spaces">      </span><span class="istickedoff">documentedVars :: [[String]]</span>
<span class="lineno">  245 </span><span class="spaces">      </span><span class="istickedoff">documentedVars =</span>
<span class="lineno">  246 </span><span class="spaces">          </span><span class="istickedoff">AST.Module.docs modu</span>
<span class="lineno">  247 </span><span class="spaces">              </span><span class="istickedoff">|&gt; extract</span>
<span class="lineno">  248 </span><span class="spaces">              </span><span class="istickedoff">|&gt; fmap Foldable.toList</span>
<span class="lineno">  249 </span><span class="spaces">              </span><span class="istickedoff">|&gt; Maybe.fromMaybe []</span>
<span class="lineno">  250 </span><span class="spaces">              </span><span class="istickedoff">|&gt; concatMap extractDocs</span>
<span class="lineno">  251 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  252 </span><span class="spaces">      </span><span class="istickedoff">documentedVarsSet :: Set String</span>
<span class="lineno">  253 </span><span class="spaces">      </span><span class="istickedoff">documentedVarsSet = Set.fromList $ concat documentedVars</span>
<span class="lineno">  254 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  255 </span><span class="spaces">      </span><span class="istickedoff">extractDocs block =</span>
<span class="lineno">  256 </span><span class="spaces">          </span><span class="istickedoff">case block of</span>
<span class="lineno">  257 </span><span class="spaces">              </span><span class="istickedoff">Markdown.ElmDocs vars -&gt;</span>
<span class="lineno">  258 </span><span class="spaces">                  </span><span class="istickedoff">fmap (fmap (refName . textToRef)) vars</span>
<span class="lineno">  259 </span><span class="spaces">              </span><span class="istickedoff">_ -&gt; []</span>
<span class="lineno">  260 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  261 </span><span class="spaces">      </span><span class="istickedoff">textToRef :: Text -&gt; Ref [UppercaseIdentifier]</span>
<span class="lineno">  262 </span><span class="spaces">      </span><span class="istickedoff">textToRef text =</span>
<span class="lineno">  263 </span><span class="spaces">          </span><span class="istickedoff">case Text.unpack text of</span>
<span class="lineno">  264 </span><span class="spaces">              </span><span class="istickedoff">s@(c:_) | Char.isUpper c -&gt; TagRef <span class="nottickedoff">[]</span> (UppercaseIdentifier s)</span>
<span class="lineno">  265 </span><span class="spaces">              </span><span class="istickedoff">s@(c:_) | Char.isLower c -&gt; VarRef <span class="nottickedoff">[]</span> (LowercaseIdentifier s)</span>
<span class="lineno">  266 </span><span class="spaces">              </span><span class="istickedoff">'(':a:')':[] -&gt; OpRef (SymbolIdentifier $ a:[])</span>
<span class="lineno">  267 </span><span class="spaces">              </span><span class="istickedoff">'(':a:b:')':[] -&gt; OpRef (SymbolIdentifier $ a:b:[])</span>
<span class="lineno">  268 </span><span class="spaces">              </span><span class="istickedoff">s -&gt; <span class="nottickedoff">VarRef [] (LowercaseIdentifier s)</span></span>
<span class="lineno">  269 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  270 </span><span class="spaces">      </span><span class="istickedoff">definedVars :: Set (C2 before after AST.Listing.Value)</span>
<span class="lineno">  271 </span><span class="spaces">      </span><span class="istickedoff">definedVars =</span>
<span class="lineno">  272 </span><span class="spaces">          </span><span class="istickedoff">AST.Module.body modu</span>
<span class="lineno">  273 </span><span class="spaces">              </span><span class="istickedoff">|&gt; (extract . I.unFix)</span>
<span class="lineno">  274 </span><span class="spaces">              </span><span class="istickedoff">|&gt; (\(TopLevel decls) -&gt; decls)</span>
<span class="lineno">  275 </span><span class="spaces">              </span><span class="istickedoff">|&gt; concatMap extractVarName</span>
<span class="lineno">  276 </span><span class="spaces">              </span><span class="istickedoff">|&gt; fmap (C ([], []))</span>
<span class="lineno">  277 </span><span class="spaces">              </span><span class="istickedoff">|&gt; Set.fromList</span>
<span class="lineno">  278 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  279 </span><span class="spaces">      </span><span class="istickedoff">exportsList =</span>
<span class="lineno">  280 </span><span class="spaces">          </span><span class="istickedoff">case</span>
<span class="lineno">  281 </span><span class="spaces">              </span><span class="istickedoff">AST.Module.exports (maybeHeader |&gt; Maybe.fromMaybe <span class="nottickedoff">AST.Module.defaultHeader</span>)</span>
<span class="lineno">  282 </span><span class="spaces">          </span><span class="istickedoff">of</span>
<span class="lineno">  283 </span><span class="spaces">              </span><span class="istickedoff">Just (C _ e) -&gt; e</span>
<span class="lineno">  284 </span><span class="spaces">              </span><span class="istickedoff">Nothing -&gt; AST.Listing.ClosedListing</span>
<span class="lineno">  285 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  286 </span><span class="spaces">      </span><span class="istickedoff">detailedListingToSet :: AST.Listing.Listing AST.Module.DetailedListing -&gt; Set (C2 before after AST.Listing.Value)</span>
<span class="lineno">  287 </span><span class="spaces">      </span><span class="istickedoff">detailedListingToSet (AST.Listing.OpenListing _) = Set.empty</span>
<span class="lineno">  288 </span><span class="spaces">      </span><span class="istickedoff">detailedListingToSet AST.Listing.ClosedListing = <span class="nottickedoff">Set.empty</span></span>
<span class="lineno">  289 </span><span class="spaces">      </span><span class="istickedoff">detailedListingToSet (AST.Listing.ExplicitListing (AST.Module.DetailedListing values operators types) _) =</span>
<span class="lineno">  290 </span><span class="spaces">          </span><span class="istickedoff">Set.unions</span>
<span class="lineno">  291 </span><span class="spaces">              </span><span class="istickedoff">[ Map.assocs values |&gt; fmap (\(name, C c ()) -&gt; C c (AST.Listing.Value name)) |&gt; Set.fromList</span>
<span class="lineno">  292 </span><span class="spaces">              </span><span class="istickedoff">, Map.assocs operators |&gt; fmap (\(name, C c ()) -&gt; C c (AST.Listing.OpValue name)) |&gt; Set.fromList</span>
<span class="lineno">  293 </span><span class="spaces">              </span><span class="istickedoff">, Map.assocs types |&gt; fmap (\(name, C c (C preListing listing)) -&gt; C c (AST.Listing.Union (C preListing name) listing)) |&gt; Set.fromList</span>
<span class="lineno">  294 </span><span class="spaces">              </span><span class="istickedoff">]</span>
<span class="lineno">  295 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  296 </span><span class="spaces">      </span><span class="istickedoff">detailedListingIsMultiline :: AST.Listing.Listing a -&gt; Bool</span>
<span class="lineno">  297 </span><span class="spaces">      </span><span class="istickedoff">detailedListingIsMultiline (AST.Listing.ExplicitListing _ isMultiline) = isMultiline</span>
<span class="lineno">  298 </span><span class="spaces">      </span><span class="istickedoff">detailedListingIsMultiline _ = False</span>
<span class="lineno">  299 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  300 </span><span class="spaces">      </span><span class="istickedoff">varsToExpose =</span>
<span class="lineno">  301 </span><span class="spaces">          </span><span class="istickedoff">case AST.Module.exports =&lt;&lt; maybeHeader of</span>
<span class="lineno">  302 </span><span class="spaces">              </span><span class="istickedoff">Nothing -&gt;</span>
<span class="lineno">  303 </span><span class="spaces">                  </span><span class="istickedoff">if null $ concat documentedVars</span>
<span class="lineno">  304 </span><span class="spaces">                      </span><span class="istickedoff">then definedVars</span>
<span class="lineno">  305 </span><span class="spaces">                      </span><span class="istickedoff">else definedVars |&gt; Set.filter (\v -&gt; Set.member (varName v) documentedVarsSet)</span>
<span class="lineno">  306 </span><span class="spaces">              </span><span class="istickedoff">Just (C _ e) -&gt; detailedListingToSet e</span>
<span class="lineno">  307 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  308 </span><span class="spaces">      </span><span class="istickedoff">sortedExports =</span>
<span class="lineno">  309 </span><span class="spaces">          </span><span class="istickedoff">sortVars</span>
<span class="lineno">  310 </span><span class="spaces">              </span><span class="istickedoff">(detailedListingIsMultiline exportsList)</span>
<span class="lineno">  311 </span><span class="spaces">              </span><span class="istickedoff">varsToExpose</span>
<span class="lineno">  312 </span><span class="spaces">              </span><span class="istickedoff">documentedVars</span>
<span class="lineno">  313 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  314 </span><span class="spaces">      </span><span class="istickedoff">extractVarName :: Coapplicative annf =&gt; TopLevelStructure (ASTNS annf ns 'TopLevelDeclarationNK) -&gt; [AST.Listing.Value]</span>
<span class="lineno">  315 </span><span class="spaces">      </span><span class="istickedoff">extractVarName decl =</span>
<span class="lineno">  316 </span><span class="spaces">          </span><span class="istickedoff">case fmap (extract . I.unFix) decl of</span>
<span class="lineno">  317 </span><span class="spaces">              </span><span class="istickedoff">DocComment _ -&gt; <span class="nottickedoff">[]</span></span>
<span class="lineno">  318 </span><span class="spaces">              </span><span class="istickedoff">BodyComment _ -&gt; []</span>
<span class="lineno">  319 </span><span class="spaces">              </span><span class="istickedoff">Entry (PortAnnotation (C _ (LowercaseIdentifier name)) _ _) -&gt; [ AST.Listing.Value (LowercaseIdentifier name) ]</span>
<span class="lineno">  320 </span><span class="spaces">              </span><span class="istickedoff">Entry (CommonDeclaration def) -&gt;</span>
<span class="lineno">  321 </span><span class="spaces">                </span><span class="istickedoff">case extract $ I.unFix def of</span>
<span class="lineno">  322 </span><span class="spaces">                    </span><span class="istickedoff">Definition pat _ _ _ -&gt;</span>
<span class="lineno">  323 </span><span class="spaces">                        </span><span class="istickedoff">case extract $ I.unFix pat of</span>
<span class="lineno">  324 </span><span class="spaces">                            </span><span class="istickedoff">VarPattern (LowercaseIdentifier name) -&gt; [ AST.Listing.Value (LowercaseIdentifier name) ]</span>
<span class="lineno">  325 </span><span class="spaces">                            </span><span class="istickedoff">RecordPattern fields -&gt; <span class="nottickedoff">fmap (AST.Listing.Value . extract) fields</span></span>
<span class="lineno">  326 </span><span class="spaces">                            </span><span class="istickedoff">_ -&gt; <span class="nottickedoff">[]</span></span>
<span class="lineno">  327 </span><span class="spaces">                    </span><span class="istickedoff">_ -&gt; []</span>
<span class="lineno">  328 </span><span class="spaces">              </span><span class="istickedoff">Entry (Datatype (C _ (NameWithArgs (UppercaseIdentifier name) _)) _) -&gt; [ AST.Listing.Union (C [] (UppercaseIdentifier name)) (AST.Listing.OpenListing <span class="nottickedoff">(C ([], []) ())</span>)]</span>
<span class="lineno">  329 </span><span class="spaces">              </span><span class="istickedoff">Entry (TypeAlias _ (C _ (NameWithArgs (UppercaseIdentifier name) _)) _) -&gt; [ AST.Listing.Union (C [] (UppercaseIdentifier name)) AST.Listing.ClosedListing ]</span>
<span class="lineno">  330 </span><span class="spaces">              </span><span class="istickedoff">Entry _ -&gt; <span class="nottickedoff">[]</span></span>
<span class="lineno">  331 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  332 </span><span class="spaces">      </span><span class="istickedoff">formatModuleLine' header@(AST.Module.Header srcTag name moduleSettings exports) =</span>
<span class="lineno">  333 </span><span class="spaces">        </span><span class="istickedoff">let</span>
<span class="lineno">  334 </span><span class="spaces">            </span><span class="istickedoff">(preExposing, postExposing) =</span>
<span class="lineno">  335 </span><span class="spaces">                </span><span class="istickedoff">case exports of</span>
<span class="lineno">  336 </span><span class="spaces">                    </span><span class="istickedoff">Nothing -&gt; ([], [])</span>
<span class="lineno">  337 </span><span class="spaces">                    </span><span class="istickedoff">Just (C (pre, post) _) -&gt; (pre, post)</span>
<span class="lineno">  338 </span><span class="spaces">        </span><span class="istickedoff">in</span>
<span class="lineno">  339 </span><span class="spaces">        </span><span class="istickedoff">case elmVersion of</span>
<span class="lineno">  340 </span><span class="spaces">          </span><span class="istickedoff">Elm_0_16 -&gt;</span>
<span class="lineno">  341 </span><span class="spaces">            </span><span class="istickedoff"><span class="nottickedoff">formatModuleLine_0_16 header</span></span>
<span class="lineno">  342 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  343 </span><span class="spaces">          </span><span class="istickedoff">Elm_0_17 -&gt;</span>
<span class="lineno">  344 </span><span class="spaces">            </span><span class="istickedoff">formatModuleLine elmVersion sortedExports srcTag name moduleSettings preExposing postExposing</span>
<span class="lineno">  345 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  346 </span><span class="spaces">          </span><span class="istickedoff">Elm_0_18 -&gt;</span>
<span class="lineno">  347 </span><span class="spaces">            </span><span class="istickedoff">formatModuleLine elmVersion sortedExports srcTag name moduleSettings preExposing postExposing</span>
<span class="lineno">  348 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  349 </span><span class="spaces">          </span><span class="istickedoff">Elm_0_19 -&gt;</span>
<span class="lineno">  350 </span><span class="spaces">              </span><span class="istickedoff">formatModuleLine elmVersion sortedExports srcTag name moduleSettings preExposing postExposing</span>
<span class="lineno">  351 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  352 </span><span class="spaces">      </span><span class="istickedoff">docs =</span>
<span class="lineno">  353 </span><span class="spaces">          </span><span class="istickedoff">fmap (formatDocComment elmVersion <span class="nottickedoff">(ImportInfo.fromModule mempty modu)</span>) $ extract $ AST.Module.docs modu</span>
<span class="lineno">  354 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  355 </span><span class="spaces">      </span><span class="istickedoff">imports =</span>
<span class="lineno">  356 </span><span class="spaces">          </span><span class="istickedoff">formatImports elmVersion modu</span>
<span class="lineno">  357 </span><span class="spaces">  </span><span class="istickedoff">in</span>
<span class="lineno">  358 </span><span class="spaces">  </span><span class="istickedoff">List.intercalate [ blankLine ] $ concat</span>
<span class="lineno">  359 </span><span class="spaces">      </span><span class="istickedoff">[ maybeToList $ fmap (return . formatModuleLine') maybeHeader</span>
<span class="lineno">  360 </span><span class="spaces">      </span><span class="istickedoff">, maybeToList $ fmap return docs</span>
<span class="lineno">  361 </span><span class="spaces">      </span><span class="istickedoff">, if null imports</span>
<span class="lineno">  362 </span><span class="spaces">          </span><span class="istickedoff">then []</span>
<span class="lineno">  363 </span><span class="spaces">          </span><span class="istickedoff">else [ imports ]</span>
<span class="lineno">  364 </span><span class="spaces">      </span><span class="istickedoff">]</span></span>
<span class="lineno">  365 </span>
<span class="lineno">  366 </span>
<span class="lineno">  367 </span>formatImports :: ElmVersion -&gt; AST.Module.Module [UppercaseIdentifier] decl -&gt; [Box]
<span class="lineno">  368 </span><span class="decl"><span class="istickedoff">formatImports elmVersion modu =</span>
<span class="lineno">  369 </span><span class="spaces">    </span><span class="istickedoff">let</span>
<span class="lineno">  370 </span><span class="spaces">        </span><span class="istickedoff">(C comments imports) =</span>
<span class="lineno">  371 </span><span class="spaces">            </span><span class="istickedoff">AST.Module.imports modu</span>
<span class="lineno">  372 </span><span class="spaces">    </span><span class="istickedoff">in</span>
<span class="lineno">  373 </span><span class="spaces">    </span><span class="istickedoff">[ formatComments comments</span>
<span class="lineno">  374 </span><span class="spaces">        </span><span class="istickedoff">|&gt; maybeToList</span>
<span class="lineno">  375 </span><span class="spaces">    </span><span class="istickedoff">, imports</span>
<span class="lineno">  376 </span><span class="spaces">        </span><span class="istickedoff">|&gt; Map.assocs</span>
<span class="lineno">  377 </span><span class="spaces">        </span><span class="istickedoff">|&gt; fmap (\(name, (C pre method)) -&gt; formatImport elmVersion (C pre name, method))</span>
<span class="lineno">  378 </span><span class="spaces">    </span><span class="istickedoff">]</span>
<span class="lineno">  379 </span><span class="spaces">        </span><span class="istickedoff">|&gt; List.filter (not . List.null)</span>
<span class="lineno">  380 </span><span class="spaces">        </span><span class="istickedoff">|&gt; List.intersperse [blankLine]</span>
<span class="lineno">  381 </span><span class="spaces">        </span><span class="istickedoff">|&gt; concat</span></span>
<span class="lineno">  382 </span>
<span class="lineno">  383 </span>
<span class="lineno">  384 </span>formatModuleLine_0_16 :: AST.Module.Header -&gt; Box
<span class="lineno">  385 </span><span class="decl"><span class="nottickedoff">formatModuleLine_0_16 header =</span>
<span class="lineno">  386 </span><span class="spaces">  </span><span class="nottickedoff">let</span>
<span class="lineno">  387 </span><span class="spaces">    </span><span class="nottickedoff">elmVersion = Elm_0_16</span>
<span class="lineno">  388 </span><span class="spaces"></span><span class="nottickedoff"></span>
<span class="lineno">  389 </span><span class="spaces">    </span><span class="nottickedoff">exports =</span>
<span class="lineno">  390 </span><span class="spaces">        </span><span class="nottickedoff">case AST.Module.exports header of</span>
<span class="lineno">  391 </span><span class="spaces">            </span><span class="nottickedoff">Just (C _ value) -&gt; value</span>
<span class="lineno">  392 </span><span class="spaces">            </span><span class="nottickedoff">Nothing -&gt; AST.Listing.OpenListing (C ([], []) ())</span>
<span class="lineno">  393 </span><span class="spaces"></span><span class="nottickedoff"></span>
<span class="lineno">  394 </span><span class="spaces">    </span><span class="nottickedoff">formatExports =</span>
<span class="lineno">  395 </span><span class="spaces">        </span><span class="nottickedoff">case formatListing (formatDetailedListing elmVersion) exports of</span>
<span class="lineno">  396 </span><span class="spaces">            </span><span class="nottickedoff">Just listing -&gt;</span>
<span class="lineno">  397 </span><span class="spaces">                </span><span class="nottickedoff">listing</span>
<span class="lineno">  398 </span><span class="spaces">            </span><span class="nottickedoff">_ -&gt;</span>
<span class="lineno">  399 </span><span class="spaces">                </span><span class="nottickedoff">pleaseReport &quot;UNEXPECTED MODULE DECLARATION&quot; &quot;empty listing&quot;</span>
<span class="lineno">  400 </span><span class="spaces"></span><span class="nottickedoff"></span>
<span class="lineno">  401 </span><span class="spaces">    </span><span class="nottickedoff">whereComments =</span>
<span class="lineno">  402 </span><span class="spaces">        </span><span class="nottickedoff">case AST.Module.exports header of</span>
<span class="lineno">  403 </span><span class="spaces">            </span><span class="nottickedoff">Nothing -&gt; ([], [])</span>
<span class="lineno">  404 </span><span class="spaces">            </span><span class="nottickedoff">Just (C (pre, post) _) -&gt; (pre, post)</span>
<span class="lineno">  405 </span><span class="spaces"></span><span class="nottickedoff"></span>
<span class="lineno">  406 </span><span class="spaces">    </span><span class="nottickedoff">whereClause =</span>
<span class="lineno">  407 </span><span class="spaces">        </span><span class="nottickedoff">formatCommented (line . keyword) (C whereComments &quot;where&quot;)</span>
<span class="lineno">  408 </span><span class="spaces">  </span><span class="nottickedoff">in</span>
<span class="lineno">  409 </span><span class="spaces">    </span><span class="nottickedoff">case</span>
<span class="lineno">  410 </span><span class="spaces">      </span><span class="nottickedoff">( formatCommented (line . formatQualifiedUppercaseIdentifier elmVersion) $ AST.Module.name header</span>
<span class="lineno">  411 </span><span class="spaces">      </span><span class="nottickedoff">, formatExports</span>
<span class="lineno">  412 </span><span class="spaces">      </span><span class="nottickedoff">, whereClause</span>
<span class="lineno">  413 </span><span class="spaces">      </span><span class="nottickedoff">)</span>
<span class="lineno">  414 </span><span class="spaces">    </span><span class="nottickedoff">of</span>
<span class="lineno">  415 </span><span class="spaces">      </span><span class="nottickedoff">(SingleLine name', SingleLine exports', SingleLine where') -&gt;</span>
<span class="lineno">  416 </span><span class="spaces">        </span><span class="nottickedoff">line $ row</span>
<span class="lineno">  417 </span><span class="spaces">          </span><span class="nottickedoff">[ keyword &quot;module&quot;</span>
<span class="lineno">  418 </span><span class="spaces">          </span><span class="nottickedoff">, space</span>
<span class="lineno">  419 </span><span class="spaces">          </span><span class="nottickedoff">, name'</span>
<span class="lineno">  420 </span><span class="spaces">          </span><span class="nottickedoff">, row [ space, exports' ]</span>
<span class="lineno">  421 </span><span class="spaces">          </span><span class="nottickedoff">, space</span>
<span class="lineno">  422 </span><span class="spaces">          </span><span class="nottickedoff">, where'</span>
<span class="lineno">  423 </span><span class="spaces">          </span><span class="nottickedoff">]</span>
<span class="lineno">  424 </span><span class="spaces">      </span><span class="nottickedoff">(name', exports', _) -&gt;</span>
<span class="lineno">  425 </span><span class="spaces">        </span><span class="nottickedoff">stack1</span>
<span class="lineno">  426 </span><span class="spaces">          </span><span class="nottickedoff">[ line $ keyword &quot;module&quot;</span>
<span class="lineno">  427 </span><span class="spaces">          </span><span class="nottickedoff">, indent $ name'</span>
<span class="lineno">  428 </span><span class="spaces">          </span><span class="nottickedoff">, indent $ exports'</span>
<span class="lineno">  429 </span><span class="spaces">          </span><span class="nottickedoff">, indent $ whereClause</span>
<span class="lineno">  430 </span><span class="spaces">          </span><span class="nottickedoff">]</span></span>
<span class="lineno">  431 </span>
<span class="lineno">  432 </span>
<span class="lineno">  433 </span>formatModuleLine ::
<span class="lineno">  434 </span>    ElmVersion
<span class="lineno">  435 </span>    -&gt; ([[C2 before after AST.Listing.Value]], Comments)
<span class="lineno">  436 </span>    -&gt; AST.Module.SourceTag
<span class="lineno">  437 </span>    -&gt; C2 before after [UppercaseIdentifier]
<span class="lineno">  438 </span>    -&gt; Maybe (C2 before after AST.Module.SourceSettings)
<span class="lineno">  439 </span>    -&gt; Comments
<span class="lineno">  440 </span>    -&gt; Comments
<span class="lineno">  441 </span>    -&gt; Box
<span class="lineno">  442 </span><span class="decl"><span class="istickedoff">formatModuleLine elmVersion (varsToExpose, extraComments) srcTag name moduleSettings preExposing postExposing =</span>
<span class="lineno">  443 </span><span class="spaces">  </span><span class="istickedoff">let</span>
<span class="lineno">  444 </span><span class="spaces">    </span><span class="istickedoff">tag =</span>
<span class="lineno">  445 </span><span class="spaces">      </span><span class="istickedoff">case srcTag of</span>
<span class="lineno">  446 </span><span class="spaces">        </span><span class="istickedoff">AST.Module.Normal -&gt;</span>
<span class="lineno">  447 </span><span class="spaces">          </span><span class="istickedoff">line $ keyword &quot;module&quot;</span>
<span class="lineno">  448 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  449 </span><span class="spaces">        </span><span class="istickedoff">AST.Module.Port comments -&gt;</span>
<span class="lineno">  450 </span><span class="spaces">          </span><span class="istickedoff">ElmStructure.spaceSepOrIndented</span>
<span class="lineno">  451 </span><span class="spaces">            </span><span class="istickedoff">(formatTailCommented (line . keyword) (C comments &quot;port&quot;))</span>
<span class="lineno">  452 </span><span class="spaces">            </span><span class="istickedoff">[ line $ keyword &quot;module&quot; ]</span>
<span class="lineno">  453 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  454 </span><span class="spaces">        </span><span class="istickedoff">AST.Module.Effect comments -&gt;</span>
<span class="lineno">  455 </span><span class="spaces">          </span><span class="istickedoff">ElmStructure.spaceSepOrIndented</span>
<span class="lineno">  456 </span><span class="spaces">            </span><span class="istickedoff">(formatTailCommented (line . keyword) (C comments &quot;effect&quot;))</span>
<span class="lineno">  457 </span><span class="spaces">            </span><span class="istickedoff">[ line $ keyword &quot;module&quot; ]</span>
<span class="lineno">  458 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  459 </span><span class="spaces">    </span><span class="istickedoff">exports =</span>
<span class="lineno">  460 </span><span class="spaces">          </span><span class="istickedoff">case varsToExpose of</span>
<span class="lineno">  461 </span><span class="spaces">              </span><span class="istickedoff">[] -&gt; line $ keyword &quot;(..)&quot;</span>
<span class="lineno">  462 </span><span class="spaces">              </span><span class="istickedoff">[oneGroup] -&gt;</span>
<span class="lineno">  463 </span><span class="spaces">                  </span><span class="istickedoff">oneGroup</span>
<span class="lineno">  464 </span><span class="spaces">                      </span><span class="istickedoff">|&gt; fmap (formatCommented $ formatVarValue elmVersion)</span>
<span class="lineno">  465 </span><span class="spaces">                      </span><span class="istickedoff">|&gt; ElmStructure.group' False &quot;(&quot; &quot;,&quot; (maybeToList (formatComments extraComments)) &quot;)&quot; False</span>
<span class="lineno">  466 </span><span class="spaces">              </span><span class="istickedoff">_ -&gt;</span>
<span class="lineno">  467 </span><span class="spaces">                  </span><span class="istickedoff">varsToExpose</span>
<span class="lineno">  468 </span><span class="spaces">                      </span><span class="istickedoff">|&gt; fmap (ElmStructure.group False &quot;&quot; &quot;,&quot; &quot;&quot; False . fmap (formatCommented $ formatVarValue elmVersion))</span>
<span class="lineno">  469 </span><span class="spaces">                      </span><span class="istickedoff">|&gt; ElmStructure.group' <span class="nottickedoff">False</span> &quot;(&quot; &quot;,&quot; (maybeToList (formatComments extraComments)) &quot;)&quot; True</span>
<span class="lineno">  470 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  471 </span><span class="spaces">    </span><span class="istickedoff">formatSetting (k, v) =</span>
<span class="lineno">  472 </span><span class="spaces">      </span><span class="istickedoff">formatRecordPair elmVersion &quot;=&quot; (line . formatUppercaseIdentifier elmVersion) (k, v, False)</span>
<span class="lineno">  473 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  474 </span><span class="spaces">    </span><span class="istickedoff">formatSettings settings =</span>
<span class="lineno">  475 </span><span class="spaces">      </span><span class="istickedoff">map formatSetting settings</span>
<span class="lineno">  476 </span><span class="spaces">        </span><span class="istickedoff">|&gt; ElmStructure.group True &quot;{&quot; &quot;,&quot; &quot;}&quot; False</span>
<span class="lineno">  477 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  478 </span><span class="spaces">    </span><span class="istickedoff">whereClause =</span>
<span class="lineno">  479 </span><span class="spaces">      </span><span class="istickedoff">moduleSettings</span>
<span class="lineno">  480 </span><span class="spaces">        </span><span class="istickedoff">|&gt; fmap (formatKeywordCommented &quot;where&quot; formatSettings)</span>
<span class="lineno">  481 </span><span class="spaces">        </span><span class="istickedoff">|&gt; fmap (\x -&gt; [x])</span>
<span class="lineno">  482 </span><span class="spaces">        </span><span class="istickedoff">|&gt; Maybe.fromMaybe []</span>
<span class="lineno">  483 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  484 </span><span class="spaces">    </span><span class="istickedoff">nameClause =</span>
<span class="lineno">  485 </span><span class="spaces">      </span><span class="istickedoff">case</span>
<span class="lineno">  486 </span><span class="spaces">        </span><span class="istickedoff">( tag</span>
<span class="lineno">  487 </span><span class="spaces">        </span><span class="istickedoff">, formatCommented (line . formatQualifiedUppercaseIdentifier elmVersion) name</span>
<span class="lineno">  488 </span><span class="spaces">        </span><span class="istickedoff">)</span>
<span class="lineno">  489 </span><span class="spaces">      </span><span class="istickedoff">of</span>
<span class="lineno">  490 </span><span class="spaces">        </span><span class="istickedoff">(SingleLine tag', SingleLine name') -&gt;</span>
<span class="lineno">  491 </span><span class="spaces">          </span><span class="istickedoff">line $ row</span>
<span class="lineno">  492 </span><span class="spaces">            </span><span class="istickedoff">[ tag'</span>
<span class="lineno">  493 </span><span class="spaces">            </span><span class="istickedoff">, space</span>
<span class="lineno">  494 </span><span class="spaces">            </span><span class="istickedoff">, name'</span>
<span class="lineno">  495 </span><span class="spaces">            </span><span class="istickedoff">]</span>
<span class="lineno">  496 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  497 </span><span class="spaces">        </span><span class="istickedoff">(tag', name') -&gt;</span>
<span class="lineno">  498 </span><span class="spaces">          </span><span class="istickedoff">stack1</span>
<span class="lineno">  499 </span><span class="spaces">            </span><span class="istickedoff">[ tag'</span>
<span class="lineno">  500 </span><span class="spaces">            </span><span class="istickedoff">, indent $ name'</span>
<span class="lineno">  501 </span><span class="spaces">            </span><span class="istickedoff">]</span>
<span class="lineno">  502 </span><span class="spaces">  </span><span class="istickedoff">in</span>
<span class="lineno">  503 </span><span class="spaces">  </span><span class="istickedoff">ElmStructure.spaceSepOrIndented</span>
<span class="lineno">  504 </span><span class="spaces">      </span><span class="istickedoff">(ElmStructure.spaceSepOrIndented</span>
<span class="lineno">  505 </span><span class="spaces">          </span><span class="istickedoff">nameClause</span>
<span class="lineno">  506 </span><span class="spaces">          </span><span class="istickedoff">(whereClause ++ [formatCommented (line . keyword) (C (preExposing, postExposing) &quot;exposing&quot;)])</span>
<span class="lineno">  507 </span><span class="spaces">      </span><span class="istickedoff">)</span>
<span class="lineno">  508 </span><span class="spaces">      </span><span class="istickedoff">[ exports ]</span></span>
<span class="lineno">  509 </span>
<span class="lineno">  510 </span>
<span class="lineno">  511 </span>formatModule :: Coapplicative annf =&gt; ElmVersion -&gt; Bool -&gt; Int -&gt; AST.Module.Module [UppercaseIdentifier] (ASTNS annf [UppercaseIdentifier] 'TopLevelNK) -&gt; Box
<span class="lineno">  512 </span><span class="decl"><span class="istickedoff">formatModule elmVersion addDefaultHeader spacing modu =</span>
<span class="lineno">  513 </span><span class="spaces">    </span><span class="istickedoff">let</span>
<span class="lineno">  514 </span><span class="spaces">        </span><span class="istickedoff">initialComments' =</span>
<span class="lineno">  515 </span><span class="spaces">          </span><span class="istickedoff">case AST.Module.initialComments modu of</span>
<span class="lineno">  516 </span><span class="spaces">            </span><span class="istickedoff">[] -&gt;</span>
<span class="lineno">  517 </span><span class="spaces">              </span><span class="istickedoff">[]</span>
<span class="lineno">  518 </span><span class="spaces">            </span><span class="istickedoff">comments -&gt;</span>
<span class="lineno">  519 </span><span class="spaces">              </span><span class="istickedoff">(map formatComment comments)</span>
<span class="lineno">  520 </span><span class="spaces">                </span><span class="istickedoff">++ [ blankLine, blankLine ]</span>
<span class="lineno">  521 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  522 </span><span class="spaces">        </span><span class="istickedoff">spaceBeforeBody =</span>
<span class="lineno">  523 </span><span class="spaces">            </span><span class="istickedoff">case extract $ I.unFix $ AST.Module.body modu of</span>
<span class="lineno">  524 </span><span class="spaces">                </span><span class="istickedoff">TopLevel [] -&gt; 0</span>
<span class="lineno">  525 </span><span class="spaces">                </span><span class="istickedoff">TopLevel (BodyComment _ : _) -&gt; spacing + 1</span>
<span class="lineno">  526 </span><span class="spaces">                </span><span class="istickedoff">TopLevel _ -&gt; spacing</span>
<span class="lineno">  527 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  528 </span><span class="spaces">        </span><span class="istickedoff">decls =</span>
<span class="lineno">  529 </span><span class="spaces">          </span><span class="istickedoff">case extract $ I.unFix $ AST.Module.body modu of</span>
<span class="lineno">  530 </span><span class="spaces">              </span><span class="istickedoff">TopLevel decls -&gt; decls</span>
<span class="lineno">  531 </span><span class="spaces">    </span><span class="istickedoff">in</span>
<span class="lineno">  532 </span><span class="spaces">      </span><span class="istickedoff">stack1 $</span>
<span class="lineno">  533 </span><span class="spaces">          </span><span class="istickedoff">concat</span>
<span class="lineno">  534 </span><span class="spaces">              </span><span class="istickedoff">[ initialComments'</span>
<span class="lineno">  535 </span><span class="spaces">              </span><span class="istickedoff">, formatModuleHeader elmVersion addDefaultHeader modu</span>
<span class="lineno">  536 </span><span class="spaces">              </span><span class="istickedoff">, List.replicate spaceBeforeBody blankLine</span>
<span class="lineno">  537 </span><span class="spaces">              </span><span class="istickedoff">, maybeToList $ formatModuleBody spacing elmVersion <span class="nottickedoff">(ImportInfo.fromModule mempty modu)</span> decls</span>
<span class="lineno">  538 </span><span class="spaces">              </span><span class="istickedoff">]</span></span>
<span class="lineno">  539 </span>
<span class="lineno">  540 </span>
<span class="lineno">  541 </span>formatModuleBody :: forall annf. Coapplicative annf =&gt; Int -&gt; ElmVersion -&gt; ImportInfo [UppercaseIdentifier] -&gt; [TopLevelStructure (ASTNS annf [UppercaseIdentifier] 'TopLevelDeclarationNK)] -&gt; Maybe Box
<span class="lineno">  542 </span><span class="decl"><span class="istickedoff">formatModuleBody linesBetween elmVersion importInfo body =</span>
<span class="lineno">  543 </span><span class="spaces">    </span><span class="istickedoff">let</span>
<span class="lineno">  544 </span><span class="spaces">        </span><span class="istickedoff">entryType :: ASTNS annf ns 'TopLevelDeclarationNK -&gt; BodyEntryType</span>
<span class="lineno">  545 </span><span class="spaces">        </span><span class="istickedoff">entryType adecl =</span>
<span class="lineno">  546 </span><span class="spaces">            </span><span class="istickedoff">case extract $ I.unFix adecl of</span>
<span class="lineno">  547 </span><span class="spaces">                </span><span class="istickedoff">CommonDeclaration def -&gt;</span>
<span class="lineno">  548 </span><span class="spaces">                    </span><span class="istickedoff">case extract $ I.unFix def of</span>
<span class="lineno">  549 </span><span class="spaces">                        </span><span class="istickedoff">Definition pat _ _ _ -&gt;</span>
<span class="lineno">  550 </span><span class="spaces">                            </span><span class="istickedoff">case extract $ I.unFix pat of</span>
<span class="lineno">  551 </span><span class="spaces">                                </span><span class="istickedoff">VarPattern name -&gt;</span>
<span class="lineno">  552 </span><span class="spaces">                                    </span><span class="istickedoff">BodyNamed $ VarRef () name</span>
<span class="lineno">  553 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  554 </span><span class="spaces">                                </span><span class="istickedoff">OpPattern name -&gt;</span>
<span class="lineno">  555 </span><span class="spaces">                                    </span><span class="istickedoff">BodyNamed $ OpRef name</span>
<span class="lineno">  556 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  557 </span><span class="spaces">                                </span><span class="istickedoff">_ -&gt;</span>
<span class="lineno">  558 </span><span class="spaces">                                    </span><span class="istickedoff">BodyUnnamed</span>
<span class="lineno">  559 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  560 </span><span class="spaces">                        </span><span class="istickedoff">TypeAnnotation (C _ name) _ -&gt;</span>
<span class="lineno">  561 </span><span class="spaces">                            </span><span class="istickedoff">BodyNamed name</span>
<span class="lineno">  562 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  563 </span><span class="spaces">                </span><span class="istickedoff">Datatype (C _ (NameWithArgs name _)) _ -&gt;</span>
<span class="lineno">  564 </span><span class="spaces">                    </span><span class="istickedoff">BodyNamed $ TagRef () name</span>
<span class="lineno">  565 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  566 </span><span class="spaces">                </span><span class="istickedoff">TypeAlias _ (C _ (NameWithArgs name _)) _ -&gt;</span>
<span class="lineno">  567 </span><span class="spaces">                    </span><span class="istickedoff">BodyNamed $ TagRef () name</span>
<span class="lineno">  568 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  569 </span><span class="spaces">                </span><span class="istickedoff">PortDefinition_until_0_16 (C _ name) _ _ -&gt;</span>
<span class="lineno">  570 </span><span class="spaces">                    </span><span class="istickedoff">BodyNamed $ VarRef () name</span>
<span class="lineno">  571 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  572 </span><span class="spaces">                </span><span class="istickedoff">PortAnnotation (C _ name) _ _ -&gt;</span>
<span class="lineno">  573 </span><span class="spaces">                    </span><span class="istickedoff">BodyNamed $ VarRef () name</span>
<span class="lineno">  574 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  575 </span><span class="spaces">                </span><span class="istickedoff">Fixity_until_0_18 _ _ _ _ _ -&gt;</span>
<span class="lineno">  576 </span><span class="spaces">                    </span><span class="istickedoff">BodyFixity</span>
<span class="lineno">  577 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  578 </span><span class="spaces">                </span><span class="istickedoff">Fixity _ _ _ _ -&gt;</span>
<span class="lineno">  579 </span><span class="spaces">                    </span><span class="istickedoff">BodyFixity</span>
<span class="lineno">  580 </span><span class="spaces">    </span><span class="istickedoff">in</span>
<span class="lineno">  581 </span><span class="spaces">    </span><span class="istickedoff">formatTopLevelBody linesBetween elmVersion <span class="nottickedoff">importInfo</span> entryType (formatDeclaration elmVersion <span class="nottickedoff">importInfo</span>) body</span></span>
<span class="lineno">  582 </span>
<span class="lineno">  583 </span>
<span class="lineno">  584 </span>data BodyEntryType
<span class="lineno">  585 </span>    = BodyNamed (Ref ())
<span class="lineno">  586 </span>    | BodyUnnamed
<span class="lineno">  587 </span>    | BodyFixity
<span class="lineno">  588 </span>
<span class="lineno">  589 </span>
<span class="lineno">  590 </span>formatTopLevelBody ::
<span class="lineno">  591 </span>    Int
<span class="lineno">  592 </span>    -&gt; ElmVersion
<span class="lineno">  593 </span>    -&gt; ImportInfo [UppercaseIdentifier]
<span class="lineno">  594 </span>    -&gt; (a -&gt; BodyEntryType)
<span class="lineno">  595 </span>    -&gt; (a -&gt; Box)
<span class="lineno">  596 </span>    -&gt; [TopLevelStructure a]
<span class="lineno">  597 </span>    -&gt; Maybe Box
<span class="lineno">  598 </span><span class="decl"><span class="istickedoff">formatTopLevelBody linesBetween elmVersion importInfo entryType formatEntry body =</span>
<span class="lineno">  599 </span><span class="spaces">    </span><span class="istickedoff">let</span>
<span class="lineno">  600 </span><span class="spaces">        </span><span class="istickedoff">extraLines n =</span>
<span class="lineno">  601 </span><span class="spaces">            </span><span class="istickedoff">List.replicate n blankLine</span>
<span class="lineno">  602 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  603 </span><span class="spaces">        </span><span class="istickedoff">spacer first second =</span>
<span class="lineno">  604 </span><span class="spaces">            </span><span class="istickedoff">case (declarationType entryType first, declarationType entryType second) of</span>
<span class="lineno">  605 </span><span class="spaces">                </span><span class="istickedoff">(DStarter, _) -&gt; 0</span>
<span class="lineno">  606 </span><span class="spaces">                </span><span class="istickedoff">(_, DCloser) -&gt; 0</span>
<span class="lineno">  607 </span><span class="spaces">                </span><span class="istickedoff">(DComment, DComment) -&gt; 0</span>
<span class="lineno">  608 </span><span class="spaces">                </span><span class="istickedoff">(_, DComment) -&gt; if linesBetween == 1 then 1 else linesBetween + 1</span>
<span class="lineno">  609 </span><span class="spaces">                </span><span class="istickedoff">(DComment, DDefinition _) -&gt; if linesBetween == 1 then 0 else linesBetween</span>
<span class="lineno">  610 </span><span class="spaces">                </span><span class="istickedoff">(DComment, _) -&gt; linesBetween</span>
<span class="lineno">  611 </span><span class="spaces">                </span><span class="istickedoff">(DDocComment, DDefinition _) -&gt; 0</span>
<span class="lineno">  612 </span><span class="spaces">                </span><span class="istickedoff">(DDefinition Nothing, DDefinition (Just _)) -&gt; linesBetween</span>
<span class="lineno">  613 </span><span class="spaces">                </span><span class="istickedoff">(DDefinition _, DStarter) -&gt; linesBetween</span>
<span class="lineno">  614 </span><span class="spaces">                </span><span class="istickedoff">(DDefinition Nothing, DDefinition Nothing) -&gt; linesBetween</span>
<span class="lineno">  615 </span><span class="spaces">                </span><span class="istickedoff">(DDefinition a, DDefinition b) -&gt;</span>
<span class="lineno">  616 </span><span class="spaces">                    </span><span class="istickedoff">if a == b</span>
<span class="lineno">  617 </span><span class="spaces">                        </span><span class="istickedoff">then 0</span>
<span class="lineno">  618 </span><span class="spaces">                        </span><span class="istickedoff">else linesBetween</span>
<span class="lineno">  619 </span><span class="spaces">                </span><span class="istickedoff">(DCloser, _) -&gt; <span class="nottickedoff">linesBetween</span></span>
<span class="lineno">  620 </span><span class="spaces">                </span><span class="istickedoff">(_, DDocComment) -&gt; linesBetween</span>
<span class="lineno">  621 </span><span class="spaces">                </span><span class="istickedoff">(DDocComment, DStarter) -&gt; <span class="nottickedoff">0</span></span>
<span class="lineno">  622 </span><span class="spaces">                </span><span class="istickedoff">(DFixity, DFixity) -&gt; 0</span>
<span class="lineno">  623 </span><span class="spaces">                </span><span class="istickedoff">(DFixity, _) -&gt; linesBetween</span>
<span class="lineno">  624 </span><span class="spaces">                </span><span class="istickedoff">(_, DFixity) -&gt; linesBetween</span>
<span class="lineno">  625 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  626 </span><span class="spaces">        </span><span class="istickedoff">boxes =</span>
<span class="lineno">  627 </span><span class="spaces">            </span><span class="istickedoff">intersperseMap (\a b -&gt; extraLines $ spacer a b)</span>
<span class="lineno">  628 </span><span class="spaces">                </span><span class="istickedoff">(formatTopLevelStructure elmVersion <span class="nottickedoff">importInfo</span> formatEntry)</span>
<span class="lineno">  629 </span><span class="spaces">                </span><span class="istickedoff">body</span>
<span class="lineno">  630 </span><span class="spaces">    </span><span class="istickedoff">in</span>
<span class="lineno">  631 </span><span class="spaces">        </span><span class="istickedoff">case boxes of</span>
<span class="lineno">  632 </span><span class="spaces">            </span><span class="istickedoff">[] -&gt; Nothing</span>
<span class="lineno">  633 </span><span class="spaces">            </span><span class="istickedoff">_ -&gt; Just $ stack1 boxes</span></span>
<span class="lineno">  634 </span>
<span class="lineno">  635 </span>
<span class="lineno">  636 </span>data ElmCodeBlock annf ns
<span class="lineno">  637 </span>    = DeclarationsCode [TopLevelStructure (ASTNS annf ns 'TopLevelDeclarationNK)]
<span class="lineno">  638 </span>    | ExpressionsCode [TopLevelStructure (C0Eol (ASTNS annf ns 'ExpressionNK))]
<span class="lineno">  639 </span>    | ModuleCode (AST.Module.Module ns (ASTNS annf ns 'TopLevelNK))
<span class="lineno">  640 </span>
<span class="lineno">  641 </span>convertElmCodeBlock :: Functor ann =&gt; (forall x. ann x -&gt; ann' x) -&gt; ElmCodeBlock ann ns -&gt; ElmCodeBlock ann' ns
<span class="lineno">  642 </span><span class="decl"><span class="istickedoff">convertElmCodeBlock f = \case</span>
<span class="lineno">  643 </span><span class="spaces">    </span><span class="istickedoff">DeclarationsCode decls -&gt; DeclarationsCode (fmap (fmap $ I.convert f) decls)</span>
<span class="lineno">  644 </span><span class="spaces">    </span><span class="istickedoff">ExpressionsCode exprs -&gt; ExpressionsCode (fmap (fmap $ fmap $ I.convert f) exprs)</span>
<span class="lineno">  645 </span><span class="spaces">    </span><span class="istickedoff">ModuleCode mod -&gt; ModuleCode (fmap (I.convert f) mod)</span></span>
<span class="lineno">  646 </span>
<span class="lineno">  647 </span>
<span class="lineno">  648 </span>-- TODO: there must be an existing haskell function that does this, right?
<span class="lineno">  649 </span>firstOf :: [a -&gt; Maybe b] -&gt; a -&gt; Maybe b
<span class="lineno">  650 </span><span class="decl"><span class="istickedoff">firstOf options value =</span>
<span class="lineno">  651 </span><span class="spaces">    </span><span class="istickedoff">case options of</span>
<span class="lineno">  652 </span><span class="spaces">        </span><span class="istickedoff">[] -&gt; Nothing</span>
<span class="lineno">  653 </span><span class="spaces">        </span><span class="istickedoff">(next:rest) -&gt;</span>
<span class="lineno">  654 </span><span class="spaces">            </span><span class="istickedoff">case next value of</span>
<span class="lineno">  655 </span><span class="spaces">                </span><span class="istickedoff">Just result -&gt; Just result</span>
<span class="lineno">  656 </span><span class="spaces">                </span><span class="istickedoff">Nothing -&gt; firstOf rest value</span></span>
<span class="lineno">  657 </span>
<span class="lineno">  658 </span>
<span class="lineno">  659 </span>formatDocComment :: ElmVersion -&gt; ImportInfo [UppercaseIdentifier] -&gt; Markdown.Blocks -&gt; Box
<span class="lineno">  660 </span><span class="decl"><span class="istickedoff">formatDocComment elmVersion importInfo blocks =</span>
<span class="lineno">  661 </span><span class="spaces">    </span><span class="istickedoff">let</span>
<span class="lineno">  662 </span><span class="spaces">        </span><span class="istickedoff">parse :: String -&gt; Maybe (ElmCodeBlock Identity [UppercaseIdentifier])</span>
<span class="lineno">  663 </span><span class="spaces">        </span><span class="istickedoff">parse source =</span>
<span class="lineno">  664 </span><span class="spaces">            </span><span class="istickedoff">source</span>
<span class="lineno">  665 </span><span class="spaces">                </span><span class="istickedoff">|&gt; firstOf</span>
<span class="lineno">  666 </span><span class="spaces">                    </span><span class="istickedoff">[ fmap DeclarationsCode . Result.toMaybe . Parse.parseDeclarations elmVersion</span>
<span class="lineno">  667 </span><span class="spaces">                    </span><span class="istickedoff">, fmap ExpressionsCode . Result.toMaybe . Parse.parseExpressions elmVersion</span>
<span class="lineno">  668 </span><span class="spaces">                    </span><span class="istickedoff">, fmap ModuleCode . Result.toMaybe . Parse.parseModule elmVersion</span>
<span class="lineno">  669 </span><span class="spaces">                    </span><span class="istickedoff">]</span>
<span class="lineno">  670 </span><span class="spaces">                </span><span class="istickedoff">|&gt; fmap (convertElmCodeBlock (pure . extract))</span>
<span class="lineno">  671 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  672 </span><span class="spaces">        </span><span class="istickedoff">format ::</span>
<span class="lineno">  673 </span><span class="spaces">            </span><span class="istickedoff">(Applicative annf, Coapplicative annf) =&gt;</span>
<span class="lineno">  674 </span><span class="spaces">            </span><span class="istickedoff">ElmCodeBlock annf [UppercaseIdentifier] -&gt; String</span>
<span class="lineno">  675 </span><span class="spaces">        </span><span class="istickedoff">format result =</span>
<span class="lineno">  676 </span><span class="spaces">            </span><span class="istickedoff">case result of</span>
<span class="lineno">  677 </span><span class="spaces">                </span><span class="istickedoff">ModuleCode modu -&gt;</span>
<span class="lineno">  678 </span><span class="spaces">                    </span><span class="istickedoff">formatModule elmVersion False 1 modu</span>
<span class="lineno">  679 </span><span class="spaces">                        </span><span class="istickedoff">|&gt; (Text.unpack . Box.render)</span>
<span class="lineno">  680 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  681 </span><span class="spaces">                </span><span class="istickedoff">DeclarationsCode declarations -&gt;</span>
<span class="lineno">  682 </span><span class="spaces">                    </span><span class="istickedoff">formatModuleBody 1 elmVersion <span class="nottickedoff">importInfo</span> declarations</span>
<span class="lineno">  683 </span><span class="spaces">                        </span><span class="istickedoff">|&gt; fmap (Text.unpack . Box.render)</span>
<span class="lineno">  684 </span><span class="spaces">                        </span><span class="istickedoff">|&gt; fromMaybe <span class="nottickedoff">&quot;&quot;</span></span>
<span class="lineno">  685 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  686 </span><span class="spaces">                </span><span class="istickedoff">ExpressionsCode expressions -&gt;</span>
<span class="lineno">  687 </span><span class="spaces">                    </span><span class="istickedoff">let</span>
<span class="lineno">  688 </span><span class="spaces">                        </span><span class="istickedoff">entryType _ = BodyUnnamed</span>
<span class="lineno">  689 </span><span class="spaces">                    </span><span class="istickedoff">in</span>
<span class="lineno">  690 </span><span class="spaces">                    </span><span class="istickedoff">expressions</span>
<span class="lineno">  691 </span><span class="spaces">                        </span><span class="istickedoff">|&gt; fmap (fmap $ fmap $ I.convert (Identity . extract))</span>
<span class="lineno">  692 </span><span class="spaces">                        </span><span class="istickedoff">|&gt; formatTopLevelBody 1 <span class="nottickedoff">elmVersion</span> <span class="nottickedoff">importInfo</span> entryType (formatEolCommented $ formatExpression elmVersion <span class="nottickedoff">importInfo</span> SyntaxSeparated)</span>
<span class="lineno">  693 </span><span class="spaces">                        </span><span class="istickedoff">|&gt; fmap (Text.unpack . Box.render)</span>
<span class="lineno">  694 </span><span class="spaces">                        </span><span class="istickedoff">|&gt; fromMaybe <span class="nottickedoff">&quot;&quot;</span></span>
<span class="lineno">  695 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  696 </span><span class="spaces">        </span><span class="istickedoff">content :: String</span>
<span class="lineno">  697 </span><span class="spaces">        </span><span class="istickedoff">content =</span>
<span class="lineno">  698 </span><span class="spaces">            </span><span class="istickedoff">ElmFormat.Render.Markdown.formatMarkdown (fmap format . parse) $ fmap cleanBlock blocks</span>
<span class="lineno">  699 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  700 </span><span class="spaces">        </span><span class="istickedoff">cleanBlock :: Markdown.Block -&gt; Markdown.Block</span>
<span class="lineno">  701 </span><span class="spaces">        </span><span class="istickedoff">cleanBlock block =</span>
<span class="lineno">  702 </span><span class="spaces">            </span><span class="istickedoff">case block of</span>
<span class="lineno">  703 </span><span class="spaces">                </span><span class="istickedoff">Markdown.ElmDocs docs -&gt;</span>
<span class="lineno">  704 </span><span class="spaces">                    </span><span class="istickedoff">Markdown.ElmDocs $</span>
<span class="lineno">  705 </span><span class="spaces">                        </span><span class="istickedoff">(fmap . fmap)</span>
<span class="lineno">  706 </span><span class="spaces">                            </span><span class="istickedoff">(Text.replace (Text.pack &quot;(..)&quot;) (Text.pack &quot;&quot;))</span>
<span class="lineno">  707 </span><span class="spaces">                            </span><span class="istickedoff">docs</span>
<span class="lineno">  708 </span><span class="spaces">                </span><span class="istickedoff">_ -&gt;</span>
<span class="lineno">  709 </span><span class="spaces">                    </span><span class="istickedoff">block</span>
<span class="lineno">  710 </span><span class="spaces">    </span><span class="istickedoff">in</span>
<span class="lineno">  711 </span><span class="spaces">    </span><span class="istickedoff">formatDocCommentString content</span></span>
<span class="lineno">  712 </span>
<span class="lineno">  713 </span>
<span class="lineno">  714 </span>formatDocCommentString :: String -&gt; Box
<span class="lineno">  715 </span><span class="decl"><span class="istickedoff">formatDocCommentString docs =</span>
<span class="lineno">  716 </span><span class="spaces">    </span><span class="istickedoff">case lines docs of</span>
<span class="lineno">  717 </span><span class="spaces">        </span><span class="istickedoff">[] -&gt;</span>
<span class="lineno">  718 </span><span class="spaces">            </span><span class="istickedoff">line $ row [ punc &quot;{-|&quot;, space, punc &quot;-}&quot; ]</span>
<span class="lineno">  719 </span><span class="spaces">        </span><span class="istickedoff">(first:[]) -&gt;</span>
<span class="lineno">  720 </span><span class="spaces">            </span><span class="istickedoff">stack1</span>
<span class="lineno">  721 </span><span class="spaces">                </span><span class="istickedoff">[ line $ row [ punc &quot;{-|&quot;, space, literal first ]</span>
<span class="lineno">  722 </span><span class="spaces">                </span><span class="istickedoff">, line $ punc &quot;-}&quot;</span>
<span class="lineno">  723 </span><span class="spaces">                </span><span class="istickedoff">]</span>
<span class="lineno">  724 </span><span class="spaces">        </span><span class="istickedoff">(first:rest) -&gt;</span>
<span class="lineno">  725 </span><span class="spaces">            </span><span class="istickedoff">(line $ row [ punc &quot;{-|&quot;, space, literal first ])</span>
<span class="lineno">  726 </span><span class="spaces">                </span><span class="istickedoff">|&gt; andThen (map (line . literal) rest)</span>
<span class="lineno">  727 </span><span class="spaces">                </span><span class="istickedoff">|&gt; andThen [ line $ punc &quot;-}&quot; ]</span></span>
<span class="lineno">  728 </span>
<span class="lineno">  729 </span>
<span class="lineno">  730 </span>formatImport :: ElmVersion -&gt; AST.Module.UserImport -&gt; Box
<span class="lineno">  731 </span><span class="decl"><span class="istickedoff">formatImport elmVersion (name@(C _ rawName), method) =</span>
<span class="lineno">  732 </span><span class="spaces">    </span><span class="istickedoff">let</span>
<span class="lineno">  733 </span><span class="spaces">        </span><span class="istickedoff">requestedAs =</span>
<span class="lineno">  734 </span><span class="spaces">            </span><span class="istickedoff">case AST.Module.alias method of</span>
<span class="lineno">  735 </span><span class="spaces">                </span><span class="istickedoff">Just (C _ aliasName) | [aliasName] == rawName -&gt; Nothing</span>
<span class="lineno">  736 </span><span class="spaces">                </span><span class="istickedoff">other -&gt; other</span>
<span class="lineno">  737 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  738 </span><span class="spaces">        </span><span class="istickedoff">as =</span>
<span class="lineno">  739 </span><span class="spaces">            </span><span class="istickedoff">requestedAs</span>
<span class="lineno">  740 </span><span class="spaces">                </span><span class="istickedoff">|&gt; fmap (formatImportClause</span>
<span class="lineno">  741 </span><span class="spaces">                </span><span class="istickedoff">(Just . line . formatUppercaseIdentifier elmVersion)</span>
<span class="lineno">  742 </span><span class="spaces">                </span><span class="istickedoff">&quot;as&quot;)</span>
<span class="lineno">  743 </span><span class="spaces">                </span><span class="istickedoff">|&gt; Monad.join</span>
<span class="lineno">  744 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  745 </span><span class="spaces">        </span><span class="istickedoff">exposing =</span>
<span class="lineno">  746 </span><span class="spaces">          </span><span class="istickedoff">formatImportClause</span>
<span class="lineno">  747 </span><span class="spaces">            </span><span class="istickedoff">(formatListing (formatDetailedListing elmVersion))</span>
<span class="lineno">  748 </span><span class="spaces">            </span><span class="istickedoff">&quot;exposing&quot;</span>
<span class="lineno">  749 </span><span class="spaces">            </span><span class="istickedoff">(AST.Module.exposedVars method)</span>
<span class="lineno">  750 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  751 </span><span class="spaces">        </span><span class="istickedoff">formatImportClause :: (a -&gt; Maybe Box) -&gt; String -&gt; C2 beforeKeyword afterKeyword a -&gt; Maybe Box</span>
<span class="lineno">  752 </span><span class="spaces">        </span><span class="istickedoff">formatImportClause format keyw input =</span>
<span class="lineno">  753 </span><span class="spaces">          </span><span class="istickedoff">case fmap format input of</span>
<span class="lineno">  754 </span><span class="spaces">            </span><span class="istickedoff">C ([], []) Nothing -&gt;</span>
<span class="lineno">  755 </span><span class="spaces">              </span><span class="istickedoff">Nothing</span>
<span class="lineno">  756 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  757 </span><span class="spaces">            </span><span class="istickedoff">C (preKeyword, postKeyword) (Just listing') -&gt;</span>
<span class="lineno">  758 </span><span class="spaces">              </span><span class="istickedoff">case</span>
<span class="lineno">  759 </span><span class="spaces">                </span><span class="istickedoff">( formatHeadCommented (line . keyword) (C preKeyword keyw)</span>
<span class="lineno">  760 </span><span class="spaces">                </span><span class="istickedoff">, formatHeadCommented id (C postKeyword listing')</span>
<span class="lineno">  761 </span><span class="spaces">                </span><span class="istickedoff">)</span>
<span class="lineno">  762 </span><span class="spaces">              </span><span class="istickedoff">of</span>
<span class="lineno">  763 </span><span class="spaces">                </span><span class="istickedoff">(SingleLine keyword', SingleLine listing'') -&gt;</span>
<span class="lineno">  764 </span><span class="spaces">                  </span><span class="istickedoff">Just $ line $ row</span>
<span class="lineno">  765 </span><span class="spaces">                    </span><span class="istickedoff">[ keyword'</span>
<span class="lineno">  766 </span><span class="spaces">                    </span><span class="istickedoff">, space</span>
<span class="lineno">  767 </span><span class="spaces">                    </span><span class="istickedoff">, listing''</span>
<span class="lineno">  768 </span><span class="spaces">                    </span><span class="istickedoff">]</span>
<span class="lineno">  769 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  770 </span><span class="spaces">                </span><span class="istickedoff">(keyword', listing'') -&gt;</span>
<span class="lineno">  771 </span><span class="spaces">                  </span><span class="istickedoff">Just $ stack1</span>
<span class="lineno">  772 </span><span class="spaces">                    </span><span class="istickedoff">[ keyword'</span>
<span class="lineno">  773 </span><span class="spaces">                    </span><span class="istickedoff">, indent listing''</span>
<span class="lineno">  774 </span><span class="spaces">                    </span><span class="istickedoff">]</span>
<span class="lineno">  775 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  776 </span><span class="spaces">            </span><span class="istickedoff">_ -&gt;</span>
<span class="lineno">  777 </span><span class="spaces">              </span><span class="istickedoff"><span class="nottickedoff">Just $ pleaseReport &quot;UNEXPECTED IMPORT&quot; &quot;import clause comments with no clause&quot;</span></span>
<span class="lineno">  778 </span><span class="spaces">    </span><span class="istickedoff">in</span>
<span class="lineno">  779 </span><span class="spaces">    </span><span class="istickedoff">case</span>
<span class="lineno">  780 </span><span class="spaces">        </span><span class="istickedoff">( formatHeadCommented (line . formatQualifiedUppercaseIdentifier elmVersion) name</span>
<span class="lineno">  781 </span><span class="spaces">        </span><span class="istickedoff">, as</span>
<span class="lineno">  782 </span><span class="spaces">        </span><span class="istickedoff">, exposing</span>
<span class="lineno">  783 </span><span class="spaces">        </span><span class="istickedoff">)</span>
<span class="lineno">  784 </span><span class="spaces">    </span><span class="istickedoff">of</span>
<span class="lineno">  785 </span><span class="spaces">        </span><span class="istickedoff">( SingleLine name', Just (SingleLine as'), Just (SingleLine exposing') ) -&gt;</span>
<span class="lineno">  786 </span><span class="spaces">          </span><span class="istickedoff">line $ row</span>
<span class="lineno">  787 </span><span class="spaces">            </span><span class="istickedoff">[ keyword &quot;import&quot;</span>
<span class="lineno">  788 </span><span class="spaces">            </span><span class="istickedoff">, space</span>
<span class="lineno">  789 </span><span class="spaces">            </span><span class="istickedoff">, name'</span>
<span class="lineno">  790 </span><span class="spaces">            </span><span class="istickedoff">, space</span>
<span class="lineno">  791 </span><span class="spaces">            </span><span class="istickedoff">, as'</span>
<span class="lineno">  792 </span><span class="spaces">            </span><span class="istickedoff">, space</span>
<span class="lineno">  793 </span><span class="spaces">            </span><span class="istickedoff">, exposing'</span>
<span class="lineno">  794 </span><span class="spaces">            </span><span class="istickedoff">]</span>
<span class="lineno">  795 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  796 </span><span class="spaces">        </span><span class="istickedoff">(SingleLine name', Just (SingleLine as'), Nothing) -&gt;</span>
<span class="lineno">  797 </span><span class="spaces">          </span><span class="istickedoff">line $ row</span>
<span class="lineno">  798 </span><span class="spaces">            </span><span class="istickedoff">[ keyword &quot;import&quot;</span>
<span class="lineno">  799 </span><span class="spaces">            </span><span class="istickedoff">, space</span>
<span class="lineno">  800 </span><span class="spaces">            </span><span class="istickedoff">, name'</span>
<span class="lineno">  801 </span><span class="spaces">            </span><span class="istickedoff">, space</span>
<span class="lineno">  802 </span><span class="spaces">            </span><span class="istickedoff">, as'</span>
<span class="lineno">  803 </span><span class="spaces">            </span><span class="istickedoff">]</span>
<span class="lineno">  804 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  805 </span><span class="spaces">        </span><span class="istickedoff">(SingleLine name', Nothing, Just (SingleLine exposing')) -&gt;</span>
<span class="lineno">  806 </span><span class="spaces">          </span><span class="istickedoff">line $ row</span>
<span class="lineno">  807 </span><span class="spaces">            </span><span class="istickedoff">[ keyword &quot;import&quot;</span>
<span class="lineno">  808 </span><span class="spaces">            </span><span class="istickedoff">, space</span>
<span class="lineno">  809 </span><span class="spaces">            </span><span class="istickedoff">, name'</span>
<span class="lineno">  810 </span><span class="spaces">            </span><span class="istickedoff">, space</span>
<span class="lineno">  811 </span><span class="spaces">            </span><span class="istickedoff">, exposing'</span>
<span class="lineno">  812 </span><span class="spaces">            </span><span class="istickedoff">]</span>
<span class="lineno">  813 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  814 </span><span class="spaces">        </span><span class="istickedoff">(SingleLine name', Nothing, Nothing) -&gt;</span>
<span class="lineno">  815 </span><span class="spaces">          </span><span class="istickedoff">line $ row</span>
<span class="lineno">  816 </span><span class="spaces">            </span><span class="istickedoff">[ keyword &quot;import&quot;</span>
<span class="lineno">  817 </span><span class="spaces">            </span><span class="istickedoff">, space</span>
<span class="lineno">  818 </span><span class="spaces">            </span><span class="istickedoff">, name'</span>
<span class="lineno">  819 </span><span class="spaces">            </span><span class="istickedoff">]</span>
<span class="lineno">  820 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  821 </span><span class="spaces">        </span><span class="istickedoff">( SingleLine name', Just (SingleLine as'), Just exposing' ) -&gt;</span>
<span class="lineno">  822 </span><span class="spaces">          </span><span class="istickedoff">stack1</span>
<span class="lineno">  823 </span><span class="spaces">            </span><span class="istickedoff">[ line $ row</span>
<span class="lineno">  824 </span><span class="spaces">              </span><span class="istickedoff">[ keyword &quot;import&quot;</span>
<span class="lineno">  825 </span><span class="spaces">              </span><span class="istickedoff">, space</span>
<span class="lineno">  826 </span><span class="spaces">              </span><span class="istickedoff">, name'</span>
<span class="lineno">  827 </span><span class="spaces">              </span><span class="istickedoff">, space</span>
<span class="lineno">  828 </span><span class="spaces">              </span><span class="istickedoff">, as'</span>
<span class="lineno">  829 </span><span class="spaces">              </span><span class="istickedoff">]</span>
<span class="lineno">  830 </span><span class="spaces">            </span><span class="istickedoff">, indent exposing'</span>
<span class="lineno">  831 </span><span class="spaces">            </span><span class="istickedoff">]</span>
<span class="lineno">  832 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  833 </span><span class="spaces">        </span><span class="istickedoff">( SingleLine name', Just as', Just exposing' ) -&gt;</span>
<span class="lineno">  834 </span><span class="spaces">          </span><span class="istickedoff"><span class="nottickedoff">stack1</span></span>
<span class="lineno">  835 </span><span class="spaces">            </span><span class="istickedoff"><span class="nottickedoff">[ line $ row</span></span>
<span class="lineno">  836 </span><span class="spaces">              </span><span class="istickedoff"><span class="nottickedoff">[ keyword &quot;import&quot;</span></span>
<span class="lineno">  837 </span><span class="spaces">              </span><span class="istickedoff"><span class="nottickedoff">, space</span></span>
<span class="lineno">  838 </span><span class="spaces">              </span><span class="istickedoff"><span class="nottickedoff">, name'</span></span>
<span class="lineno">  839 </span><span class="spaces">              </span><span class="istickedoff"><span class="nottickedoff">]</span></span>
<span class="lineno">  840 </span><span class="spaces">            </span><span class="istickedoff"><span class="nottickedoff">, indent as'</span></span>
<span class="lineno">  841 </span><span class="spaces">            </span><span class="istickedoff"><span class="nottickedoff">, indent exposing'</span></span>
<span class="lineno">  842 </span><span class="spaces">            </span><span class="istickedoff"><span class="nottickedoff">]</span></span>
<span class="lineno">  843 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  844 </span><span class="spaces">        </span><span class="istickedoff">( SingleLine name', Nothing, Just exposing' ) -&gt;</span>
<span class="lineno">  845 </span><span class="spaces">          </span><span class="istickedoff">stack1</span>
<span class="lineno">  846 </span><span class="spaces">            </span><span class="istickedoff">[ line $ row</span>
<span class="lineno">  847 </span><span class="spaces">              </span><span class="istickedoff">[ keyword &quot;import&quot;</span>
<span class="lineno">  848 </span><span class="spaces">              </span><span class="istickedoff">, space</span>
<span class="lineno">  849 </span><span class="spaces">              </span><span class="istickedoff">, name'</span>
<span class="lineno">  850 </span><span class="spaces">              </span><span class="istickedoff">]</span>
<span class="lineno">  851 </span><span class="spaces">            </span><span class="istickedoff">, indent exposing'</span>
<span class="lineno">  852 </span><span class="spaces">            </span><span class="istickedoff">]</span>
<span class="lineno">  853 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  854 </span><span class="spaces">        </span><span class="istickedoff">( name', Just as', Just exposing' ) -&gt;</span>
<span class="lineno">  855 </span><span class="spaces">          </span><span class="istickedoff"><span class="nottickedoff">stack1</span></span>
<span class="lineno">  856 </span><span class="spaces">            </span><span class="istickedoff"><span class="nottickedoff">[ line $ keyword &quot;import&quot;</span></span>
<span class="lineno">  857 </span><span class="spaces">            </span><span class="istickedoff"><span class="nottickedoff">, indent name'</span></span>
<span class="lineno">  858 </span><span class="spaces">            </span><span class="istickedoff"><span class="nottickedoff">, indent $ indent as'</span></span>
<span class="lineno">  859 </span><span class="spaces">            </span><span class="istickedoff"><span class="nottickedoff">, indent $ indent exposing'</span></span>
<span class="lineno">  860 </span><span class="spaces">            </span><span class="istickedoff"><span class="nottickedoff">]</span></span>
<span class="lineno">  861 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  862 </span><span class="spaces">        </span><span class="istickedoff">( name', Nothing, Just exposing' ) -&gt;</span>
<span class="lineno">  863 </span><span class="spaces">          </span><span class="istickedoff">stack1</span>
<span class="lineno">  864 </span><span class="spaces">            </span><span class="istickedoff">[ line $ keyword &quot;import&quot;</span>
<span class="lineno">  865 </span><span class="spaces">            </span><span class="istickedoff">, indent name'</span>
<span class="lineno">  866 </span><span class="spaces">            </span><span class="istickedoff">, indent $ indent exposing'</span>
<span class="lineno">  867 </span><span class="spaces">            </span><span class="istickedoff">]</span>
<span class="lineno">  868 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  869 </span><span class="spaces">        </span><span class="istickedoff">( name', Just as', Nothing ) -&gt;</span>
<span class="lineno">  870 </span><span class="spaces">          </span><span class="istickedoff">stack1</span>
<span class="lineno">  871 </span><span class="spaces">            </span><span class="istickedoff">[ line $ keyword &quot;import&quot;</span>
<span class="lineno">  872 </span><span class="spaces">            </span><span class="istickedoff">, indent name'</span>
<span class="lineno">  873 </span><span class="spaces">            </span><span class="istickedoff">, indent $ indent as'</span>
<span class="lineno">  874 </span><span class="spaces">            </span><span class="istickedoff">]</span>
<span class="lineno">  875 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  876 </span><span class="spaces">        </span><span class="istickedoff">( name', Nothing, Nothing ) -&gt;</span>
<span class="lineno">  877 </span><span class="spaces">          </span><span class="istickedoff">stack1</span>
<span class="lineno">  878 </span><span class="spaces">            </span><span class="istickedoff">[ line $ keyword &quot;import&quot;</span>
<span class="lineno">  879 </span><span class="spaces">            </span><span class="istickedoff">, indent name'</span>
<span class="lineno">  880 </span><span class="spaces">            </span><span class="istickedoff">]</span></span>
<span class="lineno">  881 </span>
<span class="lineno">  882 </span>
<span class="lineno">  883 </span>formatListing :: (a -&gt; [Box]) -&gt; AST.Listing.Listing a -&gt; Maybe Box
<span class="lineno">  884 </span><span class="decl"><span class="istickedoff">formatListing format listing =</span>
<span class="lineno">  885 </span><span class="spaces">    </span><span class="istickedoff">case listing of</span>
<span class="lineno">  886 </span><span class="spaces">        </span><span class="istickedoff">AST.Listing.ClosedListing -&gt;</span>
<span class="lineno">  887 </span><span class="spaces">            </span><span class="istickedoff">Nothing</span>
<span class="lineno">  888 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  889 </span><span class="spaces">        </span><span class="istickedoff">AST.Listing.OpenListing comments -&gt;</span>
<span class="lineno">  890 </span><span class="spaces">            </span><span class="istickedoff">Just $ parens $ formatCommented (line . keyword) $ fmap (const &quot;..&quot;) comments</span>
<span class="lineno">  891 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  892 </span><span class="spaces">        </span><span class="istickedoff">AST.Listing.ExplicitListing vars multiline -&gt;</span>
<span class="lineno">  893 </span><span class="spaces">            </span><span class="istickedoff">case format vars of</span>
<span class="lineno">  894 </span><span class="spaces">                </span><span class="istickedoff">[] -&gt; <span class="nottickedoff">Nothing</span></span>
<span class="lineno">  895 </span><span class="spaces">                </span><span class="istickedoff">vars' -&gt; Just $ ElmStructure.group False &quot;(&quot; &quot;,&quot; &quot;)&quot; multiline vars'</span></span>
<span class="lineno">  896 </span>
<span class="lineno">  897 </span>
<span class="lineno">  898 </span>formatDetailedListing :: ElmVersion -&gt; AST.Module.DetailedListing -&gt; [Box]
<span class="lineno">  899 </span><span class="decl"><span class="istickedoff">formatDetailedListing elmVersion listing =</span>
<span class="lineno">  900 </span><span class="spaces">    </span><span class="istickedoff">concat</span>
<span class="lineno">  901 </span><span class="spaces">        </span><span class="istickedoff">[ formatCommentedMap</span>
<span class="lineno">  902 </span><span class="spaces">            </span><span class="istickedoff">(\name () -&gt; AST.Listing.OpValue name)</span>
<span class="lineno">  903 </span><span class="spaces">            </span><span class="istickedoff">(formatVarValue <span class="nottickedoff">elmVersion</span>)</span>
<span class="lineno">  904 </span><span class="spaces">            </span><span class="istickedoff">(AST.Module.operators listing)</span>
<span class="lineno">  905 </span><span class="spaces">        </span><span class="istickedoff">, formatCommentedMap</span>
<span class="lineno">  906 </span><span class="spaces">            </span><span class="istickedoff">(\name (C inner listing_) -&gt; AST.Listing.Union (C inner name) listing_)</span>
<span class="lineno">  907 </span><span class="spaces">            </span><span class="istickedoff">(formatVarValue elmVersion)</span>
<span class="lineno">  908 </span><span class="spaces">            </span><span class="istickedoff">(AST.Module.types listing)</span>
<span class="lineno">  909 </span><span class="spaces">        </span><span class="istickedoff">, formatCommentedMap</span>
<span class="lineno">  910 </span><span class="spaces">            </span><span class="istickedoff">(\name () -&gt; AST.Listing.Value name)</span>
<span class="lineno">  911 </span><span class="spaces">            </span><span class="istickedoff">(formatVarValue elmVersion)</span>
<span class="lineno">  912 </span><span class="spaces">            </span><span class="istickedoff">(AST.Module.values listing)</span>
<span class="lineno">  913 </span><span class="spaces">        </span><span class="istickedoff">]</span></span>
<span class="lineno">  914 </span>
<span class="lineno">  915 </span>
<span class="lineno">  916 </span>formatCommentedMap :: (k -&gt; v -&gt; a) -&gt; (a -&gt; Box) -&gt;  AST.Listing.CommentedMap k v -&gt; [Box]
<span class="lineno">  917 </span><span class="decl"><span class="istickedoff">formatCommentedMap construct format values =</span>
<span class="lineno">  918 </span><span class="spaces">    </span><span class="istickedoff">let</span>
<span class="lineno">  919 </span><span class="spaces">        </span><span class="istickedoff">format' (k, C c v)</span>
<span class="lineno">  920 </span><span class="spaces">            </span><span class="istickedoff">= formatCommented format $ C c (construct k v)</span>
<span class="lineno">  921 </span><span class="spaces">    </span><span class="istickedoff">in</span>
<span class="lineno">  922 </span><span class="spaces">    </span><span class="istickedoff">values</span>
<span class="lineno">  923 </span><span class="spaces">        </span><span class="istickedoff">|&gt; Map.assocs</span>
<span class="lineno">  924 </span><span class="spaces">        </span><span class="istickedoff">|&gt; map format'</span></span>
<span class="lineno">  925 </span>
<span class="lineno">  926 </span>
<span class="lineno">  927 </span>formatVarValue :: ElmVersion -&gt; AST.Listing.Value -&gt; Box
<span class="lineno">  928 </span><span class="decl"><span class="istickedoff">formatVarValue elmVersion aval =</span>
<span class="lineno">  929 </span><span class="spaces">    </span><span class="istickedoff">case aval of</span>
<span class="lineno">  930 </span><span class="spaces">        </span><span class="istickedoff">AST.Listing.Value val -&gt;</span>
<span class="lineno">  931 </span><span class="spaces">            </span><span class="istickedoff">line $ formatLowercaseIdentifier elmVersion [] val</span>
<span class="lineno">  932 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  933 </span><span class="spaces">        </span><span class="istickedoff">AST.Listing.OpValue (SymbolIdentifier name) -&gt;</span>
<span class="lineno">  934 </span><span class="spaces">            </span><span class="istickedoff">line $ identifier $ &quot;(&quot; ++ name ++ &quot;)&quot;</span>
<span class="lineno">  935 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  936 </span><span class="spaces">        </span><span class="istickedoff">AST.Listing.Union name listing -&gt;</span>
<span class="lineno">  937 </span><span class="spaces">            </span><span class="istickedoff">case</span>
<span class="lineno">  938 </span><span class="spaces">              </span><span class="istickedoff">( formatListing</span>
<span class="lineno">  939 </span><span class="spaces">                  </span><span class="istickedoff">(formatCommentedMap</span>
<span class="lineno">  940 </span><span class="spaces">                      </span><span class="istickedoff">(\name_ () -&gt; name_)</span>
<span class="lineno">  941 </span><span class="spaces">                      </span><span class="istickedoff">(line . formatUppercaseIdentifier elmVersion)</span>
<span class="lineno">  942 </span><span class="spaces">                  </span><span class="istickedoff">)</span>
<span class="lineno">  943 </span><span class="spaces">                  </span><span class="istickedoff">listing</span>
<span class="lineno">  944 </span><span class="spaces">              </span><span class="istickedoff">, formatTailCommented (line . formatUppercaseIdentifier elmVersion) name</span>
<span class="lineno">  945 </span><span class="spaces">              </span><span class="istickedoff">, (\(C c _) -&gt; c) name</span>
<span class="lineno">  946 </span><span class="spaces">              </span><span class="istickedoff">, elmVersion</span>
<span class="lineno">  947 </span><span class="spaces">              </span><span class="istickedoff">)</span>
<span class="lineno">  948 </span><span class="spaces">            </span><span class="istickedoff">of</span>
<span class="lineno">  949 </span><span class="spaces">                </span><span class="istickedoff">(Just _, _, _, Elm_0_19) -&gt;</span>
<span class="lineno">  950 </span><span class="spaces">                    </span><span class="istickedoff">formatTailCommented</span>
<span class="lineno">  951 </span><span class="spaces">                        </span><span class="istickedoff">(\n -&gt; line $ row [ formatUppercaseIdentifier elmVersion n, keyword &quot;(..)&quot; ])</span>
<span class="lineno">  952 </span><span class="spaces">                        </span><span class="istickedoff">name</span>
<span class="lineno">  953 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  954 </span><span class="spaces">                </span><span class="istickedoff">(Just (SingleLine listing'), SingleLine name', [], _) -&gt;</span>
<span class="lineno">  955 </span><span class="spaces">                    </span><span class="istickedoff">line $ row</span>
<span class="lineno">  956 </span><span class="spaces">                        </span><span class="istickedoff">[ name'</span>
<span class="lineno">  957 </span><span class="spaces">                        </span><span class="istickedoff">, listing'</span>
<span class="lineno">  958 </span><span class="spaces">                        </span><span class="istickedoff">]</span>
<span class="lineno">  959 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  960 </span><span class="spaces">                </span><span class="istickedoff">(Just (SingleLine listing'), SingleLine name', _, _) -&gt;</span>
<span class="lineno">  961 </span><span class="spaces">                    </span><span class="istickedoff">line $ row</span>
<span class="lineno">  962 </span><span class="spaces">                        </span><span class="istickedoff">[ name'</span>
<span class="lineno">  963 </span><span class="spaces">                        </span><span class="istickedoff">, space</span>
<span class="lineno">  964 </span><span class="spaces">                        </span><span class="istickedoff">, listing'</span>
<span class="lineno">  965 </span><span class="spaces">                        </span><span class="istickedoff">]</span>
<span class="lineno">  966 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  967 </span><span class="spaces">                </span><span class="istickedoff">(Just listing', name', _, _) -&gt;</span>
<span class="lineno">  968 </span><span class="spaces">                  </span><span class="istickedoff">stack1</span>
<span class="lineno">  969 </span><span class="spaces">                    </span><span class="istickedoff">[ name'</span>
<span class="lineno">  970 </span><span class="spaces">                    </span><span class="istickedoff">, indent $ listing'</span>
<span class="lineno">  971 </span><span class="spaces">                    </span><span class="istickedoff">]</span>
<span class="lineno">  972 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  973 </span><span class="spaces">                </span><span class="istickedoff">(Nothing, name', _, _) -&gt;</span>
<span class="lineno">  974 </span><span class="spaces">                    </span><span class="istickedoff">name'</span></span>
<span class="lineno">  975 </span>
<span class="lineno">  976 </span>
<span class="lineno">  977 </span>formatTopLevelStructure :: ElmVersion -&gt; ImportInfo [UppercaseIdentifier] -&gt; (a -&gt; Box) -&gt; TopLevelStructure a -&gt; Box
<span class="lineno">  978 </span><span class="decl"><span class="istickedoff">formatTopLevelStructure elmVersion importInfo formatEntry topLevelStructure =</span>
<span class="lineno">  979 </span><span class="spaces">    </span><span class="istickedoff">case topLevelStructure of</span>
<span class="lineno">  980 </span><span class="spaces">        </span><span class="istickedoff">DocComment docs -&gt;</span>
<span class="lineno">  981 </span><span class="spaces">            </span><span class="istickedoff">formatDocComment elmVersion <span class="nottickedoff">importInfo</span> docs</span>
<span class="lineno">  982 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  983 </span><span class="spaces">        </span><span class="istickedoff">BodyComment c -&gt;</span>
<span class="lineno">  984 </span><span class="spaces">            </span><span class="istickedoff">formatComment c</span>
<span class="lineno">  985 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  986 </span><span class="spaces">        </span><span class="istickedoff">Entry entry -&gt;</span>
<span class="lineno">  987 </span><span class="spaces">            </span><span class="istickedoff">formatEntry entry</span></span>
<span class="lineno">  988 </span>
<span class="lineno">  989 </span>
<span class="lineno">  990 </span>formatCommonDeclaration ::
<span class="lineno">  991 </span>    Coapplicative annf =&gt;
<span class="lineno">  992 </span>    ElmVersion -&gt; ImportInfo [UppercaseIdentifier] -&gt; ASTNS annf [UppercaseIdentifier] 'CommonDeclarationNK -&gt; Box
<span class="lineno">  993 </span><span class="decl"><span class="istickedoff">formatCommonDeclaration elmVersion importInfo decl =</span>
<span class="lineno">  994 </span><span class="spaces">    </span><span class="istickedoff">case extract $ I.unFix $ I.convert (Identity . extract) decl of</span>
<span class="lineno">  995 </span><span class="spaces">        </span><span class="istickedoff">Definition name args comments expr -&gt;</span>
<span class="lineno">  996 </span><span class="spaces">            </span><span class="istickedoff">formatDefinition elmVersion <span class="nottickedoff">importInfo</span> name args comments expr</span>
<span class="lineno">  997 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno">  998 </span><span class="spaces">        </span><span class="istickedoff">TypeAnnotation name typ -&gt;</span>
<span class="lineno">  999 </span><span class="spaces">            </span><span class="istickedoff">formatTypeAnnotation elmVersion name typ</span></span>
<span class="lineno"> 1000 </span>
<span class="lineno"> 1001 </span>
<span class="lineno"> 1002 </span>formatDeclaration ::
<span class="lineno"> 1003 </span>    Coapplicative annf =&gt;
<span class="lineno"> 1004 </span>    ElmVersion -&gt; ImportInfo [UppercaseIdentifier] -&gt; ASTNS annf [UppercaseIdentifier] 'TopLevelDeclarationNK -&gt; Box
<span class="lineno"> 1005 </span><span class="decl"><span class="istickedoff">formatDeclaration elmVersion importInfo decl =</span>
<span class="lineno"> 1006 </span><span class="spaces">    </span><span class="istickedoff">case extract $ I.unFix $ I.convert (Identity . extract) decl of</span>
<span class="lineno"> 1007 </span><span class="spaces">        </span><span class="istickedoff">CommonDeclaration def -&gt;</span>
<span class="lineno"> 1008 </span><span class="spaces">            </span><span class="istickedoff">formatCommonDeclaration elmVersion <span class="nottickedoff">importInfo</span> def</span>
<span class="lineno"> 1009 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno"> 1010 </span><span class="spaces">        </span><span class="istickedoff">Datatype nameWithArgs tags -&gt;</span>
<span class="lineno"> 1011 </span><span class="spaces">            </span><span class="istickedoff">let</span>
<span class="lineno"> 1012 </span><span class="spaces">                </span><span class="istickedoff">ctor (NameWithArgs tag args') =</span>
<span class="lineno"> 1013 </span><span class="spaces">                    </span><span class="istickedoff">case allSingles $ map (formatHeadCommented $ formatType' elmVersion ForCtor) args' of</span>
<span class="lineno"> 1014 </span><span class="spaces">                        </span><span class="istickedoff">Right args'' -&gt;</span>
<span class="lineno"> 1015 </span><span class="spaces">                            </span><span class="istickedoff">line $ row $ List.intersperse space $ (formatUppercaseIdentifier elmVersion tag):args''</span>
<span class="lineno"> 1016 </span><span class="spaces">                        </span><span class="istickedoff">Left [] -&gt;</span>
<span class="lineno"> 1017 </span><span class="spaces">                            </span><span class="istickedoff"><span class="nottickedoff">line $ formatUppercaseIdentifier elmVersion tag</span></span>
<span class="lineno"> 1018 </span><span class="spaces">                        </span><span class="istickedoff">Left args'' -&gt;</span>
<span class="lineno"> 1019 </span><span class="spaces">                            </span><span class="istickedoff">stack1</span>
<span class="lineno"> 1020 </span><span class="spaces">                                </span><span class="istickedoff">[ line $ formatUppercaseIdentifier elmVersion tag</span>
<span class="lineno"> 1021 </span><span class="spaces">                                </span><span class="istickedoff">, stack1 args''</span>
<span class="lineno"> 1022 </span><span class="spaces">                                    </span><span class="istickedoff">|&gt; indent</span>
<span class="lineno"> 1023 </span><span class="spaces">                                </span><span class="istickedoff">]</span>
<span class="lineno"> 1024 </span><span class="spaces">            </span><span class="istickedoff">in</span>
<span class="lineno"> 1025 </span><span class="spaces">                </span><span class="istickedoff">case</span>
<span class="lineno"> 1026 </span><span class="spaces">                    </span><span class="istickedoff">formatOpenCommentedList ctor tags</span>
<span class="lineno"> 1027 </span><span class="spaces">                </span><span class="istickedoff">of</span>
<span class="lineno"> 1028 </span><span class="spaces">                    </span><span class="istickedoff">[] -&gt; <span class="nottickedoff">error &quot;List can't be empty&quot;</span></span>
<span class="lineno"> 1029 </span><span class="spaces">                    </span><span class="istickedoff">first:rest -&gt;</span>
<span class="lineno"> 1030 </span><span class="spaces">                        </span><span class="istickedoff">case formatCommented (formatNameWithArgs elmVersion) nameWithArgs of</span>
<span class="lineno"> 1031 </span><span class="spaces">                        </span><span class="istickedoff">SingleLine nameWithArgs' -&gt;</span>
<span class="lineno"> 1032 </span><span class="spaces">                            </span><span class="istickedoff">stack1</span>
<span class="lineno"> 1033 </span><span class="spaces">                            </span><span class="istickedoff">[ line $ row</span>
<span class="lineno"> 1034 </span><span class="spaces">                                </span><span class="istickedoff">[ keyword &quot;type&quot;</span>
<span class="lineno"> 1035 </span><span class="spaces">                                </span><span class="istickedoff">, space</span>
<span class="lineno"> 1036 </span><span class="spaces">                                </span><span class="istickedoff">, nameWithArgs'</span>
<span class="lineno"> 1037 </span><span class="spaces">                                </span><span class="istickedoff">]</span>
<span class="lineno"> 1038 </span><span class="spaces">                            </span><span class="istickedoff">, first</span>
<span class="lineno"> 1039 </span><span class="spaces">                                </span><span class="istickedoff">|&gt; prefix (row [punc &quot;=&quot;, space])</span>
<span class="lineno"> 1040 </span><span class="spaces">                                </span><span class="istickedoff">|&gt; andThen (map (prefix (row [punc &quot;|&quot;, space])) rest)</span>
<span class="lineno"> 1041 </span><span class="spaces">                                </span><span class="istickedoff">|&gt; indent</span>
<span class="lineno"> 1042 </span><span class="spaces">                            </span><span class="istickedoff">]</span>
<span class="lineno"> 1043 </span><span class="spaces">                        </span><span class="istickedoff">nameWithArgs' -&gt;</span>
<span class="lineno"> 1044 </span><span class="spaces">                            </span><span class="istickedoff">stack1</span>
<span class="lineno"> 1045 </span><span class="spaces">                            </span><span class="istickedoff">[ line $ keyword &quot;type&quot;</span>
<span class="lineno"> 1046 </span><span class="spaces">                            </span><span class="istickedoff">, indent $ nameWithArgs'</span>
<span class="lineno"> 1047 </span><span class="spaces">                            </span><span class="istickedoff">, first</span>
<span class="lineno"> 1048 </span><span class="spaces">                                </span><span class="istickedoff">|&gt; prefix (row [punc &quot;=&quot;, space])</span>
<span class="lineno"> 1049 </span><span class="spaces">                                </span><span class="istickedoff">|&gt; andThen (map (prefix (row [punc &quot;|&quot;, space])) rest)</span>
<span class="lineno"> 1050 </span><span class="spaces">                                </span><span class="istickedoff">|&gt; indent</span>
<span class="lineno"> 1051 </span><span class="spaces">                            </span><span class="istickedoff">]</span>
<span class="lineno"> 1052 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno"> 1053 </span><span class="spaces">        </span><span class="istickedoff">TypeAlias preAlias nameWithArgs typ -&gt;</span>
<span class="lineno"> 1054 </span><span class="spaces">            </span><span class="istickedoff">ElmStructure.definition &quot;=&quot; True</span>
<span class="lineno"> 1055 </span><span class="spaces">            </span><span class="istickedoff">(line $ keyword &quot;type&quot;)</span>
<span class="lineno"> 1056 </span><span class="spaces">            </span><span class="istickedoff">[ formatHeadCommented (line . keyword) (C preAlias &quot;alias&quot;)</span>
<span class="lineno"> 1057 </span><span class="spaces">            </span><span class="istickedoff">, formatCommented (formatNameWithArgs elmVersion) nameWithArgs</span>
<span class="lineno"> 1058 </span><span class="spaces">            </span><span class="istickedoff">]</span>
<span class="lineno"> 1059 </span><span class="spaces">            </span><span class="istickedoff">(formatHeadCommentedStack (formatType elmVersion) typ)</span>
<span class="lineno"> 1060 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno"> 1061 </span><span class="spaces">        </span><span class="istickedoff">PortAnnotation name typeComments typ -&gt;</span>
<span class="lineno"> 1062 </span><span class="spaces">            </span><span class="istickedoff">ElmStructure.definition &quot;:&quot; False</span>
<span class="lineno"> 1063 </span><span class="spaces">            </span><span class="istickedoff">(line $ keyword &quot;port&quot;)</span>
<span class="lineno"> 1064 </span><span class="spaces">            </span><span class="istickedoff">[ formatCommented (line . formatLowercaseIdentifier elmVersion []) name ]</span>
<span class="lineno"> 1065 </span><span class="spaces">            </span><span class="istickedoff">(formatCommented' typeComments (formatType elmVersion) typ)</span>
<span class="lineno"> 1066 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno"> 1067 </span><span class="spaces">        </span><span class="istickedoff">PortDefinition_until_0_16 name bodyComments expr -&gt;</span>
<span class="lineno"> 1068 </span><span class="spaces">            </span><span class="istickedoff">ElmStructure.definition &quot;=&quot; True</span>
<span class="lineno"> 1069 </span><span class="spaces">            </span><span class="istickedoff">(line $ keyword &quot;port&quot;)</span>
<span class="lineno"> 1070 </span><span class="spaces">            </span><span class="istickedoff">[formatCommented (line . formatLowercaseIdentifier elmVersion []) name]</span>
<span class="lineno"> 1071 </span><span class="spaces">            </span><span class="istickedoff">(formatCommented' bodyComments (formatExpression elmVersion <span class="nottickedoff">importInfo</span> SyntaxSeparated) $ expr)</span>
<span class="lineno"> 1072 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno"> 1073 </span><span class="spaces">        </span><span class="istickedoff">Fixity_until_0_18 assoc precedenceComments precedence nameComments name -&gt;</span>
<span class="lineno"> 1074 </span><span class="spaces">            </span><span class="istickedoff">case</span>
<span class="lineno"> 1075 </span><span class="spaces">                </span><span class="istickedoff">( formatCommented' nameComments (line . formatInfixVar <span class="nottickedoff">elmVersion</span>) name</span>
<span class="lineno"> 1076 </span><span class="spaces">                </span><span class="istickedoff">, formatCommented' precedenceComments (line . literal . show) precedence</span>
<span class="lineno"> 1077 </span><span class="spaces">                </span><span class="istickedoff">)</span>
<span class="lineno"> 1078 </span><span class="spaces">            </span><span class="istickedoff">of</span>
<span class="lineno"> 1079 </span><span class="spaces">                </span><span class="istickedoff">(SingleLine name', SingleLine precedence') -&gt;</span>
<span class="lineno"> 1080 </span><span class="spaces">                    </span><span class="istickedoff">line $ row</span>
<span class="lineno"> 1081 </span><span class="spaces">                        </span><span class="istickedoff">[ case assoc of</span>
<span class="lineno"> 1082 </span><span class="spaces">                                </span><span class="istickedoff">L -&gt; keyword &quot;infixl&quot;</span>
<span class="lineno"> 1083 </span><span class="spaces">                                </span><span class="istickedoff">R -&gt; keyword &quot;infixr&quot;</span>
<span class="lineno"> 1084 </span><span class="spaces">                                </span><span class="istickedoff">N -&gt; keyword &quot;infix&quot;</span>
<span class="lineno"> 1085 </span><span class="spaces">                        </span><span class="istickedoff">, space</span>
<span class="lineno"> 1086 </span><span class="spaces">                        </span><span class="istickedoff">, precedence'</span>
<span class="lineno"> 1087 </span><span class="spaces">                        </span><span class="istickedoff">, space</span>
<span class="lineno"> 1088 </span><span class="spaces">                        </span><span class="istickedoff">, name'</span>
<span class="lineno"> 1089 </span><span class="spaces">                        </span><span class="istickedoff">]</span>
<span class="lineno"> 1090 </span><span class="spaces">                </span><span class="istickedoff">_ -&gt;</span>
<span class="lineno"> 1091 </span><span class="spaces">                    </span><span class="istickedoff"><span class="nottickedoff">pleaseReport &quot;TODO&quot; &quot;multiline fixity declaration&quot;</span></span>
<span class="lineno"> 1092 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno"> 1093 </span><span class="spaces">        </span><span class="istickedoff">Fixity assoc precedence name value -&gt;</span>
<span class="lineno"> 1094 </span><span class="spaces">            </span><span class="istickedoff">let</span>
<span class="lineno"> 1095 </span><span class="spaces">                </span><span class="istickedoff">formatAssoc a =</span>
<span class="lineno"> 1096 </span><span class="spaces">                    </span><span class="istickedoff">case a of</span>
<span class="lineno"> 1097 </span><span class="spaces">                        </span><span class="istickedoff">L -&gt; keyword &quot;left &quot;</span>
<span class="lineno"> 1098 </span><span class="spaces">                        </span><span class="istickedoff">R -&gt; keyword &quot;right&quot;</span>
<span class="lineno"> 1099 </span><span class="spaces">                        </span><span class="istickedoff">N -&gt; keyword &quot;non  &quot;</span>
<span class="lineno"> 1100 </span><span class="spaces">            </span><span class="istickedoff">in</span>
<span class="lineno"> 1101 </span><span class="spaces">            </span><span class="istickedoff">ElmStructure.spaceSepOrIndented</span>
<span class="lineno"> 1102 </span><span class="spaces">                </span><span class="istickedoff">(line $ keyword &quot;infix&quot;)</span>
<span class="lineno"> 1103 </span><span class="spaces">                </span><span class="istickedoff">[ formatHeadCommented (line . formatAssoc) assoc</span>
<span class="lineno"> 1104 </span><span class="spaces">                </span><span class="istickedoff">, formatHeadCommented (line . literal . show) precedence</span>
<span class="lineno"> 1105 </span><span class="spaces">                </span><span class="istickedoff">, formatCommented (line . formatSymbolIdentifierInParens) name</span>
<span class="lineno"> 1106 </span><span class="spaces">                </span><span class="istickedoff">, line $ keyword &quot;=&quot;</span>
<span class="lineno"> 1107 </span><span class="spaces">                </span><span class="istickedoff">, formatHeadCommented (line . identifier . formatVarName elmVersion) value</span>
<span class="lineno"> 1108 </span><span class="spaces">                </span><span class="istickedoff">]</span></span>
<span class="lineno"> 1109 </span>
<span class="lineno"> 1110 </span>
<span class="lineno"> 1111 </span>formatNameWithArgs :: ElmVersion -&gt; NameWithArgs UppercaseIdentifier LowercaseIdentifier -&gt; Box
<span class="lineno"> 1112 </span><span class="decl"><span class="istickedoff">formatNameWithArgs elmVersion (NameWithArgs name args) =</span>
<span class="lineno"> 1113 </span><span class="spaces">  </span><span class="istickedoff">case allSingles $ map (formatHeadCommented (line . formatLowercaseIdentifier elmVersion [])) args of</span>
<span class="lineno"> 1114 </span><span class="spaces">    </span><span class="istickedoff">Right args' -&gt;</span>
<span class="lineno"> 1115 </span><span class="spaces">      </span><span class="istickedoff">line $ row $ List.intersperse space $ ((formatUppercaseIdentifier elmVersion name):args')</span>
<span class="lineno"> 1116 </span><span class="spaces">    </span><span class="istickedoff">Left args' -&gt;</span>
<span class="lineno"> 1117 </span><span class="spaces">      </span><span class="istickedoff">stack1 $</span>
<span class="lineno"> 1118 </span><span class="spaces">        </span><span class="istickedoff">[ line $ formatUppercaseIdentifier elmVersion name ]</span>
<span class="lineno"> 1119 </span><span class="spaces">        </span><span class="istickedoff">++ (map indent args')</span></span>
<span class="lineno"> 1120 </span>
<span class="lineno"> 1121 </span>
<span class="lineno"> 1122 </span>formatDefinition ::
<span class="lineno"> 1123 </span>    ElmVersion
<span class="lineno"> 1124 </span>    -&gt; ImportInfo [UppercaseIdentifier]
<span class="lineno"> 1125 </span>    -&gt; ASTNS Identity [UppercaseIdentifier] 'PatternNK
<span class="lineno"> 1126 </span>    -&gt; [C1 before (ASTNS Identity [UppercaseIdentifier] 'PatternNK)]
<span class="lineno"> 1127 </span>    -&gt; Comments
<span class="lineno"> 1128 </span>    -&gt; ASTNS Identity [UppercaseIdentifier] 'ExpressionNK
<span class="lineno"> 1129 </span>    -&gt; Box
<span class="lineno"> 1130 </span><span class="decl"><span class="istickedoff">formatDefinition elmVersion importInfo name args comments expr =</span>
<span class="lineno"> 1131 </span><span class="spaces">  </span><span class="istickedoff">let</span>
<span class="lineno"> 1132 </span><span class="spaces">    </span><span class="istickedoff">body =</span>
<span class="lineno"> 1133 </span><span class="spaces">      </span><span class="istickedoff">stack1 $ concat</span>
<span class="lineno"> 1134 </span><span class="spaces">        </span><span class="istickedoff">[ map formatComment comments</span>
<span class="lineno"> 1135 </span><span class="spaces">        </span><span class="istickedoff">, [ formatExpression elmVersion <span class="nottickedoff">importInfo</span> SyntaxSeparated expr ]</span>
<span class="lineno"> 1136 </span><span class="spaces">        </span><span class="istickedoff">]</span>
<span class="lineno"> 1137 </span><span class="spaces">  </span><span class="istickedoff">in</span>
<span class="lineno"> 1138 </span><span class="spaces">    </span><span class="istickedoff">ElmStructure.definition &quot;=&quot; True</span>
<span class="lineno"> 1139 </span><span class="spaces">      </span><span class="istickedoff">(formatPattern elmVersion <span class="nottickedoff">True</span> name)</span>
<span class="lineno"> 1140 </span><span class="spaces">      </span><span class="istickedoff">(map (\(C x y) -&gt; formatCommented' x (formatPattern elmVersion True) y) args)</span>
<span class="lineno"> 1141 </span><span class="spaces">      </span><span class="istickedoff">body</span></span>
<span class="lineno"> 1142 </span>
<span class="lineno"> 1143 </span>
<span class="lineno"> 1144 </span>formatTypeAnnotation ::
<span class="lineno"> 1145 </span>    Coapplicative annf =&gt;
<span class="lineno"> 1146 </span>    ElmVersion -&gt; C1 after (Ref ()) -&gt; C1 before (ASTNS annf [UppercaseIdentifier] 'TypeNK) -&gt; Box
<span class="lineno"> 1147 </span><span class="decl"><span class="istickedoff">formatTypeAnnotation elmVersion name typ =</span>
<span class="lineno"> 1148 </span><span class="spaces">  </span><span class="istickedoff">ElmStructure.definition &quot;:&quot; False</span>
<span class="lineno"> 1149 </span><span class="spaces">    </span><span class="istickedoff">(formatTailCommented (line . formatVar elmVersion . fmap (\() -&gt; [])) name)</span>
<span class="lineno"> 1150 </span><span class="spaces">    </span><span class="istickedoff">[]</span>
<span class="lineno"> 1151 </span><span class="spaces">    </span><span class="istickedoff">(formatHeadCommented (formatType elmVersion) typ)</span></span>
<span class="lineno"> 1152 </span>
<span class="lineno"> 1153 </span>
<span class="lineno"> 1154 </span>formatPattern ::
<span class="lineno"> 1155 </span>    Coapplicative annf =&gt;
<span class="lineno"> 1156 </span>    ElmVersion -&gt; Bool -&gt; ASTNS annf [UppercaseIdentifier] 'PatternNK -&gt; Box
<span class="lineno"> 1157 </span><span class="decl"><span class="istickedoff">formatPattern elmVersion parensRequired apattern =</span>
<span class="lineno"> 1158 </span><span class="spaces">    </span><span class="istickedoff">case extract $ I.unFix apattern of</span>
<span class="lineno"> 1159 </span><span class="spaces">        </span><span class="istickedoff">Anything -&gt;</span>
<span class="lineno"> 1160 </span><span class="spaces">            </span><span class="istickedoff">line $ keyword &quot;_&quot;</span>
<span class="lineno"> 1161 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno"> 1162 </span><span class="spaces">        </span><span class="istickedoff">UnitPattern comments -&gt;</span>
<span class="lineno"> 1163 </span><span class="spaces">            </span><span class="istickedoff">formatUnit '(' ')' comments</span>
<span class="lineno"> 1164 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno"> 1165 </span><span class="spaces">        </span><span class="istickedoff">LiteralPattern lit -&gt;</span>
<span class="lineno"> 1166 </span><span class="spaces">            </span><span class="istickedoff">formatLiteral elmVersion lit</span>
<span class="lineno"> 1167 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno"> 1168 </span><span class="spaces">        </span><span class="istickedoff">VarPattern var -&gt;</span>
<span class="lineno"> 1169 </span><span class="spaces">            </span><span class="istickedoff">line $ formatLowercaseIdentifier elmVersion [] var</span>
<span class="lineno"> 1170 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno"> 1171 </span><span class="spaces">        </span><span class="istickedoff">OpPattern (SymbolIdentifier name) -&gt;</span>
<span class="lineno"> 1172 </span><span class="spaces">            </span><span class="istickedoff">line $ identifier $ &quot;(&quot; ++ name ++ &quot;)&quot;</span>
<span class="lineno"> 1173 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno"> 1174 </span><span class="spaces">        </span><span class="istickedoff">ConsPattern first rest -&gt;</span>
<span class="lineno"> 1175 </span><span class="spaces">            </span><span class="istickedoff">let</span>
<span class="lineno"> 1176 </span><span class="spaces">                </span><span class="istickedoff">formatRight (C (preOp, postOp, eol) term) =</span>
<span class="lineno"> 1177 </span><span class="spaces">                    </span><span class="istickedoff">( False</span>
<span class="lineno"> 1178 </span><span class="spaces">                    </span><span class="istickedoff">, preOp</span>
<span class="lineno"> 1179 </span><span class="spaces">                    </span><span class="istickedoff">, line $ punc &quot;::&quot;</span>
<span class="lineno"> 1180 </span><span class="spaces">                    </span><span class="istickedoff">, formatC2Eol $</span>
<span class="lineno"> 1181 </span><span class="spaces">                        </span><span class="istickedoff">(fmap $ formatPattern elmVersion True)</span>
<span class="lineno"> 1182 </span><span class="spaces">                        </span><span class="istickedoff">(C (postOp, [], eol) term)</span>
<span class="lineno"> 1183 </span><span class="spaces">                    </span><span class="istickedoff">)</span>
<span class="lineno"> 1184 </span><span class="spaces">            </span><span class="istickedoff">in</span>
<span class="lineno"> 1185 </span><span class="spaces">                </span><span class="istickedoff">formatBinary False</span>
<span class="lineno"> 1186 </span><span class="spaces">                    </span><span class="istickedoff">(formatEolCommented (formatPattern elmVersion True) first)</span>
<span class="lineno"> 1187 </span><span class="spaces">                    </span><span class="istickedoff">(fmap formatRight $ toCommentedList rest)</span>
<span class="lineno"> 1188 </span><span class="spaces">                </span><span class="istickedoff">|&gt; if parensRequired then parens else id</span>
<span class="lineno"> 1189 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno"> 1190 </span><span class="spaces">        </span><span class="istickedoff">DataPattern (ns, tag) [] -&gt;</span>
<span class="lineno"> 1191 </span><span class="spaces">            </span><span class="istickedoff">let</span>
<span class="lineno"> 1192 </span><span class="spaces">                </span><span class="istickedoff">ctor = ns ++ [tag]</span>
<span class="lineno"> 1193 </span><span class="spaces">            </span><span class="istickedoff">in</span>
<span class="lineno"> 1194 </span><span class="spaces">            </span><span class="istickedoff">line (formatQualifiedUppercaseIdentifier elmVersion ctor)</span>
<span class="lineno"> 1195 </span><span class="spaces">                </span><span class="istickedoff">|&gt;</span>
<span class="lineno"> 1196 </span><span class="spaces">                    </span><span class="istickedoff">case (elmVersion, <span class="nottickedoff">ctor</span>) of</span>
<span class="lineno"> 1197 </span><span class="spaces">                        </span><span class="istickedoff">(Elm_0_16, [_]) -&gt;</span>
<span class="lineno"> 1198 </span><span class="spaces">                            </span><span class="istickedoff"><span class="nottickedoff">id</span></span>
<span class="lineno"> 1199 </span><span class="spaces">                        </span><span class="istickedoff">(Elm_0_16, _) -&gt;</span>
<span class="lineno"> 1200 </span><span class="spaces">                            </span><span class="istickedoff"><span class="nottickedoff">if parensRequired then parens else id</span></span>
<span class="lineno"> 1201 </span><span class="spaces">                        </span><span class="istickedoff">_ -&gt;</span>
<span class="lineno"> 1202 </span><span class="spaces">                            </span><span class="istickedoff">id</span>
<span class="lineno"> 1203 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno"> 1204 </span><span class="spaces">        </span><span class="istickedoff">DataPattern (ns, tag) patterns -&gt;</span>
<span class="lineno"> 1205 </span><span class="spaces">            </span><span class="istickedoff">let</span>
<span class="lineno"> 1206 </span><span class="spaces">                </span><span class="istickedoff">ctor = ns ++ [tag]</span>
<span class="lineno"> 1207 </span><span class="spaces">            </span><span class="istickedoff">in</span>
<span class="lineno"> 1208 </span><span class="spaces">            </span><span class="istickedoff">ElmStructure.application</span>
<span class="lineno"> 1209 </span><span class="spaces">                </span><span class="istickedoff">(FAJoinFirst JoinAll)</span>
<span class="lineno"> 1210 </span><span class="spaces">                </span><span class="istickedoff">(line $ formatQualifiedUppercaseIdentifier elmVersion ctor)</span>
<span class="lineno"> 1211 </span><span class="spaces">                </span><span class="istickedoff">(map (formatHeadCommented $ formatPattern elmVersion True) patterns)</span>
<span class="lineno"> 1212 </span><span class="spaces">            </span><span class="istickedoff">|&gt; if parensRequired then parens else id</span>
<span class="lineno"> 1213 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno"> 1214 </span><span class="spaces">        </span><span class="istickedoff">PatternParens pattern -&gt;</span>
<span class="lineno"> 1215 </span><span class="spaces">            </span><span class="istickedoff">formatCommented (formatPattern elmVersion <span class="nottickedoff">False</span>) pattern</span>
<span class="lineno"> 1216 </span><span class="spaces">              </span><span class="istickedoff">|&gt; parens</span>
<span class="lineno"> 1217 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno"> 1218 </span><span class="spaces">        </span><span class="istickedoff">TuplePattern patterns -&gt;</span>
<span class="lineno"> 1219 </span><span class="spaces">            </span><span class="istickedoff">ElmStructure.group True &quot;(&quot; &quot;,&quot; &quot;)&quot; False $ map (formatCommented $ formatPattern elmVersion False) patterns</span>
<span class="lineno"> 1220 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno"> 1221 </span><span class="spaces">        </span><span class="istickedoff">EmptyListPattern comments -&gt;</span>
<span class="lineno"> 1222 </span><span class="spaces">            </span><span class="istickedoff">formatUnit '[' ']' comments</span>
<span class="lineno"> 1223 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno"> 1224 </span><span class="spaces">        </span><span class="istickedoff">ListPattern patterns -&gt;</span>
<span class="lineno"> 1225 </span><span class="spaces">            </span><span class="istickedoff">ElmStructure.group True &quot;[&quot; &quot;,&quot; &quot;]&quot; False $ map (formatCommented $ formatPattern elmVersion <span class="nottickedoff">False</span>) patterns</span>
<span class="lineno"> 1226 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno"> 1227 </span><span class="spaces">        </span><span class="istickedoff">EmptyRecordPattern comments -&gt;</span>
<span class="lineno"> 1228 </span><span class="spaces">            </span><span class="istickedoff">formatUnit '{' '}' comments</span>
<span class="lineno"> 1229 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno"> 1230 </span><span class="spaces">        </span><span class="istickedoff">RecordPattern fields -&gt;</span>
<span class="lineno"> 1231 </span><span class="spaces">            </span><span class="istickedoff">ElmStructure.group True &quot;{&quot; &quot;,&quot; &quot;}&quot; False $ map (formatCommented $ line . formatLowercaseIdentifier elmVersion []) fields</span>
<span class="lineno"> 1232 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno"> 1233 </span><span class="spaces">        </span><span class="istickedoff">Alias pattern name -&gt;</span>
<span class="lineno"> 1234 </span><span class="spaces">          </span><span class="istickedoff">case</span>
<span class="lineno"> 1235 </span><span class="spaces">            </span><span class="istickedoff">( formatTailCommented (formatPattern elmVersion True) pattern</span>
<span class="lineno"> 1236 </span><span class="spaces">            </span><span class="istickedoff">, formatHeadCommented (line . formatLowercaseIdentifier elmVersion []) name</span>
<span class="lineno"> 1237 </span><span class="spaces">            </span><span class="istickedoff">)</span>
<span class="lineno"> 1238 </span><span class="spaces">          </span><span class="istickedoff">of</span>
<span class="lineno"> 1239 </span><span class="spaces">            </span><span class="istickedoff">(SingleLine pattern', SingleLine name') -&gt;</span>
<span class="lineno"> 1240 </span><span class="spaces">              </span><span class="istickedoff">line $ row</span>
<span class="lineno"> 1241 </span><span class="spaces">                </span><span class="istickedoff">[ pattern'</span>
<span class="lineno"> 1242 </span><span class="spaces">                </span><span class="istickedoff">, space</span>
<span class="lineno"> 1243 </span><span class="spaces">                </span><span class="istickedoff">, keyword &quot;as&quot;</span>
<span class="lineno"> 1244 </span><span class="spaces">                </span><span class="istickedoff">, space</span>
<span class="lineno"> 1245 </span><span class="spaces">                </span><span class="istickedoff">, name'</span>
<span class="lineno"> 1246 </span><span class="spaces">                </span><span class="istickedoff">]</span>
<span class="lineno"> 1247 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno"> 1248 </span><span class="spaces">            </span><span class="istickedoff">(pattern', name') -&gt;</span>
<span class="lineno"> 1249 </span><span class="spaces">              </span><span class="istickedoff">stack1</span>
<span class="lineno"> 1250 </span><span class="spaces">                </span><span class="istickedoff">[ pattern'</span>
<span class="lineno"> 1251 </span><span class="spaces">                </span><span class="istickedoff">, line $ keyword &quot;as&quot;</span>
<span class="lineno"> 1252 </span><span class="spaces">                </span><span class="istickedoff">, indent name'</span>
<span class="lineno"> 1253 </span><span class="spaces">                </span><span class="istickedoff">]</span>
<span class="lineno"> 1254 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno"> 1255 </span><span class="spaces">          </span><span class="istickedoff">|&gt; (if parensRequired then parens else id)</span></span>
<span class="lineno"> 1256 </span>
<span class="lineno"> 1257 </span>
<span class="lineno"> 1258 </span>formatRecordPair :: ElmVersion -&gt; String -&gt; (v -&gt; Box) -&gt; (C2 before after LowercaseIdentifier, C2 before after v, Bool) -&gt; Box
<span class="lineno"> 1259 </span><span class="decl"><span class="istickedoff">formatRecordPair elmVersion delim formatValue (C (pre, postK) k, v, forceMultiline) =</span>
<span class="lineno"> 1260 </span><span class="spaces">    </span><span class="istickedoff">ElmStructure.equalsPair delim forceMultiline</span>
<span class="lineno"> 1261 </span><span class="spaces">      </span><span class="istickedoff">(formatCommented (line . formatLowercaseIdentifier elmVersion []) $ C ([], postK) k)</span>
<span class="lineno"> 1262 </span><span class="spaces">      </span><span class="istickedoff">(formatCommented formatValue v)</span>
<span class="lineno"> 1263 </span><span class="spaces">    </span><span class="istickedoff">|&gt; C (pre, []) |&gt; formatCommented id</span></span>
<span class="lineno"> 1264 </span>
<span class="lineno"> 1265 </span>
<span class="lineno"> 1266 </span>formatPair :: (a -&gt; Line) -&gt; String -&gt; (b -&gt; Box) -&gt; Pair a b -&gt; Box
<span class="lineno"> 1267 </span><span class="decl"><span class="istickedoff">formatPair formatA delim formatB (Pair a b (ForceMultiline forceMultiline)) =</span>
<span class="lineno"> 1268 </span><span class="spaces">    </span><span class="istickedoff">ElmStructure.equalsPair delim forceMultiline</span>
<span class="lineno"> 1269 </span><span class="spaces">        </span><span class="istickedoff">(formatTailCommented (line . formatA) a)</span>
<span class="lineno"> 1270 </span><span class="spaces">        </span><span class="istickedoff">(formatHeadCommented formatB b)</span></span>
<span class="lineno"> 1271 </span>
<span class="lineno"> 1272 </span>
<span class="lineno"> 1273 </span>negativeCasePatternWorkaround ::
<span class="lineno"> 1274 </span>    Coapplicative annf =&gt;
<span class="lineno"> 1275 </span>    ASTNS annf [UppercaseIdentifier] 'PatternNK -&gt; Box -&gt; Box
<span class="lineno"> 1276 </span><span class="decl"><span class="istickedoff">negativeCasePatternWorkaround pattern =</span>
<span class="lineno"> 1277 </span><span class="spaces">    </span><span class="istickedoff">case extract $ I.unFix pattern of</span>
<span class="lineno"> 1278 </span><span class="spaces">        </span><span class="istickedoff">LiteralPattern (IntNum i _) | <span class="tickonlytrue">i &lt; 0</span> -&gt; parens</span>
<span class="lineno"> 1279 </span><span class="spaces">        </span><span class="istickedoff">LiteralPattern (FloatNum f _) | <span class="tickonlytrue">f &lt; 0</span> -&gt; parens</span>
<span class="lineno"> 1280 </span><span class="spaces">        </span><span class="istickedoff">_ -&gt; id</span></span>
<span class="lineno"> 1281 </span>
<span class="lineno"> 1282 </span>
<span class="lineno"> 1283 </span>data ExpressionContext
<span class="lineno"> 1284 </span>    = SyntaxSeparated
<span class="lineno"> 1285 </span>    | InfixSeparated
<span class="lineno"> 1286 </span>    | SpaceSeparated
<span class="lineno"> 1287 </span>    | AmbiguousEnd
<span class="lineno"> 1288 </span>
<span class="lineno"> 1289 </span>
<span class="lineno"> 1290 </span>expressionParens :: ExpressionContext -&gt; ExpressionContext -&gt; Box -&gt; Box
<span class="lineno"> 1291 </span><span class="decl"><span class="istickedoff">expressionParens inner outer =</span>
<span class="lineno"> 1292 </span><span class="spaces">    </span><span class="istickedoff">case (inner, outer) of</span>
<span class="lineno"> 1293 </span><span class="spaces">        </span><span class="istickedoff">(SpaceSeparated, SpaceSeparated) -&gt; parens</span>
<span class="lineno"> 1294 </span><span class="spaces">        </span><span class="istickedoff">(InfixSeparated, SpaceSeparated) -&gt; parens</span>
<span class="lineno"> 1295 </span><span class="spaces">        </span><span class="istickedoff">(InfixSeparated, InfixSeparated) -&gt; parens</span>
<span class="lineno"> 1296 </span><span class="spaces">        </span><span class="istickedoff">(AmbiguousEnd, SpaceSeparated) -&gt; parens</span>
<span class="lineno"> 1297 </span><span class="spaces">        </span><span class="istickedoff">(AmbiguousEnd, InfixSeparated) -&gt; parens</span>
<span class="lineno"> 1298 </span><span class="spaces">        </span><span class="istickedoff">(InfixSeparated, AmbiguousEnd) -&gt; parens</span>
<span class="lineno"> 1299 </span><span class="spaces">        </span><span class="istickedoff">_ -&gt; id</span></span>
<span class="lineno"> 1300 </span>
<span class="lineno"> 1301 </span>
<span class="lineno"> 1302 </span>formatExpression ::
<span class="lineno"> 1303 </span>    ElmVersion -&gt; ImportInfo [UppercaseIdentifier] -&gt; ExpressionContext
<span class="lineno"> 1304 </span>    -&gt; ASTNS Identity [UppercaseIdentifier] 'ExpressionNK
<span class="lineno"> 1305 </span>    -&gt; Box
<span class="lineno"> 1306 </span><span class="decl"><span class="istickedoff">formatExpression elmVersion importInfo context aexpr =</span>
<span class="lineno"> 1307 </span><span class="spaces">    </span><span class="istickedoff">case extract $ I.unFix aexpr of</span>
<span class="lineno"> 1308 </span><span class="spaces">        </span><span class="istickedoff">Literal lit -&gt;</span>
<span class="lineno"> 1309 </span><span class="spaces">            </span><span class="istickedoff">formatLiteral elmVersion lit</span>
<span class="lineno"> 1310 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno"> 1311 </span><span class="spaces">        </span><span class="istickedoff">VarExpr v -&gt;</span>
<span class="lineno"> 1312 </span><span class="spaces">            </span><span class="istickedoff">line $ formatVar elmVersion v</span>
<span class="lineno"> 1313 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno"> 1314 </span><span class="spaces">        </span><span class="istickedoff">Range left right multiline -&gt;</span>
<span class="lineno"> 1315 </span><span class="spaces">            </span><span class="istickedoff">case elmVersion of</span>
<span class="lineno"> 1316 </span><span class="spaces">                </span><span class="istickedoff">Elm_0_16 -&gt; <span class="nottickedoff">formatRange_0_17 elmVersion importInfo left right multiline</span></span>
<span class="lineno"> 1317 </span><span class="spaces">                </span><span class="istickedoff">Elm_0_17 -&gt; formatRange_0_17 elmVersion <span class="nottickedoff">importInfo</span> left right multiline</span>
<span class="lineno"> 1318 </span><span class="spaces">                </span><span class="istickedoff">Elm_0_18 -&gt; <span class="nottickedoff">formatRange_0_18 elmVersion importInfo context left right</span></span>
<span class="lineno"> 1319 </span><span class="spaces">                </span><span class="istickedoff">Elm_0_19 -&gt; <span class="nottickedoff">formatRange_0_18 elmVersion importInfo context left right</span></span>
<span class="lineno"> 1320 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno"> 1321 </span><span class="spaces">        </span><span class="istickedoff">ExplicitList exprs trailing multiline -&gt;</span>
<span class="lineno"> 1322 </span><span class="spaces">            </span><span class="istickedoff">formatSequence '[' ',' (Just ']')</span>
<span class="lineno"> 1323 </span><span class="spaces">                </span><span class="istickedoff">(formatExpression elmVersion <span class="nottickedoff">importInfo</span> SyntaxSeparated)</span>
<span class="lineno"> 1324 </span><span class="spaces">                </span><span class="istickedoff">multiline</span>
<span class="lineno"> 1325 </span><span class="spaces">                </span><span class="istickedoff">trailing</span>
<span class="lineno"> 1326 </span><span class="spaces">                </span><span class="istickedoff">exprs</span>
<span class="lineno"> 1327 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno"> 1328 </span><span class="spaces">        </span><span class="istickedoff">Binops left ops multiline -&gt;</span>
<span class="lineno"> 1329 </span><span class="spaces">            </span><span class="istickedoff">formatBinops elmVersion <span class="nottickedoff">importInfo</span> left ops multiline</span>
<span class="lineno"> 1330 </span><span class="spaces">            </span><span class="istickedoff">|&gt; expressionParens InfixSeparated context</span>
<span class="lineno"> 1331 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno"> 1332 </span><span class="spaces">        </span><span class="istickedoff">Lambda patterns bodyComments expr multiline -&gt;</span>
<span class="lineno"> 1333 </span><span class="spaces">            </span><span class="istickedoff">case</span>
<span class="lineno"> 1334 </span><span class="spaces">                </span><span class="istickedoff">( multiline</span>
<span class="lineno"> 1335 </span><span class="spaces">                </span><span class="istickedoff">, allSingles $ map (formatCommented (formatPattern elmVersion True) . (\(C c p) -&gt; C (c, []) p)) patterns</span>
<span class="lineno"> 1336 </span><span class="spaces">                </span><span class="istickedoff">, bodyComments == []</span>
<span class="lineno"> 1337 </span><span class="spaces">                </span><span class="istickedoff">, formatExpression elmVersion <span class="nottickedoff">importInfo</span> SyntaxSeparated expr</span>
<span class="lineno"> 1338 </span><span class="spaces">                </span><span class="istickedoff">)</span>
<span class="lineno"> 1339 </span><span class="spaces">            </span><span class="istickedoff">of</span>
<span class="lineno"> 1340 </span><span class="spaces">                </span><span class="istickedoff">(False, Right patterns', True, SingleLine expr') -&gt;</span>
<span class="lineno"> 1341 </span><span class="spaces">                    </span><span class="istickedoff">line $ row</span>
<span class="lineno"> 1342 </span><span class="spaces">                        </span><span class="istickedoff">[ punc &quot;\\&quot;</span>
<span class="lineno"> 1343 </span><span class="spaces">                        </span><span class="istickedoff">, row $ List.intersperse space $ patterns'</span>
<span class="lineno"> 1344 </span><span class="spaces">                        </span><span class="istickedoff">, space</span>
<span class="lineno"> 1345 </span><span class="spaces">                        </span><span class="istickedoff">, punc &quot;-&gt;&quot;</span>
<span class="lineno"> 1346 </span><span class="spaces">                        </span><span class="istickedoff">, space</span>
<span class="lineno"> 1347 </span><span class="spaces">                        </span><span class="istickedoff">, expr'</span>
<span class="lineno"> 1348 </span><span class="spaces">                        </span><span class="istickedoff">]</span>
<span class="lineno"> 1349 </span><span class="spaces">                </span><span class="istickedoff">(_, Right patterns', _, expr') -&gt;</span>
<span class="lineno"> 1350 </span><span class="spaces">                    </span><span class="istickedoff">stack1</span>
<span class="lineno"> 1351 </span><span class="spaces">                        </span><span class="istickedoff">[ line $ row</span>
<span class="lineno"> 1352 </span><span class="spaces">                            </span><span class="istickedoff">[ punc &quot;\\&quot;</span>
<span class="lineno"> 1353 </span><span class="spaces">                            </span><span class="istickedoff">, row $ List.intersperse space $ patterns'</span>
<span class="lineno"> 1354 </span><span class="spaces">                            </span><span class="istickedoff">, space</span>
<span class="lineno"> 1355 </span><span class="spaces">                            </span><span class="istickedoff">, punc &quot;-&gt;&quot;</span>
<span class="lineno"> 1356 </span><span class="spaces">                            </span><span class="istickedoff">]</span>
<span class="lineno"> 1357 </span><span class="spaces">                        </span><span class="istickedoff">, indent $ stack1 $</span>
<span class="lineno"> 1358 </span><span class="spaces">                            </span><span class="istickedoff">(map formatComment bodyComments)</span>
<span class="lineno"> 1359 </span><span class="spaces">                            </span><span class="istickedoff">++ [ expr' ]</span>
<span class="lineno"> 1360 </span><span class="spaces">                        </span><span class="istickedoff">]</span>
<span class="lineno"> 1361 </span><span class="spaces">                </span><span class="istickedoff">(_, Left [], _, _) -&gt;</span>
<span class="lineno"> 1362 </span><span class="spaces">                    </span><span class="istickedoff"><span class="nottickedoff">pleaseReport &quot;UNEXPECTED LAMBDA&quot; &quot;no patterns&quot;</span></span>
<span class="lineno"> 1363 </span><span class="spaces">                </span><span class="istickedoff">(_, Left patterns', _, expr') -&gt;</span>
<span class="lineno"> 1364 </span><span class="spaces">                    </span><span class="istickedoff">stack1</span>
<span class="lineno"> 1365 </span><span class="spaces">                        </span><span class="istickedoff">[ prefix (punc &quot;\\&quot;) $ stack1 patterns'</span>
<span class="lineno"> 1366 </span><span class="spaces">                        </span><span class="istickedoff">, line $ punc &quot;-&gt;&quot;</span>
<span class="lineno"> 1367 </span><span class="spaces">                        </span><span class="istickedoff">, indent $ stack1 $</span>
<span class="lineno"> 1368 </span><span class="spaces">                            </span><span class="istickedoff">(map <span class="nottickedoff">formatComment</span> bodyComments)</span>
<span class="lineno"> 1369 </span><span class="spaces">                            </span><span class="istickedoff">++ [ expr' ]</span>
<span class="lineno"> 1370 </span><span class="spaces">                        </span><span class="istickedoff">]</span>
<span class="lineno"> 1371 </span><span class="spaces">            </span><span class="istickedoff">|&gt; expressionParens AmbiguousEnd context</span>
<span class="lineno"> 1372 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno"> 1373 </span><span class="spaces">        </span><span class="istickedoff">Unary Negative e -&gt;</span>
<span class="lineno"> 1374 </span><span class="spaces">            </span><span class="istickedoff">prefix (punc &quot;-&quot;) $ formatExpression elmVersion <span class="nottickedoff">importInfo</span> SpaceSeparated e -- TODO: This might need something stronger than SpaceSeparated?</span>
<span class="lineno"> 1375 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno"> 1376 </span><span class="spaces">        </span><span class="istickedoff">App left [] _ -&gt;</span>
<span class="lineno"> 1377 </span><span class="spaces">            </span><span class="istickedoff"><span class="nottickedoff">formatExpression elmVersion importInfo context left</span></span>
<span class="lineno"> 1378 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno"> 1379 </span><span class="spaces">        </span><span class="istickedoff">App left args multiline -&gt;</span>
<span class="lineno"> 1380 </span><span class="spaces">            </span><span class="istickedoff">ElmStructure.application</span>
<span class="lineno"> 1381 </span><span class="spaces">                </span><span class="istickedoff">multiline</span>
<span class="lineno"> 1382 </span><span class="spaces">                </span><span class="istickedoff">(formatExpression elmVersion <span class="nottickedoff">importInfo</span> InfixSeparated left)</span>
<span class="lineno"> 1383 </span><span class="spaces">                </span><span class="istickedoff">(fmap (formatPreCommentedExpression elmVersion <span class="nottickedoff">importInfo</span> SpaceSeparated) args)</span>
<span class="lineno"> 1384 </span><span class="spaces">                </span><span class="istickedoff">|&gt; expressionParens SpaceSeparated context</span>
<span class="lineno"> 1385 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno"> 1386 </span><span class="spaces">        </span><span class="istickedoff">If if' elseifs (C elsComments els) -&gt;</span>
<span class="lineno"> 1387 </span><span class="spaces">            </span><span class="istickedoff">let</span>
<span class="lineno"> 1388 </span><span class="spaces">                </span><span class="istickedoff">opening key cond =</span>
<span class="lineno"> 1389 </span><span class="spaces">                    </span><span class="istickedoff">case (key, cond) of</span>
<span class="lineno"> 1390 </span><span class="spaces">                        </span><span class="istickedoff">(SingleLine key', SingleLine cond') -&gt;</span>
<span class="lineno"> 1391 </span><span class="spaces">                            </span><span class="istickedoff">line $ row</span>
<span class="lineno"> 1392 </span><span class="spaces">                                </span><span class="istickedoff">[ key'</span>
<span class="lineno"> 1393 </span><span class="spaces">                                </span><span class="istickedoff">, space</span>
<span class="lineno"> 1394 </span><span class="spaces">                                </span><span class="istickedoff">, cond'</span>
<span class="lineno"> 1395 </span><span class="spaces">                                </span><span class="istickedoff">, space</span>
<span class="lineno"> 1396 </span><span class="spaces">                                </span><span class="istickedoff">, keyword &quot;then&quot;</span>
<span class="lineno"> 1397 </span><span class="spaces">                                </span><span class="istickedoff">]</span>
<span class="lineno"> 1398 </span><span class="spaces">                        </span><span class="istickedoff">_ -&gt;</span>
<span class="lineno"> 1399 </span><span class="spaces">                            </span><span class="istickedoff">stack1</span>
<span class="lineno"> 1400 </span><span class="spaces">                                </span><span class="istickedoff">[ key</span>
<span class="lineno"> 1401 </span><span class="spaces">                                </span><span class="istickedoff">, cond |&gt; indent</span>
<span class="lineno"> 1402 </span><span class="spaces">                                </span><span class="istickedoff">, line $ keyword &quot;then&quot;</span>
<span class="lineno"> 1403 </span><span class="spaces">                                </span><span class="istickedoff">]</span>
<span class="lineno"> 1404 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno"> 1405 </span><span class="spaces">                </span><span class="istickedoff">formatIf (IfClause cond body) =</span>
<span class="lineno"> 1406 </span><span class="spaces">                    </span><span class="istickedoff">stack1</span>
<span class="lineno"> 1407 </span><span class="spaces">                        </span><span class="istickedoff">[ opening (line $ keyword &quot;if&quot;) $ formatCommentedExpression elmVersion <span class="nottickedoff">importInfo</span> SyntaxSeparated cond</span>
<span class="lineno"> 1408 </span><span class="spaces">                        </span><span class="istickedoff">, indent $ formatCommented_ True (formatExpression elmVersion <span class="nottickedoff">importInfo</span> SyntaxSeparated) body</span>
<span class="lineno"> 1409 </span><span class="spaces">                        </span><span class="istickedoff">]</span>
<span class="lineno"> 1410 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno"> 1411 </span><span class="spaces">                </span><span class="istickedoff">formatElseIf (C ifComments (IfClause cond body)) =</span>
<span class="lineno"> 1412 </span><span class="spaces">                  </span><span class="istickedoff">let</span>
<span class="lineno"> 1413 </span><span class="spaces">                    </span><span class="istickedoff">key =</span>
<span class="lineno"> 1414 </span><span class="spaces">                      </span><span class="istickedoff">case formatHeadCommented id (C ifComments $ line $ keyword &quot;if&quot;) of</span>
<span class="lineno"> 1415 </span><span class="spaces">                        </span><span class="istickedoff">SingleLine key' -&gt;</span>
<span class="lineno"> 1416 </span><span class="spaces">                          </span><span class="istickedoff">line $ row [ keyword &quot;else&quot;, space, key' ]</span>
<span class="lineno"> 1417 </span><span class="spaces">                        </span><span class="istickedoff">key' -&gt;</span>
<span class="lineno"> 1418 </span><span class="spaces">                          </span><span class="istickedoff">stack1</span>
<span class="lineno"> 1419 </span><span class="spaces">                            </span><span class="istickedoff">[ line $ keyword &quot;else&quot;</span>
<span class="lineno"> 1420 </span><span class="spaces">                            </span><span class="istickedoff">, key'</span>
<span class="lineno"> 1421 </span><span class="spaces">                            </span><span class="istickedoff">]</span>
<span class="lineno"> 1422 </span><span class="spaces">                  </span><span class="istickedoff">in</span>
<span class="lineno"> 1423 </span><span class="spaces">                    </span><span class="istickedoff">stack1</span>
<span class="lineno"> 1424 </span><span class="spaces">                      </span><span class="istickedoff">[ blankLine</span>
<span class="lineno"> 1425 </span><span class="spaces">                      </span><span class="istickedoff">, opening key $ formatCommentedExpression elmVersion <span class="nottickedoff">importInfo</span> SyntaxSeparated cond</span>
<span class="lineno"> 1426 </span><span class="spaces">                      </span><span class="istickedoff">, indent $ formatCommented_ True (formatExpression elmVersion <span class="nottickedoff">importInfo</span> SyntaxSeparated) body</span>
<span class="lineno"> 1427 </span><span class="spaces">                      </span><span class="istickedoff">]</span>
<span class="lineno"> 1428 </span><span class="spaces">            </span><span class="istickedoff">in</span>
<span class="lineno"> 1429 </span><span class="spaces">                </span><span class="istickedoff">formatIf if'</span>
<span class="lineno"> 1430 </span><span class="spaces">                    </span><span class="istickedoff">|&gt; andThen (fmap formatElseIf elseifs)</span>
<span class="lineno"> 1431 </span><span class="spaces">                    </span><span class="istickedoff">|&gt; andThen</span>
<span class="lineno"> 1432 </span><span class="spaces">                        </span><span class="istickedoff">[ blankLine</span>
<span class="lineno"> 1433 </span><span class="spaces">                        </span><span class="istickedoff">, line $ keyword &quot;else&quot;</span>
<span class="lineno"> 1434 </span><span class="spaces">                        </span><span class="istickedoff">, indent $ formatCommented_ True (formatExpression elmVersion <span class="nottickedoff">importInfo</span> SyntaxSeparated) (C (elsComments, []) els)</span>
<span class="lineno"> 1435 </span><span class="spaces">                        </span><span class="istickedoff">]</span>
<span class="lineno"> 1436 </span><span class="spaces">                    </span><span class="istickedoff">|&gt; expressionParens AmbiguousEnd context</span>
<span class="lineno"> 1437 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno"> 1438 </span><span class="spaces">        </span><span class="istickedoff">Let defs bodyComments expr -&gt;</span>
<span class="lineno"> 1439 </span><span class="spaces">            </span><span class="istickedoff">let</span>
<span class="lineno"> 1440 </span><span class="spaces">                </span><span class="istickedoff">spacer :: AST typeRef ctorRef varRef (I.Fix Identity (AST typeRef ctorRef varRef)) 'LetDeclarationNK -&gt; AST typeRef ctorRef varRef getType 'LetDeclarationNK -&gt; [Box]</span>
<span class="lineno"> 1441 </span><span class="spaces">                </span><span class="istickedoff">spacer first _ =</span>
<span class="lineno"> 1442 </span><span class="spaces">                    </span><span class="istickedoff">case first of</span>
<span class="lineno"> 1443 </span><span class="spaces">                        </span><span class="istickedoff">LetCommonDeclaration (I.Fix (Identity (Definition _ _ _ _))) -&gt;</span>
<span class="lineno"> 1444 </span><span class="spaces">                            </span><span class="istickedoff">[ blankLine ]</span>
<span class="lineno"> 1445 </span><span class="spaces">                        </span><span class="istickedoff">_ -&gt;</span>
<span class="lineno"> 1446 </span><span class="spaces">                            </span><span class="istickedoff">[]</span>
<span class="lineno"> 1447 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno"> 1448 </span><span class="spaces">                </span><span class="istickedoff">formatDefinition' def =</span>
<span class="lineno"> 1449 </span><span class="spaces">                  </span><span class="istickedoff">case def of</span>
<span class="lineno"> 1450 </span><span class="spaces">                    </span><span class="istickedoff">LetCommonDeclaration (I.Fix (Identity (Definition name args comments expr'))) -&gt;</span>
<span class="lineno"> 1451 </span><span class="spaces">                      </span><span class="istickedoff">formatDefinition elmVersion <span class="nottickedoff">importInfo</span> name args comments expr'</span>
<span class="lineno"> 1452 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno"> 1453 </span><span class="spaces">                    </span><span class="istickedoff">LetCommonDeclaration (I.Fix (Identity (TypeAnnotation name typ))) -&gt;</span>
<span class="lineno"> 1454 </span><span class="spaces">                      </span><span class="istickedoff">formatTypeAnnotation elmVersion name typ</span>
<span class="lineno"> 1455 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno"> 1456 </span><span class="spaces">                    </span><span class="istickedoff">LetComment comment -&gt;</span>
<span class="lineno"> 1457 </span><span class="spaces">                        </span><span class="istickedoff">formatComment comment</span>
<span class="lineno"> 1458 </span><span class="spaces">            </span><span class="istickedoff">in</span>
<span class="lineno"> 1459 </span><span class="spaces">                </span><span class="istickedoff">line (keyword &quot;let&quot;)</span>
<span class="lineno"> 1460 </span><span class="spaces">                    </span><span class="istickedoff">|&gt; andThen</span>
<span class="lineno"> 1461 </span><span class="spaces">                        </span><span class="istickedoff">(defs</span>
<span class="lineno"> 1462 </span><span class="spaces">                            </span><span class="istickedoff">|&gt; fmap (extract . I.unFix)</span>
<span class="lineno"> 1463 </span><span class="spaces">                            </span><span class="istickedoff">|&gt; intersperseMap spacer formatDefinition'</span>
<span class="lineno"> 1464 </span><span class="spaces">                            </span><span class="istickedoff">|&gt; map indent</span>
<span class="lineno"> 1465 </span><span class="spaces">                        </span><span class="istickedoff">)</span>
<span class="lineno"> 1466 </span><span class="spaces">                    </span><span class="istickedoff">|&gt; andThen</span>
<span class="lineno"> 1467 </span><span class="spaces">                        </span><span class="istickedoff">[ line $ keyword &quot;in&quot;</span>
<span class="lineno"> 1468 </span><span class="spaces">                        </span><span class="istickedoff">, stack1 $</span>
<span class="lineno"> 1469 </span><span class="spaces">                            </span><span class="istickedoff">(map formatComment bodyComments)</span>
<span class="lineno"> 1470 </span><span class="spaces">                            </span><span class="istickedoff">++ [formatExpression elmVersion <span class="nottickedoff">importInfo</span> SyntaxSeparated expr]</span>
<span class="lineno"> 1471 </span><span class="spaces">                        </span><span class="istickedoff">]</span>
<span class="lineno"> 1472 </span><span class="spaces">                    </span><span class="istickedoff">|&gt; expressionParens AmbiguousEnd context -- TODO: not tested</span>
<span class="lineno"> 1473 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno"> 1474 </span><span class="spaces">        </span><span class="istickedoff">Case (subject,multiline) clauses -&gt;</span>
<span class="lineno"> 1475 </span><span class="spaces">            </span><span class="istickedoff">let</span>
<span class="lineno"> 1476 </span><span class="spaces">                </span><span class="istickedoff">opening =</span>
<span class="lineno"> 1477 </span><span class="spaces">                  </span><span class="istickedoff">case</span>
<span class="lineno"> 1478 </span><span class="spaces">                    </span><span class="istickedoff">( multiline</span>
<span class="lineno"> 1479 </span><span class="spaces">                    </span><span class="istickedoff">, formatCommentedExpression elmVersion <span class="nottickedoff">importInfo</span> SyntaxSeparated subject</span>
<span class="lineno"> 1480 </span><span class="spaces">                    </span><span class="istickedoff">)</span>
<span class="lineno"> 1481 </span><span class="spaces">                  </span><span class="istickedoff">of</span>
<span class="lineno"> 1482 </span><span class="spaces">                      </span><span class="istickedoff">(False, SingleLine subject') -&gt;</span>
<span class="lineno"> 1483 </span><span class="spaces">                          </span><span class="istickedoff">line $ row</span>
<span class="lineno"> 1484 </span><span class="spaces">                              </span><span class="istickedoff">[ keyword &quot;case&quot;</span>
<span class="lineno"> 1485 </span><span class="spaces">                              </span><span class="istickedoff">, space</span>
<span class="lineno"> 1486 </span><span class="spaces">                              </span><span class="istickedoff">, subject'</span>
<span class="lineno"> 1487 </span><span class="spaces">                              </span><span class="istickedoff">, space</span>
<span class="lineno"> 1488 </span><span class="spaces">                              </span><span class="istickedoff">, keyword &quot;of&quot;</span>
<span class="lineno"> 1489 </span><span class="spaces">                              </span><span class="istickedoff">]</span>
<span class="lineno"> 1490 </span><span class="spaces">                      </span><span class="istickedoff">(_, subject') -&gt;</span>
<span class="lineno"> 1491 </span><span class="spaces">                          </span><span class="istickedoff">stack1</span>
<span class="lineno"> 1492 </span><span class="spaces">                              </span><span class="istickedoff">[ line $ keyword &quot;case&quot;</span>
<span class="lineno"> 1493 </span><span class="spaces">                              </span><span class="istickedoff">, indent subject'</span>
<span class="lineno"> 1494 </span><span class="spaces">                              </span><span class="istickedoff">, line $ keyword &quot;of&quot;</span>
<span class="lineno"> 1495 </span><span class="spaces">                              </span><span class="istickedoff">]</span>
<span class="lineno"> 1496 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno"> 1497 </span><span class="spaces">                </span><span class="istickedoff">clause (CaseBranch prePat postPat preExpr pat expr) =</span>
<span class="lineno"> 1498 </span><span class="spaces">                    </span><span class="istickedoff">case</span>
<span class="lineno"> 1499 </span><span class="spaces">                      </span><span class="istickedoff">( postPat</span>
<span class="lineno"> 1500 </span><span class="spaces">                      </span><span class="istickedoff">, (formatPattern elmVersion False pat)</span>
<span class="lineno"> 1501 </span><span class="spaces">                          </span><span class="istickedoff">|&gt; negativeCasePatternWorkaround pat</span>
<span class="lineno"> 1502 </span><span class="spaces">                      </span><span class="istickedoff">, formatCommentedStack (formatPattern elmVersion False) (C (prePat, postPat) pat)</span>
<span class="lineno"> 1503 </span><span class="spaces">                          </span><span class="istickedoff">|&gt; negativeCasePatternWorkaround pat</span>
<span class="lineno"> 1504 </span><span class="spaces">                      </span><span class="istickedoff">, formatHeadCommentedStack (formatExpression elmVersion <span class="nottickedoff">importInfo</span> SyntaxSeparated) (C preExpr expr)</span>
<span class="lineno"> 1505 </span><span class="spaces">                      </span><span class="istickedoff">)</span>
<span class="lineno"> 1506 </span><span class="spaces">                    </span><span class="istickedoff">of</span>
<span class="lineno"> 1507 </span><span class="spaces">                        </span><span class="istickedoff">(_, _, SingleLine pat', body') -&gt;</span>
<span class="lineno"> 1508 </span><span class="spaces">                            </span><span class="istickedoff">stack1</span>
<span class="lineno"> 1509 </span><span class="spaces">                                </span><span class="istickedoff">[ line $ row [ pat', space, keyword &quot;-&gt;&quot;]</span>
<span class="lineno"> 1510 </span><span class="spaces">                                </span><span class="istickedoff">, indent body'</span>
<span class="lineno"> 1511 </span><span class="spaces">                                </span><span class="istickedoff">]</span>
<span class="lineno"> 1512 </span><span class="spaces">                        </span><span class="istickedoff">([], SingleLine pat', _, body') -&gt;</span>
<span class="lineno"> 1513 </span><span class="spaces">                            </span><span class="istickedoff">stack1 $</span>
<span class="lineno"> 1514 </span><span class="spaces">                                </span><span class="istickedoff">(map formatComment prePat)</span>
<span class="lineno"> 1515 </span><span class="spaces">                                </span><span class="istickedoff">++ [ line $ row [ pat', space, keyword &quot;-&gt;&quot;]</span>
<span class="lineno"> 1516 </span><span class="spaces">                                   </span><span class="istickedoff">, indent body'</span>
<span class="lineno"> 1517 </span><span class="spaces">                                   </span><span class="istickedoff">]</span>
<span class="lineno"> 1518 </span><span class="spaces">                        </span><span class="istickedoff">(_, _, pat', body') -&gt;</span>
<span class="lineno"> 1519 </span><span class="spaces">                            </span><span class="istickedoff">stack1 $</span>
<span class="lineno"> 1520 </span><span class="spaces">                              </span><span class="istickedoff">[ pat'</span>
<span class="lineno"> 1521 </span><span class="spaces">                              </span><span class="istickedoff">, line $ keyword &quot;-&gt;&quot;</span>
<span class="lineno"> 1522 </span><span class="spaces">                              </span><span class="istickedoff">, indent body'</span>
<span class="lineno"> 1523 </span><span class="spaces">                              </span><span class="istickedoff">]</span>
<span class="lineno"> 1524 </span><span class="spaces">            </span><span class="istickedoff">in</span>
<span class="lineno"> 1525 </span><span class="spaces">                </span><span class="istickedoff">opening</span>
<span class="lineno"> 1526 </span><span class="spaces">                    </span><span class="istickedoff">|&gt; andThen</span>
<span class="lineno"> 1527 </span><span class="spaces">                        </span><span class="istickedoff">(clauses</span>
<span class="lineno"> 1528 </span><span class="spaces">                            </span><span class="istickedoff">|&gt; fmap (clause . extract . I.unFix)</span>
<span class="lineno"> 1529 </span><span class="spaces">                            </span><span class="istickedoff">|&gt; List.intersperse blankLine</span>
<span class="lineno"> 1530 </span><span class="spaces">                            </span><span class="istickedoff">|&gt; map indent</span>
<span class="lineno"> 1531 </span><span class="spaces">                        </span><span class="istickedoff">)</span>
<span class="lineno"> 1532 </span><span class="spaces">                    </span><span class="istickedoff">|&gt; expressionParens AmbiguousEnd context -- TODO: not tested</span>
<span class="lineno"> 1533 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno"> 1534 </span><span class="spaces">        </span><span class="istickedoff">Tuple exprs multiline -&gt;</span>
<span class="lineno"> 1535 </span><span class="spaces">            </span><span class="istickedoff">ElmStructure.group True &quot;(&quot; &quot;,&quot; &quot;)&quot; multiline $ map (formatCommentedExpression elmVersion <span class="nottickedoff">importInfo</span> SyntaxSeparated) exprs</span>
<span class="lineno"> 1536 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno"> 1537 </span><span class="spaces">        </span><span class="istickedoff">TupleFunction n -&gt;</span>
<span class="lineno"> 1538 </span><span class="spaces">            </span><span class="istickedoff">line $ keyword $ &quot;(&quot; ++ (List.replicate (n-1) ',') ++ &quot;)&quot;</span>
<span class="lineno"> 1539 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno"> 1540 </span><span class="spaces">        </span><span class="istickedoff">Access expr field -&gt;</span>
<span class="lineno"> 1541 </span><span class="spaces">            </span><span class="istickedoff">formatExpression elmVersion <span class="nottickedoff">importInfo</span> SpaceSeparated expr -- TODO: does this need a different context than SpaceSeparated?</span>
<span class="lineno"> 1542 </span><span class="spaces">                </span><span class="istickedoff">|&gt; addSuffix (row $ [punc &quot;.&quot;, formatLowercaseIdentifier elmVersion [] field])</span>
<span class="lineno"> 1543 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno"> 1544 </span><span class="spaces">        </span><span class="istickedoff">AccessFunction (LowercaseIdentifier field) -&gt;</span>
<span class="lineno"> 1545 </span><span class="spaces">            </span><span class="istickedoff">line $ identifier $ &quot;.&quot; ++ (formatVarName' elmVersion field)</span>
<span class="lineno"> 1546 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno"> 1547 </span><span class="spaces">        </span><span class="istickedoff">Record base fields trailing multiline -&gt;</span>
<span class="lineno"> 1548 </span><span class="spaces">            </span><span class="istickedoff">formatRecordLike</span>
<span class="lineno"> 1549 </span><span class="spaces">                </span><span class="istickedoff">(line . formatLowercaseIdentifier elmVersion [])</span>
<span class="lineno"> 1550 </span><span class="spaces">                </span><span class="istickedoff">(formatLowercaseIdentifier elmVersion [])</span>
<span class="lineno"> 1551 </span><span class="spaces">                </span><span class="istickedoff">&quot;=&quot;</span>
<span class="lineno"> 1552 </span><span class="spaces">                </span><span class="istickedoff">(formatExpression elmVersion <span class="nottickedoff">importInfo</span> SyntaxSeparated)</span>
<span class="lineno"> 1553 </span><span class="spaces">                </span><span class="istickedoff">base fields trailing multiline</span>
<span class="lineno"> 1554 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno"> 1555 </span><span class="spaces">        </span><span class="istickedoff">Parens expr -&gt;</span>
<span class="lineno"> 1556 </span><span class="spaces">            </span><span class="istickedoff">case expr of</span>
<span class="lineno"> 1557 </span><span class="spaces">                </span><span class="istickedoff">C ([], []) expr' -&gt;</span>
<span class="lineno"> 1558 </span><span class="spaces">                    </span><span class="istickedoff">formatExpression elmVersion <span class="nottickedoff">importInfo</span> context expr'</span>
<span class="lineno"> 1559 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno"> 1560 </span><span class="spaces">                </span><span class="istickedoff">_ -&gt;</span>
<span class="lineno"> 1561 </span><span class="spaces">                    </span><span class="istickedoff">formatCommentedExpression <span class="nottickedoff">elmVersion</span> <span class="nottickedoff">importInfo</span> SyntaxSeparated expr</span>
<span class="lineno"> 1562 </span><span class="spaces">                        </span><span class="istickedoff">|&gt; parens</span>
<span class="lineno"> 1563 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno"> 1564 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno"> 1565 </span><span class="spaces">        </span><span class="istickedoff">Unit comments -&gt;</span>
<span class="lineno"> 1566 </span><span class="spaces">            </span><span class="istickedoff">formatUnit '(' ')' comments</span>
<span class="lineno"> 1567 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno"> 1568 </span><span class="spaces">        </span><span class="istickedoff">GLShader src -&gt;</span>
<span class="lineno"> 1569 </span><span class="spaces">          </span><span class="istickedoff">line $ row</span>
<span class="lineno"> 1570 </span><span class="spaces">            </span><span class="istickedoff">[ punc &quot;[glsl|&quot;</span>
<span class="lineno"> 1571 </span><span class="spaces">            </span><span class="istickedoff">, literal $ src</span>
<span class="lineno"> 1572 </span><span class="spaces">            </span><span class="istickedoff">, punc &quot;|]&quot;</span>
<span class="lineno"> 1573 </span><span class="spaces">            </span><span class="istickedoff">]</span></span>
<span class="lineno"> 1574 </span>
<span class="lineno"> 1575 </span>
<span class="lineno"> 1576 </span>formatCommentedExpression ::
<span class="lineno"> 1577 </span>    ElmVersion -&gt; ImportInfo [UppercaseIdentifier] -&gt; ExpressionContext
<span class="lineno"> 1578 </span>    -&gt; C2 before after (ASTNS Identity [UppercaseIdentifier] 'ExpressionNK)
<span class="lineno"> 1579 </span>    -&gt; Box
<span class="lineno"> 1580 </span><span class="decl"><span class="istickedoff">formatCommentedExpression elmVersion importInfo context (C (pre, post) e) =</span>
<span class="lineno"> 1581 </span><span class="spaces">    </span><span class="istickedoff">let</span>
<span class="lineno"> 1582 </span><span class="spaces">        </span><span class="istickedoff">commented' =</span>
<span class="lineno"> 1583 </span><span class="spaces">            </span><span class="istickedoff">case extract $ I.unFix e of</span>
<span class="lineno"> 1584 </span><span class="spaces">                </span><span class="istickedoff">Parens (C (pre'', post'') e'') -&gt;</span>
<span class="lineno"> 1585 </span><span class="spaces">                    </span><span class="istickedoff">C (pre ++ pre'', post'' ++ post) e''</span>
<span class="lineno"> 1586 </span><span class="spaces">                </span><span class="istickedoff">_ -&gt; C (pre, post) e</span>
<span class="lineno"> 1587 </span><span class="spaces">    </span><span class="istickedoff">in</span>
<span class="lineno"> 1588 </span><span class="spaces">    </span><span class="istickedoff">formatCommented (formatExpression elmVersion <span class="nottickedoff">importInfo</span> context) commented'</span></span>
<span class="lineno"> 1589 </span>
<span class="lineno"> 1590 </span>
<span class="lineno"> 1591 </span>formatPreCommentedExpression ::
<span class="lineno"> 1592 </span>    Coapplicative annf =&gt;
<span class="lineno"> 1593 </span>    ElmVersion -&gt; ImportInfo [UppercaseIdentifier] -&gt; ExpressionContext
<span class="lineno"> 1594 </span>    -&gt; C1 before (ASTNS annf [UppercaseIdentifier] 'ExpressionNK)
<span class="lineno"> 1595 </span>    -&gt; Box
<span class="lineno"> 1596 </span><span class="decl"><span class="istickedoff">formatPreCommentedExpression elmVersion importInfo context (C pre e) =</span>
<span class="lineno"> 1597 </span><span class="spaces">    </span><span class="istickedoff">let</span>
<span class="lineno"> 1598 </span><span class="spaces">        </span><span class="istickedoff">(pre', e') =</span>
<span class="lineno"> 1599 </span><span class="spaces">            </span><span class="istickedoff">case extract $ I.unFix e of</span>
<span class="lineno"> 1600 </span><span class="spaces">                </span><span class="istickedoff">Parens (C (pre'', []) e'') -&gt;</span>
<span class="lineno"> 1601 </span><span class="spaces">                    </span><span class="istickedoff">(pre ++ pre'', e'')</span>
<span class="lineno"> 1602 </span><span class="spaces">                </span><span class="istickedoff">_ -&gt; (pre, e)</span>
<span class="lineno"> 1603 </span><span class="spaces">    </span><span class="istickedoff">in</span>
<span class="lineno"> 1604 </span><span class="spaces">    </span><span class="istickedoff">formatCommented' pre' (formatExpression elmVersion <span class="nottickedoff">importInfo</span> context) (I.convert (Identity . extract) e')</span></span>
<span class="lineno"> 1605 </span>
<span class="lineno"> 1606 </span>
<span class="lineno"> 1607 </span>formatRecordLike ::
<span class="lineno"> 1608 </span>    (base -&gt; Box) -&gt; (key -&gt; Line) -&gt; String -&gt; (value -&gt; Box)
<span class="lineno"> 1609 </span>    -&gt; Maybe (C2 before after base) -&gt; Sequence (Pair key value)-&gt; Comments -&gt; ForceMultiline
<span class="lineno"> 1610 </span>    -&gt; Box
<span class="lineno"> 1611 </span><span class="decl"><span class="istickedoff">formatRecordLike formatBase formatKey fieldSep formatValue base' fields trailing multiline =</span>
<span class="lineno"> 1612 </span><span class="spaces">    </span><span class="istickedoff">case (base', fields) of</span>
<span class="lineno"> 1613 </span><span class="spaces">      </span><span class="istickedoff">( Just base, pairs' ) -&gt;</span>
<span class="lineno"> 1614 </span><span class="spaces">          </span><span class="istickedoff">ElmStructure.extensionGroup'</span>
<span class="lineno"> 1615 </span><span class="spaces">              </span><span class="istickedoff">((\(ForceMultiline b) -&gt; b) multiline)</span>
<span class="lineno"> 1616 </span><span class="spaces">              </span><span class="istickedoff">(formatCommented formatBase base)</span>
<span class="lineno"> 1617 </span><span class="spaces">              </span><span class="istickedoff">(formatSequence '|' ',' Nothing</span>
<span class="lineno"> 1618 </span><span class="spaces">                  </span><span class="istickedoff">(formatPair formatKey fieldSep formatValue)</span>
<span class="lineno"> 1619 </span><span class="spaces">                  </span><span class="istickedoff">multiline</span>
<span class="lineno"> 1620 </span><span class="spaces">                  </span><span class="istickedoff">trailing</span>
<span class="lineno"> 1621 </span><span class="spaces">                  </span><span class="istickedoff">pairs')</span>
<span class="lineno"> 1622 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno"> 1623 </span><span class="spaces">      </span><span class="istickedoff">( Nothing, pairs' ) -&gt;</span>
<span class="lineno"> 1624 </span><span class="spaces">          </span><span class="istickedoff">formatSequence '{' ',' (Just '}')</span>
<span class="lineno"> 1625 </span><span class="spaces">              </span><span class="istickedoff">(formatPair formatKey fieldSep formatValue)</span>
<span class="lineno"> 1626 </span><span class="spaces">              </span><span class="istickedoff">multiline</span>
<span class="lineno"> 1627 </span><span class="spaces">              </span><span class="istickedoff">trailing</span>
<span class="lineno"> 1628 </span><span class="spaces">              </span><span class="istickedoff">pairs'</span></span>
<span class="lineno"> 1629 </span>
<span class="lineno"> 1630 </span>
<span class="lineno"> 1631 </span>formatSequence :: Char -&gt; Char -&gt; Maybe Char -&gt; (a -&gt; Box) -&gt; ForceMultiline -&gt; Comments -&gt; Sequence a -&gt; Box
<span class="lineno"> 1632 </span><span class="decl"><span class="istickedoff">formatSequence left delim right formatA (ForceMultiline multiline) trailing (Sequence (first:rest)) =</span>
<span class="lineno"> 1633 </span><span class="spaces">    </span><span class="istickedoff">let</span>
<span class="lineno"> 1634 </span><span class="spaces">        </span><span class="istickedoff">formatItem delim_ (C (pre, post, eol) item) =</span>
<span class="lineno"> 1635 </span><span class="spaces">            </span><span class="istickedoff">maybe id (stack' . stack' blankLine) (formatComments pre) $</span>
<span class="lineno"> 1636 </span><span class="spaces">            </span><span class="istickedoff">prefix (row [ punc [delim_], space ]) $</span>
<span class="lineno"> 1637 </span><span class="spaces">            </span><span class="istickedoff">formatC2Eol $ C (post, [], eol) $ formatA item</span>
<span class="lineno"> 1638 </span><span class="spaces">    </span><span class="istickedoff">in</span>
<span class="lineno"> 1639 </span><span class="spaces">        </span><span class="istickedoff">ElmStructure.forceableSpaceSepOrStack multiline</span>
<span class="lineno"> 1640 </span><span class="spaces">            </span><span class="istickedoff">(ElmStructure.forceableRowOrStack multiline</span>
<span class="lineno"> 1641 </span><span class="spaces">                </span><span class="istickedoff">(formatItem left first)</span>
<span class="lineno"> 1642 </span><span class="spaces">                </span><span class="istickedoff">(map (formatItem delim) rest)</span>
<span class="lineno"> 1643 </span><span class="spaces">            </span><span class="istickedoff">)</span>
<span class="lineno"> 1644 </span><span class="spaces">            </span><span class="istickedoff">(maybe [] (flip (:) [] . stack' blankLine) (formatComments trailing) ++ (Maybe.maybeToList $ fmap (line . punc . flip (:) []) right))</span>
<span class="lineno"> 1645 </span><span class="spaces"></span><span class="istickedoff">formatSequence left _ (Just right) _ _ trailing (Sequence []) =</span>
<span class="lineno"> 1646 </span><span class="spaces">    </span><span class="istickedoff">formatUnit left right trailing</span>
<span class="lineno"> 1647 </span><span class="spaces"></span><span class="istickedoff">formatSequence left _ Nothing _ _ trailing (Sequence []) =</span>
<span class="lineno"> 1648 </span><span class="spaces">    </span><span class="istickedoff"><span class="nottickedoff">formatUnit left ' ' trailing</span></span></span>
<span class="lineno"> 1649 </span>
<span class="lineno"> 1650 </span>
<span class="lineno"> 1651 </span>mapIsLast :: (Bool -&gt; a -&gt; b) -&gt; [a] -&gt; [b]
<span class="lineno"> 1652 </span><span class="decl"><span class="istickedoff">mapIsLast _ [] = <span class="nottickedoff">[]</span></span>
<span class="lineno"> 1653 </span><span class="spaces"></span><span class="istickedoff">mapIsLast f (last_:[]) = f True last_ : []</span>
<span class="lineno"> 1654 </span><span class="spaces"></span><span class="istickedoff">mapIsLast f (next:rest) = f <span class="nottickedoff">False</span> next : mapIsLast f rest</span></span>
<span class="lineno"> 1655 </span>
<span class="lineno"> 1656 </span>
<span class="lineno"> 1657 </span>formatBinops ::
<span class="lineno"> 1658 </span>    ElmVersion
<span class="lineno"> 1659 </span>    -&gt; ImportInfo [UppercaseIdentifier]
<span class="lineno"> 1660 </span>    -&gt; ASTNS Identity [UppercaseIdentifier] 'ExpressionNK
<span class="lineno"> 1661 </span>    -&gt; [BinopsClause (Ref [UppercaseIdentifier]) (ASTNS Identity [UppercaseIdentifier] 'ExpressionNK)]
<span class="lineno"> 1662 </span>    -&gt; Bool
<span class="lineno"> 1663 </span>    -&gt; Box
<span class="lineno"> 1664 </span><span class="decl"><span class="istickedoff">formatBinops elmVersion importInfo left ops multiline =</span>
<span class="lineno"> 1665 </span><span class="spaces">    </span><span class="istickedoff">let</span>
<span class="lineno"> 1666 </span><span class="spaces">        </span><span class="istickedoff">formatPair_ isLast (BinopsClause po o pe e) =</span>
<span class="lineno"> 1667 </span><span class="spaces">            </span><span class="istickedoff">let</span>
<span class="lineno"> 1668 </span><span class="spaces">                </span><span class="istickedoff">isLeftPipe =</span>
<span class="lineno"> 1669 </span><span class="spaces">                    </span><span class="istickedoff">o == OpRef (SymbolIdentifier &quot;&lt;|&quot;)</span>
<span class="lineno"> 1670 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno"> 1671 </span><span class="spaces">                </span><span class="istickedoff">formatContext =</span>
<span class="lineno"> 1672 </span><span class="spaces">                    </span><span class="istickedoff">if isLeftPipe &amp;&amp; isLast</span>
<span class="lineno"> 1673 </span><span class="spaces">                        </span><span class="istickedoff">then AmbiguousEnd</span>
<span class="lineno"> 1674 </span><span class="spaces">                        </span><span class="istickedoff">else InfixSeparated</span>
<span class="lineno"> 1675 </span><span class="spaces">            </span><span class="istickedoff">in</span>
<span class="lineno"> 1676 </span><span class="spaces">            </span><span class="istickedoff">( isLeftPipe</span>
<span class="lineno"> 1677 </span><span class="spaces">            </span><span class="istickedoff">, po</span>
<span class="lineno"> 1678 </span><span class="spaces">            </span><span class="istickedoff">, (line . formatInfixVar elmVersion) o</span>
<span class="lineno"> 1679 </span><span class="spaces">            </span><span class="istickedoff">, formatCommented' pe (formatExpression elmVersion <span class="nottickedoff">importInfo</span> formatContext) e</span>
<span class="lineno"> 1680 </span><span class="spaces">            </span><span class="istickedoff">)</span>
<span class="lineno"> 1681 </span><span class="spaces">    </span><span class="istickedoff">in</span>
<span class="lineno"> 1682 </span><span class="spaces">        </span><span class="istickedoff">formatBinary</span>
<span class="lineno"> 1683 </span><span class="spaces">            </span><span class="istickedoff">multiline</span>
<span class="lineno"> 1684 </span><span class="spaces">            </span><span class="istickedoff">(formatExpression elmVersion <span class="nottickedoff">importInfo</span> InfixSeparated left)</span>
<span class="lineno"> 1685 </span><span class="spaces">            </span><span class="istickedoff">(mapIsLast formatPair_ ops)</span></span>
<span class="lineno"> 1686 </span>
<span class="lineno"> 1687 </span>
<span class="lineno"> 1688 </span>formatRange_0_17 ::
<span class="lineno"> 1689 </span>    ElmVersion -&gt; ImportInfo [UppercaseIdentifier]
<span class="lineno"> 1690 </span>    -&gt; C2 before after (ASTNS Identity [UppercaseIdentifier] 'ExpressionNK)
<span class="lineno"> 1691 </span>    -&gt; C2 before after (ASTNS Identity [UppercaseIdentifier] 'ExpressionNK)
<span class="lineno"> 1692 </span>    -&gt; Bool
<span class="lineno"> 1693 </span>    -&gt; Box
<span class="lineno"> 1694 </span><span class="decl"><span class="istickedoff">formatRange_0_17 elmVersion importInfo left right multiline =</span>
<span class="lineno"> 1695 </span><span class="spaces">    </span><span class="istickedoff">case</span>
<span class="lineno"> 1696 </span><span class="spaces">        </span><span class="istickedoff">( multiline</span>
<span class="lineno"> 1697 </span><span class="spaces">        </span><span class="istickedoff">, formatCommentedExpression elmVersion <span class="nottickedoff">importInfo</span> SyntaxSeparated left</span>
<span class="lineno"> 1698 </span><span class="spaces">        </span><span class="istickedoff">, formatCommentedExpression <span class="nottickedoff">elmVersion</span> <span class="nottickedoff">importInfo</span> SyntaxSeparated right</span>
<span class="lineno"> 1699 </span><span class="spaces">        </span><span class="istickedoff">)</span>
<span class="lineno"> 1700 </span><span class="spaces">    </span><span class="istickedoff">of</span>
<span class="lineno"> 1701 </span><span class="spaces">        </span><span class="istickedoff">(False, SingleLine left', SingleLine right') -&gt;</span>
<span class="lineno"> 1702 </span><span class="spaces">            </span><span class="istickedoff">line $ row</span>
<span class="lineno"> 1703 </span><span class="spaces">                </span><span class="istickedoff">[ punc &quot;[&quot;</span>
<span class="lineno"> 1704 </span><span class="spaces">                </span><span class="istickedoff">, left'</span>
<span class="lineno"> 1705 </span><span class="spaces">                </span><span class="istickedoff">, punc &quot;..&quot;</span>
<span class="lineno"> 1706 </span><span class="spaces">                </span><span class="istickedoff">, right'</span>
<span class="lineno"> 1707 </span><span class="spaces">                </span><span class="istickedoff">, punc &quot;]&quot;</span>
<span class="lineno"> 1708 </span><span class="spaces">                </span><span class="istickedoff">]</span>
<span class="lineno"> 1709 </span><span class="spaces">        </span><span class="istickedoff">(_, left', right') -&gt;</span>
<span class="lineno"> 1710 </span><span class="spaces">            </span><span class="istickedoff">stack1</span>
<span class="lineno"> 1711 </span><span class="spaces">                </span><span class="istickedoff">[ line $ punc &quot;[&quot;</span>
<span class="lineno"> 1712 </span><span class="spaces">                </span><span class="istickedoff">, indent left'</span>
<span class="lineno"> 1713 </span><span class="spaces">                </span><span class="istickedoff">, line $ punc &quot;..&quot;</span>
<span class="lineno"> 1714 </span><span class="spaces">                </span><span class="istickedoff">, indent right'</span>
<span class="lineno"> 1715 </span><span class="spaces">                </span><span class="istickedoff">, line $ punc &quot;]&quot;</span>
<span class="lineno"> 1716 </span><span class="spaces">                </span><span class="istickedoff">]</span></span>
<span class="lineno"> 1717 </span>
<span class="lineno"> 1718 </span>nowhere :: Region.Position
<span class="lineno"> 1719 </span><span class="decl"><span class="nottickedoff">nowhere =</span>
<span class="lineno"> 1720 </span><span class="spaces">    </span><span class="nottickedoff">Region.Position 0 0</span></span>
<span class="lineno"> 1721 </span>
<span class="lineno"> 1722 </span>
<span class="lineno"> 1723 </span>noRegion :: a -&gt; RA.Located a
<span class="lineno"> 1724 </span><span class="decl"><span class="nottickedoff">noRegion =</span>
<span class="lineno"> 1725 </span><span class="spaces">    </span><span class="nottickedoff">RA.at nowhere nowhere</span></span>
<span class="lineno"> 1726 </span>
<span class="lineno"> 1727 </span>formatRange_0_18 ::
<span class="lineno"> 1728 </span>    Coapplicative annf =&gt;
<span class="lineno"> 1729 </span>    ElmVersion -&gt; ImportInfo [UppercaseIdentifier] -&gt; ExpressionContext
<span class="lineno"> 1730 </span>    -&gt; C2 before after (ASTNS annf [UppercaseIdentifier] 'ExpressionNK)
<span class="lineno"> 1731 </span>    -&gt; C2 before after (ASTNS annf [UppercaseIdentifier] 'ExpressionNK)
<span class="lineno"> 1732 </span>    -&gt; Box
<span class="lineno"> 1733 </span><span class="decl"><span class="nottickedoff">formatRange_0_18 elmVersion importInfo context left right =</span>
<span class="lineno"> 1734 </span><span class="spaces">    </span><span class="nottickedoff">case (left, right) of</span>
<span class="lineno"> 1735 </span><span class="spaces">        </span><span class="nottickedoff">(C (preLeft, []) left', C (preRight, []) right') -&gt;</span>
<span class="lineno"> 1736 </span><span class="spaces">            </span><span class="nottickedoff">App</span>
<span class="lineno"> 1737 </span><span class="spaces">                </span><span class="nottickedoff">(I.Fix $ Identity $ VarExpr $ VarRef [UppercaseIdentifier &quot;List&quot;] $ LowercaseIdentifier &quot;range&quot;)</span>
<span class="lineno"> 1738 </span><span class="spaces">                </span><span class="nottickedoff">[ C preLeft $ I.convert (pure . extract) left'</span>
<span class="lineno"> 1739 </span><span class="spaces">                </span><span class="nottickedoff">, C preRight $ I.convert (pure . extract) right'</span>
<span class="lineno"> 1740 </span><span class="spaces">                </span><span class="nottickedoff">]</span>
<span class="lineno"> 1741 </span><span class="spaces">                </span><span class="nottickedoff">(FAJoinFirst JoinAll)</span>
<span class="lineno"> 1742 </span><span class="spaces">                </span><span class="nottickedoff">|&gt; (I.Fix . pure)</span>
<span class="lineno"> 1743 </span><span class="spaces">                </span><span class="nottickedoff">|&gt; formatExpression elmVersion importInfo context</span>
<span class="lineno"> 1744 </span><span class="spaces"></span><span class="nottickedoff"></span>
<span class="lineno"> 1745 </span><span class="spaces">        </span><span class="nottickedoff">_ -&gt;</span>
<span class="lineno"> 1746 </span><span class="spaces">            </span><span class="nottickedoff">App</span>
<span class="lineno"> 1747 </span><span class="spaces">                </span><span class="nottickedoff">(I.Fix $ Identity $ VarExpr $ VarRef [UppercaseIdentifier &quot;List&quot;] $ LowercaseIdentifier &quot;range&quot;)</span>
<span class="lineno"> 1748 </span><span class="spaces">                </span><span class="nottickedoff">[ C [] $ I.Fix $ pure $ Parens $ fmap (I.convert (pure . extract)) left</span>
<span class="lineno"> 1749 </span><span class="spaces">                </span><span class="nottickedoff">, C [] $ I.Fix $ pure $ Parens $ fmap (I.convert (pure . extract)) right</span>
<span class="lineno"> 1750 </span><span class="spaces">                </span><span class="nottickedoff">]</span>
<span class="lineno"> 1751 </span><span class="spaces">                </span><span class="nottickedoff">(FAJoinFirst JoinAll)</span>
<span class="lineno"> 1752 </span><span class="spaces">                </span><span class="nottickedoff">|&gt; (I.Fix . pure)</span>
<span class="lineno"> 1753 </span><span class="spaces">                </span><span class="nottickedoff">|&gt; formatExpression elmVersion importInfo context</span></span>
<span class="lineno"> 1754 </span>
<span class="lineno"> 1755 </span>
<span class="lineno"> 1756 </span>formatUnit :: Char -&gt; Char -&gt; Comments -&gt; Box
<span class="lineno"> 1757 </span><span class="decl"><span class="istickedoff">formatUnit left right comments =</span>
<span class="lineno"> 1758 </span><span class="spaces">  </span><span class="istickedoff">case (left, comments) of</span>
<span class="lineno"> 1759 </span><span class="spaces">    </span><span class="istickedoff">(_, []) -&gt;</span>
<span class="lineno"> 1760 </span><span class="spaces">      </span><span class="istickedoff">line $ punc (left : right : [])</span>
<span class="lineno"> 1761 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno"> 1762 </span><span class="spaces">    </span><span class="istickedoff">('{', (LineComment _):_) -&gt;</span>
<span class="lineno"> 1763 </span><span class="spaces">      </span><span class="istickedoff">surround left right $ prefix space $ stack1 $ map formatComment comments</span>
<span class="lineno"> 1764 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno"> 1765 </span><span class="spaces">    </span><span class="istickedoff">_ -&gt;</span>
<span class="lineno"> 1766 </span><span class="spaces">      </span><span class="istickedoff">surround left right $</span>
<span class="lineno"> 1767 </span><span class="spaces">        </span><span class="istickedoff">case allSingles $ map formatComment comments of</span>
<span class="lineno"> 1768 </span><span class="spaces">          </span><span class="istickedoff">Right comments' -&gt;</span>
<span class="lineno"> 1769 </span><span class="spaces">            </span><span class="istickedoff">line $ row $ List.intersperse space comments'</span>
<span class="lineno"> 1770 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno"> 1771 </span><span class="spaces">          </span><span class="istickedoff">Left comments' -&gt;</span>
<span class="lineno"> 1772 </span><span class="spaces">            </span><span class="istickedoff">stack1 comments'</span></span>
<span class="lineno"> 1773 </span>
<span class="lineno"> 1774 </span>
<span class="lineno"> 1775 </span>formatComments :: Comments -&gt; Maybe Box
<span class="lineno"> 1776 </span><span class="decl"><span class="istickedoff">formatComments comments =</span>
<span class="lineno"> 1777 </span><span class="spaces">    </span><span class="istickedoff">case fmap formatComment comments of</span>
<span class="lineno"> 1778 </span><span class="spaces">        </span><span class="istickedoff">[] -&gt;</span>
<span class="lineno"> 1779 </span><span class="spaces">            </span><span class="istickedoff">Nothing</span>
<span class="lineno"> 1780 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno"> 1781 </span><span class="spaces">        </span><span class="istickedoff">(first:rest) -&gt;</span>
<span class="lineno"> 1782 </span><span class="spaces">            </span><span class="istickedoff">Just $ ElmStructure.spaceSepOrStack first rest</span></span>
<span class="lineno"> 1783 </span>
<span class="lineno"> 1784 </span>
<span class="lineno"> 1785 </span>formatCommented_ :: Bool -&gt; (a -&gt; Box) -&gt; C2 before after a -&gt; Box
<span class="lineno"> 1786 </span><span class="decl"><span class="istickedoff">formatCommented_ forceMultiline format (C (pre, post) inner) =</span>
<span class="lineno"> 1787 </span><span class="spaces">    </span><span class="istickedoff">ElmStructure.forceableSpaceSepOrStack1 forceMultiline $</span>
<span class="lineno"> 1788 </span><span class="spaces">        </span><span class="istickedoff">concat</span>
<span class="lineno"> 1789 </span><span class="spaces">            </span><span class="istickedoff">[ Maybe.maybeToList $ formatComments pre</span>
<span class="lineno"> 1790 </span><span class="spaces">            </span><span class="istickedoff">, [format inner]</span>
<span class="lineno"> 1791 </span><span class="spaces">            </span><span class="istickedoff">, Maybe.maybeToList $ formatComments post</span>
<span class="lineno"> 1792 </span><span class="spaces">            </span><span class="istickedoff">]</span></span>
<span class="lineno"> 1793 </span>
<span class="lineno"> 1794 </span>
<span class="lineno"> 1795 </span>formatCommented :: (a -&gt; Box) -&gt; C2 before after a -&gt; Box
<span class="lineno"> 1796 </span><span class="decl"><span class="istickedoff">formatCommented =</span>
<span class="lineno"> 1797 </span><span class="spaces">  </span><span class="istickedoff">formatCommented_ False</span></span>
<span class="lineno"> 1798 </span>
<span class="lineno"> 1799 </span>
<span class="lineno"> 1800 </span>-- TODO: rename to formatPreCommented
<span class="lineno"> 1801 </span>formatHeadCommented :: (a -&gt; Box) -&gt; (C1 before a) -&gt; Box
<span class="lineno"> 1802 </span><span class="decl"><span class="istickedoff">formatHeadCommented format (C pre inner) =</span>
<span class="lineno"> 1803 </span><span class="spaces">    </span><span class="istickedoff">formatCommented' pre format inner</span></span>
<span class="lineno"> 1804 </span>
<span class="lineno"> 1805 </span>
<span class="lineno"> 1806 </span>formatCommented' :: Comments -&gt; (a -&gt; Box) -&gt; a -&gt; Box
<span class="lineno"> 1807 </span><span class="decl"><span class="istickedoff">formatCommented' pre format inner =</span>
<span class="lineno"> 1808 </span><span class="spaces">    </span><span class="istickedoff">formatCommented format (C (pre, []) inner)</span></span>
<span class="lineno"> 1809 </span>
<span class="lineno"> 1810 </span>
<span class="lineno"> 1811 </span>formatTailCommented :: (a -&gt; Box) -&gt; C1 after a -&gt; Box
<span class="lineno"> 1812 </span><span class="decl"><span class="istickedoff">formatTailCommented format (C post inner) =</span>
<span class="lineno"> 1813 </span><span class="spaces">  </span><span class="istickedoff">formatCommented format (C ([], post) inner)</span></span>
<span class="lineno"> 1814 </span>
<span class="lineno"> 1815 </span>
<span class="lineno"> 1816 </span>formatC2Eol :: C2Eol before after Box -&gt; Box
<span class="lineno"> 1817 </span><span class="decl"><span class="istickedoff">formatC2Eol (C (pre, post, eol) a) =</span>
<span class="lineno"> 1818 </span><span class="spaces">    </span><span class="istickedoff">formatCommented id $ C (pre, post) $ formatEolCommented id $ C eol a</span></span>
<span class="lineno"> 1819 </span>
<span class="lineno"> 1820 </span>
<span class="lineno"> 1821 </span>formatEolCommented :: (a -&gt; Box) -&gt; C0Eol a -&gt; Box
<span class="lineno"> 1822 </span><span class="decl"><span class="istickedoff">formatEolCommented format (C post inner) =</span>
<span class="lineno"> 1823 </span><span class="spaces">  </span><span class="istickedoff">case (post, format inner) of</span>
<span class="lineno"> 1824 </span><span class="spaces">    </span><span class="istickedoff">(Nothing, box) -&gt; box</span>
<span class="lineno"> 1825 </span><span class="spaces">    </span><span class="istickedoff">(Just eol, SingleLine result) -&gt;</span>
<span class="lineno"> 1826 </span><span class="spaces">      </span><span class="istickedoff">mustBreak $ row [ result, space, punc &quot;--&quot;, literal eol ]</span>
<span class="lineno"> 1827 </span><span class="spaces">    </span><span class="istickedoff">(Just eol, box) -&gt;</span>
<span class="lineno"> 1828 </span><span class="spaces">      </span><span class="istickedoff"><span class="nottickedoff">stack1 [ box, formatComment $ LineComment eol ]</span></span></span>
<span class="lineno"> 1829 </span>
<span class="lineno"> 1830 </span>
<span class="lineno"> 1831 </span>formatCommentedStack :: (a -&gt; Box) -&gt; C2 before after a -&gt; Box
<span class="lineno"> 1832 </span><span class="decl"><span class="istickedoff">formatCommentedStack format (C (pre, post) inner) =</span>
<span class="lineno"> 1833 </span><span class="spaces">  </span><span class="istickedoff">stack1 $</span>
<span class="lineno"> 1834 </span><span class="spaces">    </span><span class="istickedoff">(map formatComment pre)</span>
<span class="lineno"> 1835 </span><span class="spaces">      </span><span class="istickedoff">++ [ format inner ]</span>
<span class="lineno"> 1836 </span><span class="spaces">      </span><span class="istickedoff">++ (map formatComment post)</span></span>
<span class="lineno"> 1837 </span>
<span class="lineno"> 1838 </span>
<span class="lineno"> 1839 </span>formatHeadCommentedStack :: (a -&gt; Box) -&gt; (C1 before a) -&gt; Box
<span class="lineno"> 1840 </span><span class="decl"><span class="istickedoff">formatHeadCommentedStack format (C pre inner) =</span>
<span class="lineno"> 1841 </span><span class="spaces">  </span><span class="istickedoff">formatCommentedStack format (C (pre, []) inner)</span></span>
<span class="lineno"> 1842 </span>
<span class="lineno"> 1843 </span>
<span class="lineno"> 1844 </span>formatKeywordCommented :: String -&gt; (a -&gt; Box) -&gt; C2 beforeKeyword afterKeyword a -&gt; Box
<span class="lineno"> 1845 </span><span class="decl"><span class="istickedoff">formatKeywordCommented word format (C (pre, post) value) =</span>
<span class="lineno"> 1846 </span><span class="spaces">  </span><span class="istickedoff">ElmStructure.spaceSepOrIndented</span>
<span class="lineno"> 1847 </span><span class="spaces">    </span><span class="istickedoff">(formatCommented (line . keyword) (C (pre, post) word))</span>
<span class="lineno"> 1848 </span><span class="spaces">    </span><span class="istickedoff">[ format value ]</span></span>
<span class="lineno"> 1849 </span>
<span class="lineno"> 1850 </span>
<span class="lineno"> 1851 </span>formatOpenCommentedList :: (a -&gt; Box) -&gt; OpenCommentedList a -&gt; [Box]
<span class="lineno"> 1852 </span><span class="decl"><span class="istickedoff">formatOpenCommentedList format (OpenCommentedList rest (C (preLst, eol) lst)) =</span>
<span class="lineno"> 1853 </span><span class="spaces">    </span><span class="istickedoff">(fmap (formatC2Eol . fmap format) rest)</span>
<span class="lineno"> 1854 </span><span class="spaces">        </span><span class="istickedoff">++ [formatC2Eol $ fmap format $ C (preLst, [], eol) lst]</span></span>
<span class="lineno"> 1855 </span>
<span class="lineno"> 1856 </span>
<span class="lineno"> 1857 </span>formatComment :: Comment -&gt; Box
<span class="lineno"> 1858 </span><span class="decl"><span class="istickedoff">formatComment comment =</span>
<span class="lineno"> 1859 </span><span class="spaces">    </span><span class="istickedoff">case comment of</span>
<span class="lineno"> 1860 </span><span class="spaces">        </span><span class="istickedoff">BlockComment c -&gt;</span>
<span class="lineno"> 1861 </span><span class="spaces">            </span><span class="istickedoff">case c of</span>
<span class="lineno"> 1862 </span><span class="spaces">                </span><span class="istickedoff">[] -&gt;</span>
<span class="lineno"> 1863 </span><span class="spaces">                    </span><span class="istickedoff"><span class="nottickedoff">line $ punc &quot;{- -}&quot;</span></span>
<span class="lineno"> 1864 </span><span class="spaces">                </span><span class="istickedoff">[l] -&gt;</span>
<span class="lineno"> 1865 </span><span class="spaces">                    </span><span class="istickedoff">line $ row</span>
<span class="lineno"> 1866 </span><span class="spaces">                        </span><span class="istickedoff">[ punc &quot;{-&quot;</span>
<span class="lineno"> 1867 </span><span class="spaces">                        </span><span class="istickedoff">, space</span>
<span class="lineno"> 1868 </span><span class="spaces">                        </span><span class="istickedoff">, literal l</span>
<span class="lineno"> 1869 </span><span class="spaces">                        </span><span class="istickedoff">, space</span>
<span class="lineno"> 1870 </span><span class="spaces">                        </span><span class="istickedoff">, punc &quot;-}&quot;</span>
<span class="lineno"> 1871 </span><span class="spaces">                        </span><span class="istickedoff">]</span>
<span class="lineno"> 1872 </span><span class="spaces">                </span><span class="istickedoff">ls -&gt;</span>
<span class="lineno"> 1873 </span><span class="spaces">                    </span><span class="istickedoff">stack1</span>
<span class="lineno"> 1874 </span><span class="spaces">                        </span><span class="istickedoff">[ prefix</span>
<span class="lineno"> 1875 </span><span class="spaces">                            </span><span class="istickedoff">(row [ punc &quot;{-&quot;, space ])</span>
<span class="lineno"> 1876 </span><span class="spaces">                            </span><span class="istickedoff">(stack1 $ map (line . literal) ls)</span>
<span class="lineno"> 1877 </span><span class="spaces">                        </span><span class="istickedoff">, line $ punc &quot;-}&quot;</span>
<span class="lineno"> 1878 </span><span class="spaces">                        </span><span class="istickedoff">]</span>
<span class="lineno"> 1879 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno"> 1880 </span><span class="spaces">        </span><span class="istickedoff">LineComment c -&gt;</span>
<span class="lineno"> 1881 </span><span class="spaces">            </span><span class="istickedoff">mustBreak $ row [ punc &quot;--&quot;, literal c ]</span>
<span class="lineno"> 1882 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno"> 1883 </span><span class="spaces">        </span><span class="istickedoff">CommentTrickOpener -&gt;</span>
<span class="lineno"> 1884 </span><span class="spaces">            </span><span class="istickedoff">mustBreak $ punc &quot;{--}&quot;</span>
<span class="lineno"> 1885 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno"> 1886 </span><span class="spaces">        </span><span class="istickedoff">CommentTrickCloser -&gt;</span>
<span class="lineno"> 1887 </span><span class="spaces">            </span><span class="istickedoff">mustBreak $ punc &quot;--}&quot;</span>
<span class="lineno"> 1888 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno"> 1889 </span><span class="spaces">        </span><span class="istickedoff">CommentTrickBlock c -&gt;</span>
<span class="lineno"> 1890 </span><span class="spaces">            </span><span class="istickedoff">mustBreak $ row [ punc &quot;{--&quot;, literal c, punc &quot;-}&quot; ]</span></span>
<span class="lineno"> 1891 </span>
<span class="lineno"> 1892 </span>
<span class="lineno"> 1893 </span>formatLiteral :: ElmVersion -&gt; LiteralValue -&gt; Box
<span class="lineno"> 1894 </span><span class="decl"><span class="istickedoff">formatLiteral elmVersion lit =</span>
<span class="lineno"> 1895 </span><span class="spaces">    </span><span class="istickedoff">case lit of</span>
<span class="lineno"> 1896 </span><span class="spaces">        </span><span class="istickedoff">IntNum i DecimalInt -&gt;</span>
<span class="lineno"> 1897 </span><span class="spaces">            </span><span class="istickedoff">line $ literal $ show i</span>
<span class="lineno"> 1898 </span><span class="spaces">        </span><span class="istickedoff">IntNum i HexadecimalInt -&gt;</span>
<span class="lineno"> 1899 </span><span class="spaces">            </span><span class="istickedoff">line $ literal $</span>
<span class="lineno"> 1900 </span><span class="spaces">              </span><span class="istickedoff">if i &lt; -0xFFFFFFFF then</span>
<span class="lineno"> 1901 </span><span class="spaces">                </span><span class="istickedoff">printf &quot;-0x%016X&quot; (-i)</span>
<span class="lineno"> 1902 </span><span class="spaces">              </span><span class="istickedoff">else if i &lt; -0xFFFF then</span>
<span class="lineno"> 1903 </span><span class="spaces">                </span><span class="istickedoff">printf &quot;-0x%08X&quot; (-i)</span>
<span class="lineno"> 1904 </span><span class="spaces">              </span><span class="istickedoff">else if i &lt; -0xFF then</span>
<span class="lineno"> 1905 </span><span class="spaces">                </span><span class="istickedoff">printf &quot;-0x%04X&quot; (-i)</span>
<span class="lineno"> 1906 </span><span class="spaces">              </span><span class="istickedoff">else if i &lt; 0 then</span>
<span class="lineno"> 1907 </span><span class="spaces">                </span><span class="istickedoff">printf &quot;-0x%02X&quot; (-i)</span>
<span class="lineno"> 1908 </span><span class="spaces">              </span><span class="istickedoff">else if i &lt;= 0xFF then</span>
<span class="lineno"> 1909 </span><span class="spaces">                </span><span class="istickedoff">printf &quot;0x%02X&quot; i</span>
<span class="lineno"> 1910 </span><span class="spaces">              </span><span class="istickedoff">else if i &lt;= 0xFFFF then</span>
<span class="lineno"> 1911 </span><span class="spaces">                </span><span class="istickedoff">printf &quot;0x%04X&quot; i</span>
<span class="lineno"> 1912 </span><span class="spaces">              </span><span class="istickedoff">else if i &lt;= 0xFFFFFFFF then</span>
<span class="lineno"> 1913 </span><span class="spaces">                </span><span class="istickedoff">printf &quot;0x%08X&quot; i</span>
<span class="lineno"> 1914 </span><span class="spaces">              </span><span class="istickedoff">else</span>
<span class="lineno"> 1915 </span><span class="spaces">                </span><span class="istickedoff">printf &quot;0x%016X&quot; i</span>
<span class="lineno"> 1916 </span><span class="spaces">        </span><span class="istickedoff">FloatNum f DecimalFloat -&gt;</span>
<span class="lineno"> 1917 </span><span class="spaces">            </span><span class="istickedoff">line $ literal $ printf &quot;%f&quot; f</span>
<span class="lineno"> 1918 </span><span class="spaces">        </span><span class="istickedoff">FloatNum f ExponentFloat -&gt;</span>
<span class="lineno"> 1919 </span><span class="spaces">            </span><span class="istickedoff"><span class="nottickedoff">line $ literal $ printf &quot;%e&quot; f</span></span>
<span class="lineno"> 1920 </span><span class="spaces">        </span><span class="istickedoff">Chr c -&gt;</span>
<span class="lineno"> 1921 </span><span class="spaces">            </span><span class="istickedoff">formatString elmVersion SChar [c]</span>
<span class="lineno"> 1922 </span><span class="spaces">        </span><span class="istickedoff">Str s multi -&gt;</span>
<span class="lineno"> 1923 </span><span class="spaces">            </span><span class="istickedoff">formatString elmVersion (SString multi) s</span>
<span class="lineno"> 1924 </span><span class="spaces">        </span><span class="istickedoff">Boolean b -&gt;</span>
<span class="lineno"> 1925 </span><span class="spaces">            </span><span class="istickedoff">line $ literal $ show b</span></span>
<span class="lineno"> 1926 </span>
<span class="lineno"> 1927 </span>
<span class="lineno"> 1928 </span>data StringStyle
<span class="lineno"> 1929 </span>    = SChar
<span class="lineno"> 1930 </span>    | SString StringRepresentation
<span class="lineno"> 1931 </span>    deriving (<span class="decl"><span class="istickedoff">Eq</span></span>)
<span class="lineno"> 1932 </span>
<span class="lineno"> 1933 </span>
<span class="lineno"> 1934 </span>formatString :: ElmVersion -&gt; StringStyle -&gt; String -&gt; Box
<span class="lineno"> 1935 </span><span class="decl"><span class="istickedoff">formatString elmVersion style s =</span>
<span class="lineno"> 1936 </span><span class="spaces">  </span><span class="istickedoff">case style of</span>
<span class="lineno"> 1937 </span><span class="spaces">      </span><span class="istickedoff">SChar -&gt;</span>
<span class="lineno"> 1938 </span><span class="spaces">        </span><span class="istickedoff">stringBox &quot;\'&quot; id</span>
<span class="lineno"> 1939 </span><span class="spaces">      </span><span class="istickedoff">SString SingleQuotedString -&gt;</span>
<span class="lineno"> 1940 </span><span class="spaces">        </span><span class="istickedoff">stringBox &quot;\&quot;&quot; id</span>
<span class="lineno"> 1941 </span><span class="spaces">      </span><span class="istickedoff">SString TripleQuotedString -&gt;</span>
<span class="lineno"> 1942 </span><span class="spaces">        </span><span class="istickedoff">stringBox &quot;\&quot;\&quot;\&quot;&quot; escapeMultiQuote</span>
<span class="lineno"> 1943 </span><span class="spaces">  </span><span class="istickedoff">where</span>
<span class="lineno"> 1944 </span><span class="spaces">    </span><span class="istickedoff">stringBox quotes escaper =</span>
<span class="lineno"> 1945 </span><span class="spaces">      </span><span class="istickedoff">line $ row</span>
<span class="lineno"> 1946 </span><span class="spaces">          </span><span class="istickedoff">[ punc quotes</span>
<span class="lineno"> 1947 </span><span class="spaces">          </span><span class="istickedoff">, literal $ escaper $ concatMap fix s</span>
<span class="lineno"> 1948 </span><span class="spaces">          </span><span class="istickedoff">, punc quotes</span>
<span class="lineno"> 1949 </span><span class="spaces">          </span><span class="istickedoff">]</span>
<span class="lineno"> 1950 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno"> 1951 </span><span class="spaces">    </span><span class="istickedoff">fix c =</span>
<span class="lineno"> 1952 </span><span class="spaces">        </span><span class="istickedoff">if (style == SString TripleQuotedString) &amp;&amp; c == '\n' then</span>
<span class="lineno"> 1953 </span><span class="spaces">            </span><span class="istickedoff">[c]</span>
<span class="lineno"> 1954 </span><span class="spaces">        </span><span class="istickedoff">else if c == '\n' then</span>
<span class="lineno"> 1955 </span><span class="spaces">            </span><span class="istickedoff">&quot;\\n&quot;</span>
<span class="lineno"> 1956 </span><span class="spaces">        </span><span class="istickedoff">else if c == '\t' then</span>
<span class="lineno"> 1957 </span><span class="spaces">            </span><span class="istickedoff">&quot;\\t&quot;</span>
<span class="lineno"> 1958 </span><span class="spaces">        </span><span class="istickedoff">else if c == '\\' then</span>
<span class="lineno"> 1959 </span><span class="spaces">            </span><span class="istickedoff">&quot;\\\\&quot;</span>
<span class="lineno"> 1960 </span><span class="spaces">        </span><span class="istickedoff">else if (style == SString SingleQuotedString) &amp;&amp; c == '\&quot;' then</span>
<span class="lineno"> 1961 </span><span class="spaces">            </span><span class="istickedoff">&quot;\\\&quot;&quot;</span>
<span class="lineno"> 1962 </span><span class="spaces">        </span><span class="istickedoff">else if (style == SChar) &amp;&amp; c == '\'' then</span>
<span class="lineno"> 1963 </span><span class="spaces">            </span><span class="istickedoff">&quot;\\\'&quot;</span>
<span class="lineno"> 1964 </span><span class="spaces">        </span><span class="istickedoff">else if not $ Char.isPrint c then</span>
<span class="lineno"> 1965 </span><span class="spaces">            </span><span class="istickedoff">hex c</span>
<span class="lineno"> 1966 </span><span class="spaces">        </span><span class="istickedoff">else if c == ' ' then</span>
<span class="lineno"> 1967 </span><span class="spaces">            </span><span class="istickedoff">[c]</span>
<span class="lineno"> 1968 </span><span class="spaces">        </span><span class="istickedoff">else if ElmVersion.style_0_19_stringEscape elmVersion == False &amp;&amp; c == '\xA0' then</span>
<span class="lineno"> 1969 </span><span class="spaces">            </span><span class="istickedoff">[c] -- Workaround for https://github.com/elm-lang/elm-compiler/issues/1279</span>
<span class="lineno"> 1970 </span><span class="spaces">        </span><span class="istickedoff">else if Char.isSpace c then</span>
<span class="lineno"> 1971 </span><span class="spaces">            </span><span class="istickedoff">hex c</span>
<span class="lineno"> 1972 </span><span class="spaces">        </span><span class="istickedoff">else</span>
<span class="lineno"> 1973 </span><span class="spaces">            </span><span class="istickedoff">[c]</span>
<span class="lineno"> 1974 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno"> 1975 </span><span class="spaces">    </span><span class="istickedoff">hex char =</span>
<span class="lineno"> 1976 </span><span class="spaces">      </span><span class="istickedoff">case ElmVersion.style_0_19_stringEscape elmVersion of</span>
<span class="lineno"> 1977 </span><span class="spaces">          </span><span class="istickedoff">True -&gt;</span>
<span class="lineno"> 1978 </span><span class="spaces">              </span><span class="istickedoff">&quot;\\u{&quot; ++ (printf &quot;%04X&quot; $ Char.ord char) ++ &quot;}&quot;</span>
<span class="lineno"> 1979 </span><span class="spaces">          </span><span class="istickedoff">False -&gt;</span>
<span class="lineno"> 1980 </span><span class="spaces">              </span><span class="istickedoff">&quot;\\x&quot; ++ (printf fmt $ Char.ord char)</span>
<span class="lineno"> 1981 </span><span class="spaces">      </span><span class="istickedoff">where</span>
<span class="lineno"> 1982 </span><span class="spaces">        </span><span class="istickedoff">fmt =</span>
<span class="lineno"> 1983 </span><span class="spaces">          </span><span class="istickedoff">if Char.ord char &lt;= 0xFF then</span>
<span class="lineno"> 1984 </span><span class="spaces">            </span><span class="istickedoff">&quot;%02X&quot;</span>
<span class="lineno"> 1985 </span><span class="spaces">          </span><span class="istickedoff">else</span>
<span class="lineno"> 1986 </span><span class="spaces">            </span><span class="istickedoff">&quot;%04X&quot;</span>
<span class="lineno"> 1987 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno"> 1988 </span><span class="spaces">    </span><span class="istickedoff">escapeMultiQuote =</span>
<span class="lineno"> 1989 </span><span class="spaces">        </span><span class="istickedoff">let</span>
<span class="lineno"> 1990 </span><span class="spaces">            </span><span class="istickedoff">step okay quotes remaining =</span>
<span class="lineno"> 1991 </span><span class="spaces">                </span><span class="istickedoff">case remaining of</span>
<span class="lineno"> 1992 </span><span class="spaces">                    </span><span class="istickedoff">[] -&gt;</span>
<span class="lineno"> 1993 </span><span class="spaces">                        </span><span class="istickedoff">reverse $ (concat $ replicate quotes &quot;\&quot;\\&quot;) ++ okay</span>
<span class="lineno"> 1994 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno"> 1995 </span><span class="spaces">                    </span><span class="istickedoff">next : rest -&gt;</span>
<span class="lineno"> 1996 </span><span class="spaces">                        </span><span class="istickedoff">if next == '&quot;' then</span>
<span class="lineno"> 1997 </span><span class="spaces">                            </span><span class="istickedoff">step okay (quotes + 1) rest</span>
<span class="lineno"> 1998 </span><span class="spaces">                        </span><span class="istickedoff">else if quotes &gt;= 3 then</span>
<span class="lineno"> 1999 </span><span class="spaces">                            </span><span class="istickedoff">step (next : (concat $ replicate quotes &quot;\&quot;\\&quot;) ++ okay) 0 rest</span>
<span class="lineno"> 2000 </span><span class="spaces">                        </span><span class="istickedoff">else if quotes &gt; 0 then</span>
<span class="lineno"> 2001 </span><span class="spaces">                            </span><span class="istickedoff">step (next : (replicate quotes '&quot;') ++ okay) 0 rest</span>
<span class="lineno"> 2002 </span><span class="spaces">                        </span><span class="istickedoff">else</span>
<span class="lineno"> 2003 </span><span class="spaces">                            </span><span class="istickedoff">step (next : okay) 0 rest</span>
<span class="lineno"> 2004 </span><span class="spaces">        </span><span class="istickedoff">in</span>
<span class="lineno"> 2005 </span><span class="spaces">            </span><span class="istickedoff">step &quot;&quot; 0</span></span>
<span class="lineno"> 2006 </span>
<span class="lineno"> 2007 </span>
<span class="lineno"> 2008 </span>
<span class="lineno"> 2009 </span>data TypeParensRequired
<span class="lineno"> 2010 </span>    = ForLambda
<span class="lineno"> 2011 </span>    | ForCtor
<span class="lineno"> 2012 </span>    | NotRequired
<span class="lineno"> 2013 </span>    deriving (<span class="decl"><span class="istickedoff">Eq</span></span>)
<span class="lineno"> 2014 </span>
<span class="lineno"> 2015 </span>
<span class="lineno"> 2016 </span>formatType ::
<span class="lineno"> 2017 </span>    Coapplicative annf =&gt;
<span class="lineno"> 2018 </span>    ElmVersion -&gt; ASTNS annf [UppercaseIdentifier] 'TypeNK -&gt; Box
<span class="lineno"> 2019 </span><span class="decl"><span class="istickedoff">formatType elmVersion =</span>
<span class="lineno"> 2020 </span><span class="spaces">    </span><span class="istickedoff">formatType' elmVersion NotRequired</span></span>
<span class="lineno"> 2021 </span>
<span class="lineno"> 2022 </span>
<span class="lineno"> 2023 </span>commaSpace :: Line
<span class="lineno"> 2024 </span><span class="decl"><span class="nottickedoff">commaSpace =</span>
<span class="lineno"> 2025 </span><span class="spaces">    </span><span class="nottickedoff">row</span>
<span class="lineno"> 2026 </span><span class="spaces">        </span><span class="nottickedoff">[ punc &quot;,&quot;</span>
<span class="lineno"> 2027 </span><span class="spaces">        </span><span class="nottickedoff">, space</span>
<span class="lineno"> 2028 </span><span class="spaces">        </span><span class="nottickedoff">]</span></span>
<span class="lineno"> 2029 </span>
<span class="lineno"> 2030 </span>
<span class="lineno"> 2031 </span>formatTypeConstructor :: ElmVersion -&gt; TypeConstructor ([UppercaseIdentifier], UppercaseIdentifier) -&gt; Box
<span class="lineno"> 2032 </span><span class="decl"><span class="istickedoff">formatTypeConstructor elmVersion ctor =</span>
<span class="lineno"> 2033 </span><span class="spaces">    </span><span class="istickedoff">case ctor of</span>
<span class="lineno"> 2034 </span><span class="spaces">        </span><span class="istickedoff">NamedConstructor (namespace, name) -&gt;</span>
<span class="lineno"> 2035 </span><span class="spaces">            </span><span class="istickedoff">line $ formatQualifiedUppercaseIdentifier elmVersion (namespace ++ [name])</span>
<span class="lineno"> 2036 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno"> 2037 </span><span class="spaces">        </span><span class="istickedoff">TupleConstructor n -&gt;</span>
<span class="lineno"> 2038 </span><span class="spaces">            </span><span class="istickedoff">line $ keyword $ &quot;(&quot; ++ (List.replicate (n-1) ',') ++ &quot;)&quot;</span></span>
<span class="lineno"> 2039 </span>
<span class="lineno"> 2040 </span>
<span class="lineno"> 2041 </span>formatType' ::
<span class="lineno"> 2042 </span>    Coapplicative annf =&gt;
<span class="lineno"> 2043 </span>    ElmVersion -&gt; TypeParensRequired -&gt; ASTNS annf [UppercaseIdentifier] 'TypeNK -&gt; Box
<span class="lineno"> 2044 </span><span class="decl"><span class="istickedoff">formatType' elmVersion requireParens atype =</span>
<span class="lineno"> 2045 </span><span class="spaces">    </span><span class="istickedoff">case extract $ I.unFix atype of</span>
<span class="lineno"> 2046 </span><span class="spaces">        </span><span class="istickedoff">UnitType comments -&gt;</span>
<span class="lineno"> 2047 </span><span class="spaces">          </span><span class="istickedoff">formatUnit '(' ')' comments</span>
<span class="lineno"> 2048 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno"> 2049 </span><span class="spaces">        </span><span class="istickedoff">FunctionType first rest (ForceMultiline forceMultiline) -&gt;</span>
<span class="lineno"> 2050 </span><span class="spaces">            </span><span class="istickedoff">let</span>
<span class="lineno"> 2051 </span><span class="spaces">                </span><span class="istickedoff">formatRight (C (preOp, postOp, eol) term) =</span>
<span class="lineno"> 2052 </span><span class="spaces">                    </span><span class="istickedoff">ElmStructure.forceableSpaceSepOrStack1</span>
<span class="lineno"> 2053 </span><span class="spaces">                        </span><span class="istickedoff">False</span>
<span class="lineno"> 2054 </span><span class="spaces">                        </span><span class="istickedoff">$ concat</span>
<span class="lineno"> 2055 </span><span class="spaces">                            </span><span class="istickedoff">[ Maybe.maybeToList $ formatComments preOp</span>
<span class="lineno"> 2056 </span><span class="spaces">                            </span><span class="istickedoff">, [ ElmStructure.prefixOrIndented</span>
<span class="lineno"> 2057 </span><span class="spaces">                                  </span><span class="istickedoff">(line $ punc &quot;-&gt;&quot;)</span>
<span class="lineno"> 2058 </span><span class="spaces">                                  </span><span class="istickedoff">(formatC2Eol $</span>
<span class="lineno"> 2059 </span><span class="spaces">                                      </span><span class="istickedoff">(fmap $ formatType' elmVersion ForLambda)</span>
<span class="lineno"> 2060 </span><span class="spaces">                                      </span><span class="istickedoff">(C (postOp, [], eol) term)</span>
<span class="lineno"> 2061 </span><span class="spaces">                                  </span><span class="istickedoff">)</span>
<span class="lineno"> 2062 </span><span class="spaces">                              </span><span class="istickedoff">]</span>
<span class="lineno"> 2063 </span><span class="spaces">                            </span><span class="istickedoff">]</span>
<span class="lineno"> 2064 </span><span class="spaces">            </span><span class="istickedoff">in</span>
<span class="lineno"> 2065 </span><span class="spaces">                </span><span class="istickedoff">ElmStructure.forceableSpaceSepOrStack</span>
<span class="lineno"> 2066 </span><span class="spaces">                    </span><span class="istickedoff">forceMultiline</span>
<span class="lineno"> 2067 </span><span class="spaces">                    </span><span class="istickedoff">(formatEolCommented (formatType' elmVersion ForLambda) first)</span>
<span class="lineno"> 2068 </span><span class="spaces">                    </span><span class="istickedoff">(fmap formatRight $ toCommentedList rest)</span>
<span class="lineno"> 2069 </span><span class="spaces">                </span><span class="istickedoff">|&gt; if requireParens /= NotRequired then parens else id</span>
<span class="lineno"> 2070 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno"> 2071 </span><span class="spaces">        </span><span class="istickedoff">TypeVariable var -&gt;</span>
<span class="lineno"> 2072 </span><span class="spaces">            </span><span class="istickedoff">line $ identifier $ formatVarName elmVersion var</span>
<span class="lineno"> 2073 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno"> 2074 </span><span class="spaces">        </span><span class="istickedoff">TypeConstruction ctor args forceMultiline -&gt;</span>
<span class="lineno"> 2075 </span><span class="spaces">            </span><span class="istickedoff">let</span>
<span class="lineno"> 2076 </span><span class="spaces">                </span><span class="istickedoff">join =</span>
<span class="lineno"> 2077 </span><span class="spaces">                    </span><span class="istickedoff">case forceMultiline of</span>
<span class="lineno"> 2078 </span><span class="spaces">                        </span><span class="istickedoff">ForceMultiline True -&gt; FASplitFirst</span>
<span class="lineno"> 2079 </span><span class="spaces">                        </span><span class="istickedoff">ForceMultiline False -&gt; FAJoinFirst JoinAll</span>
<span class="lineno"> 2080 </span><span class="spaces">            </span><span class="istickedoff">in</span>
<span class="lineno"> 2081 </span><span class="spaces">            </span><span class="istickedoff">ElmStructure.application</span>
<span class="lineno"> 2082 </span><span class="spaces">                </span><span class="istickedoff">join</span>
<span class="lineno"> 2083 </span><span class="spaces">                </span><span class="istickedoff">(formatTypeConstructor elmVersion ctor)</span>
<span class="lineno"> 2084 </span><span class="spaces">                </span><span class="istickedoff">(map (formatHeadCommented $ formatType' elmVersion ForCtor) args)</span>
<span class="lineno"> 2085 </span><span class="spaces">                </span><span class="istickedoff">|&gt; (if not (null args) &amp;&amp; requireParens == ForCtor then parens else id)</span>
<span class="lineno"> 2086 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno"> 2087 </span><span class="spaces">        </span><span class="istickedoff">TypeParens type' -&gt;</span>
<span class="lineno"> 2088 </span><span class="spaces">          </span><span class="istickedoff">parens $ formatCommented (formatType elmVersion) type'</span>
<span class="lineno"> 2089 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno"> 2090 </span><span class="spaces">        </span><span class="istickedoff">TupleType types (ForceMultiline forceMultiline) -&gt;</span>
<span class="lineno"> 2091 </span><span class="spaces">            </span><span class="istickedoff">ElmStructure.group True &quot;(&quot; &quot;,&quot; &quot;)&quot; forceMultiline (fmap (formatC2Eol . fmap (formatType elmVersion)) types)</span>
<span class="lineno"> 2092 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno"> 2093 </span><span class="spaces">        </span><span class="istickedoff">RecordType base fields trailing multiline -&gt;</span>
<span class="lineno"> 2094 </span><span class="spaces">            </span><span class="istickedoff">formatRecordLike</span>
<span class="lineno"> 2095 </span><span class="spaces">                </span><span class="istickedoff">(line . formatLowercaseIdentifier elmVersion [])</span>
<span class="lineno"> 2096 </span><span class="spaces">                </span><span class="istickedoff">(formatLowercaseIdentifier elmVersion [])</span>
<span class="lineno"> 2097 </span><span class="spaces">                </span><span class="istickedoff">&quot;:&quot;</span>
<span class="lineno"> 2098 </span><span class="spaces">                </span><span class="istickedoff">(formatType elmVersion)</span>
<span class="lineno"> 2099 </span><span class="spaces">                </span><span class="istickedoff">base fields trailing multiline</span></span>
<span class="lineno"> 2100 </span>
<span class="lineno"> 2101 </span>
<span class="lineno"> 2102 </span>formatVar :: ElmVersion -&gt; Ref [UppercaseIdentifier] -&gt; Line
<span class="lineno"> 2103 </span><span class="decl"><span class="istickedoff">formatVar elmVersion var =</span>
<span class="lineno"> 2104 </span><span class="spaces">    </span><span class="istickedoff">case var of</span>
<span class="lineno"> 2105 </span><span class="spaces">        </span><span class="istickedoff">VarRef namespace name -&gt;</span>
<span class="lineno"> 2106 </span><span class="spaces">            </span><span class="istickedoff">formatLowercaseIdentifier elmVersion namespace name</span>
<span class="lineno"> 2107 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno"> 2108 </span><span class="spaces">        </span><span class="istickedoff">TagRef namespace name -&gt;</span>
<span class="lineno"> 2109 </span><span class="spaces">            </span><span class="istickedoff">case namespace of</span>
<span class="lineno"> 2110 </span><span class="spaces">                </span><span class="istickedoff">[] -&gt; identifier $ formatVarName'' elmVersion name</span>
<span class="lineno"> 2111 </span><span class="spaces">                </span><span class="istickedoff">_ -&gt;</span>
<span class="lineno"> 2112 </span><span class="spaces">                    </span><span class="istickedoff">row</span>
<span class="lineno"> 2113 </span><span class="spaces">                        </span><span class="istickedoff">[ formatQualifiedUppercaseIdentifier elmVersion namespace</span>
<span class="lineno"> 2114 </span><span class="spaces">                        </span><span class="istickedoff">, punc &quot;.&quot;</span>
<span class="lineno"> 2115 </span><span class="spaces">                        </span><span class="istickedoff">, identifier $ formatVarName'' elmVersion name</span>
<span class="lineno"> 2116 </span><span class="spaces">                        </span><span class="istickedoff">]</span>
<span class="lineno"> 2117 </span><span class="spaces"></span><span class="istickedoff"></span>
<span class="lineno"> 2118 </span><span class="spaces">        </span><span class="istickedoff">OpRef name -&gt;</span>
<span class="lineno"> 2119 </span><span class="spaces">            </span><span class="istickedoff">formatSymbolIdentifierInParens name</span></span>
<span class="lineno"> 2120 </span>
<span class="lineno"> 2121 </span>
<span class="lineno"> 2122 </span>formatSymbolIdentifierInParens :: SymbolIdentifier -&gt; Line
<span class="lineno"> 2123 </span><span class="decl"><span class="istickedoff">formatSymbolIdentifierInParens (SymbolIdentifier name) =</span>
<span class="lineno"> 2124 </span><span class="spaces">    </span><span class="istickedoff">identifier $ &quot;(&quot; ++ name ++ &quot;)&quot;</span></span>
<span class="lineno"> 2125 </span>
<span class="lineno"> 2126 </span>
<span class="lineno"> 2127 </span>formatInfixVar :: ElmVersion -&gt; Ref [UppercaseIdentifier] -&gt; Line
<span class="lineno"> 2128 </span><span class="decl"><span class="istickedoff">formatInfixVar elmVersion var =</span>
<span class="lineno"> 2129 </span><span class="spaces">    </span><span class="istickedoff">case var of</span>
<span class="lineno"> 2130 </span><span class="spaces">        </span><span class="istickedoff">VarRef _ _ -&gt;</span>
<span class="lineno"> 2131 </span><span class="spaces">            </span><span class="istickedoff">row [ punc &quot;`&quot;</span>
<span class="lineno"> 2132 </span><span class="spaces">                </span><span class="istickedoff">, formatVar elmVersion var</span>
<span class="lineno"> 2133 </span><span class="spaces">                </span><span class="istickedoff">, punc &quot;`&quot;</span>
<span class="lineno"> 2134 </span><span class="spaces">                </span><span class="istickedoff">]</span>
<span class="lineno"> 2135 </span><span class="spaces">        </span><span class="istickedoff">TagRef _ _ -&gt;</span>
<span class="lineno"> 2136 </span><span class="spaces">            </span><span class="istickedoff"><span class="nottickedoff">row [ punc &quot;`&quot;</span></span>
<span class="lineno"> 2137 </span><span class="spaces">                </span><span class="istickedoff"><span class="nottickedoff">, formatVar elmVersion var</span></span>
<span class="lineno"> 2138 </span><span class="spaces">                </span><span class="istickedoff"><span class="nottickedoff">, punc &quot;`&quot;</span></span>
<span class="lineno"> 2139 </span><span class="spaces">                </span><span class="istickedoff"><span class="nottickedoff">]</span></span>
<span class="lineno"> 2140 </span><span class="spaces">        </span><span class="istickedoff">OpRef (SymbolIdentifier name) -&gt;</span>
<span class="lineno"> 2141 </span><span class="spaces">            </span><span class="istickedoff">identifier name</span></span>
<span class="lineno"> 2142 </span>
<span class="lineno"> 2143 </span>
<span class="lineno"> 2144 </span>formatLowercaseIdentifier :: ElmVersion -&gt; [UppercaseIdentifier] -&gt; LowercaseIdentifier -&gt; Line
<span class="lineno"> 2145 </span><span class="decl"><span class="istickedoff">formatLowercaseIdentifier elmVersion namespace (LowercaseIdentifier name) =</span>
<span class="lineno"> 2146 </span><span class="spaces">    </span><span class="istickedoff">case (<span class="nottickedoff">elmVersion</span>, namespace, <span class="nottickedoff">name</span>) of</span>
<span class="lineno"> 2147 </span><span class="spaces">        </span><span class="istickedoff">(_, [], _) -&gt; identifier $ formatVarName' elmVersion name</span>
<span class="lineno"> 2148 </span><span class="spaces">        </span><span class="istickedoff">_ -&gt;</span>
<span class="lineno"> 2149 </span><span class="spaces">            </span><span class="istickedoff">row</span>
<span class="lineno"> 2150 </span><span class="spaces">                </span><span class="istickedoff">[ formatQualifiedUppercaseIdentifier elmVersion namespace</span>
<span class="lineno"> 2151 </span><span class="spaces">                </span><span class="istickedoff">, punc &quot;.&quot;</span>
<span class="lineno"> 2152 </span><span class="spaces">                </span><span class="istickedoff">, identifier $ formatVarName' elmVersion name</span>
<span class="lineno"> 2153 </span><span class="spaces">                </span><span class="istickedoff">]</span></span>
<span class="lineno"> 2154 </span>
<span class="lineno"> 2155 </span>
<span class="lineno"> 2156 </span>formatUppercaseIdentifier :: ElmVersion -&gt; UppercaseIdentifier -&gt; Line
<span class="lineno"> 2157 </span><span class="decl"><span class="istickedoff">formatUppercaseIdentifier elmVersion (UppercaseIdentifier name) =</span>
<span class="lineno"> 2158 </span><span class="spaces">    </span><span class="istickedoff">identifier $ formatVarName' elmVersion name</span></span>
<span class="lineno"> 2159 </span>
<span class="lineno"> 2160 </span>
<span class="lineno"> 2161 </span>formatQualifiedUppercaseIdentifier :: ElmVersion -&gt; [UppercaseIdentifier] -&gt; Line
<span class="lineno"> 2162 </span><span class="decl"><span class="istickedoff">formatQualifiedUppercaseIdentifier elmVersion names =</span>
<span class="lineno"> 2163 </span><span class="spaces">  </span><span class="istickedoff">identifier $ List.intercalate &quot;.&quot; $</span>
<span class="lineno"> 2164 </span><span class="spaces">      </span><span class="istickedoff">map (\(UppercaseIdentifier name) -&gt; formatVarName' elmVersion name) names</span></span>
<span class="lineno"> 2165 </span>
<span class="lineno"> 2166 </span>
<span class="lineno"> 2167 </span>formatVarName :: ElmVersion -&gt; LowercaseIdentifier -&gt; String
<span class="lineno"> 2168 </span><span class="decl"><span class="istickedoff">formatVarName elmVersion (LowercaseIdentifier name) =</span>
<span class="lineno"> 2169 </span><span class="spaces">    </span><span class="istickedoff">formatVarName' elmVersion name</span></span>
<span class="lineno"> 2170 </span>
<span class="lineno"> 2171 </span>
<span class="lineno"> 2172 </span>formatVarName' :: ElmVersion -&gt; String -&gt; String
<span class="lineno"> 2173 </span><span class="decl"><span class="istickedoff">formatVarName' elmVersion name =</span>
<span class="lineno"> 2174 </span><span class="spaces">    </span><span class="istickedoff">case elmVersion of</span>
<span class="lineno"> 2175 </span><span class="spaces">        </span><span class="istickedoff">Elm_0_16 -&gt; <span class="nottickedoff">name</span></span>
<span class="lineno"> 2176 </span><span class="spaces">        </span><span class="istickedoff">Elm_0_17 -&gt; name</span>
<span class="lineno"> 2177 </span><span class="spaces">        </span><span class="istickedoff">_ -&gt; map (\x -&gt; if <span class="tickonlyfalse">x == '\''</span> then <span class="nottickedoff">'_'</span> else x) name</span></span>
<span class="lineno"> 2178 </span>
<span class="lineno"> 2179 </span>
<span class="lineno"> 2180 </span>formatVarName'' :: ElmVersion -&gt; UppercaseIdentifier -&gt; String
<span class="lineno"> 2181 </span><span class="decl"><span class="istickedoff">formatVarName'' elmVersion (UppercaseIdentifier name) =</span>
<span class="lineno"> 2182 </span><span class="spaces">    </span><span class="istickedoff">formatVarName' elmVersion name</span></span>

</pre>
</body>
</html>
